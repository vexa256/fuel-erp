import{_ as dt,r as c,a as q,c as K,o as ct,k as Q,S as b,l as ut,b as i,d as t,e as v,g as ft,t as l,f as U,n as C,w as N,v as L,F as Y,h as Z,q as mt,i as r}from"./index-BJk99QVQ.js";const gt={class:"d-flex flex-column gap-5 p-4 bg-light"},vt={class:"card card-flush shadow-sm border-0"},pt={class:"card-body p-6"},bt={class:"d-flex align-items-center justify-content-between mb-4"},ht={class:"d-flex align-items-center gap-3"},yt={class:"fs-6 text-gray-600 mb-0"},wt={class:"d-flex gap-2"},_t={class:"card bg-gradient-primary border-0"},xt={class:"card-body p-5 text-white"},kt={class:"d-flex align-items-center justify-content-between"},Dt={class:"fs-3 fw-bold text-white mb-2"},St={class:"fs-6 opacity-75 mb-0"},It={class:"text-end"},Ct={key:0,class:"fs-7 opacity-75 mt-1 mb-0"},Tt={class:"card card-flush shadow-sm border-0"},At={class:"card-body p-6"},Ot={class:"row g-4 mb-6"},Bt={class:"col-6"},Ut=["disabled"],Nt={class:"col-6"},Lt=["disabled"],$t={key:0,class:"mb-4"},Et={key:1,class:"card bg-light-info border-0"},Pt={class:"card-body p-4"},Ht={class:"row g-3"},Rt={class:"col-6"},jt={class:"d-flex align-items-center gap-2"},Ft={class:"fs-6 fw-bold text-gray-900 mb-0"},Jt={class:"col-6"},Mt={class:"d-flex align-items-center gap-2"},Vt={class:"fs-6 fw-bold text-gray-900 mb-0"},Wt={class:"d-flex justify-content-between"},zt={class:"fs-6 fw-bold text-primary"},qt={class:"card card-flush shadow-sm border-0"},Kt={class:"card-body p-6"},Qt={class:"position-relative"},Yt={class:"row g-3 mt-4"},Zt={class:"col-3"},Gt={class:"text-center p-3 bg-light-success rounded"},Xt={class:"fs-2 fw-bold text-success"},te={class:"col-3"},ee={class:"text-center p-3 bg-light-warning rounded"},se={class:"fs-2 fw-bold text-warning"},ae={class:"col-3"},ne={class:"text-center p-3 bg-light-danger rounded"},oe={class:"fs-2 fw-bold text-danger"},le={class:"col-3"},ie={class:"text-center p-3 bg-light-primary rounded"},re={class:"fs-2 fw-bold text-primary"},de={class:"card card-flush shadow-sm border-0"},ce={class:"card-body p-6"},ue={key:0,class:"timeline timeline-border-dashed"},fe={class:"timeline-icon symbol symbol-30px"},me={class:"timeline-content ms-3"},ge={class:"d-flex align-items-center justify-content-between mb-1"},ve={class:"fs-6 fw-bold text-gray-900"},pe={class:"d-flex align-items-center gap-4 text-gray-600 fs-7"},be={key:0},he={key:1},ye={key:0,class:"fs-7 text-gray-500 mt-1 mb-0"},we={key:1,class:"text-center py-5"},_e={key:0,class:"modal fade",tabindex:"-1"},xe={class:"modal-dialog modal-lg modal-dialog-centered"},ke={class:"modal-content"},De={class:"modal-header border-0 pb-0"},Se={class:"modal-body"},Ie={class:"row g-3 mb-5"},Ce={class:"col-6"},Te={class:"col-6"},Ae={class:"table-responsive"},Oe={class:"table table-rounded table-striped border gy-7 gs-7"},Be={class:"fw-bold"},Ue={key:0,class:"text-center py-5"},Ne={class:"modal-footer border-0 pt-0"},Le={key:1,class:"d-flex justify-content-center align-items-center position-fixed top-0 start-0 w-100 h-100 bg-black bg-opacity-25",style:{"z-index":"9999"}},$e={class:"card shadow-lg border-0"},Ee={class:"card-body p-5 text-center"},Pe={class:"fs-6 fw-semibold text-gray-700 mb-0"},He="https://backend.cloudfuelstationmis.com/api/records/v1",Re={__name:"AttendaceOps",setup(je){var z;const G=localStorage.getItem("kigrama_auth_token")||"eyJ0eXAiOiJKV1QiLCJhbGciOiJFZERTQSJ9.demo_token",m=((z=c(JSON.parse(localStorage.getItem("kigrama_user_data")||"{}")))==null?void 0:z.user)||null,g=c(null),u=c(!1),k=c("Loading..."),$=c(""),E=c(""),w=c(""),I=c(!1),o=c(null),D=c([]),T=c([]),p=q({present:0,late:0,absent:0,avgHours:"0.0"}),A=c(null);let S=null;const _=q({startDate:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}),X=K(()=>o.value?o.value.TimeOut?"Clocked Out":"Clocked In":"Not Clocked In"),tt=K(()=>o.value?o.value.TimeOut?"badge-light-danger":"badge-light-success":"badge-light-warning"),P=()=>{const s=new Date;$.value=s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),E.value=s.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},h=async(s,e={})=>{try{const n=await fetch(`${He}${s}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${G}`,...e.headers},...e});if(!n.ok){const a=await n.json().catch(()=>({}));throw new Error(a.message||`API Error: ${n.status}`)}return await n.json()}catch(n){throw console.error("API Call Error:",n),n}},et=async()=>{var s;try{if(!((s=m.value)!=null&&s.id))return;const n=(await h(`/UserStations?UserID=${m.value.id}&IsPrimary=1`)).records||[];if(n.length>0){const a=await h(`/Stations/${n[0].StationID}`);g.value=a}}catch(e){console.error("Error loading user station:",e)}},H=async()=>{var s,e;try{if(!((s=m.value)!=null&&s.id)||!((e=g.value)!=null&&e.StationID))return;const n=new Date().toISOString().split("T")[0],d=(await h(`/Attendance?UserID=${m.value.id}&StationID=${g.value.StationID}&AttendanceDate=${n}`)).records||[];o.value=d.length>0?d[0]:null}catch(n){console.error("Error loading today attendance:",n)}},R=async()=>{var s,e;try{if(!((s=m.value)!=null&&s.id)||!((e=g.value)!=null&&e.StationID))return;const n=await h(`/Attendance?UserID=${m.value.id}&StationID=${g.value.StationID}&sort=-AttendanceDate&limit=10`);D.value=n.records||[]}catch(n){console.error("Error loading recent attendance:",n)}},j=()=>{const s=D.value.slice(0,7);p.present=s.filter(n=>n.Status==="Present").length,p.late=s.filter(n=>n.Status==="Late").length,p.absent=s.filter(n=>n.Status==="Absent").length;const e=s.reduce((n,a)=>{const d=parseFloat(V(a))||0;return n+d},0);p.avgHours=s.length>0?(e/s.length).toFixed(1):"0.0"},st=async()=>{try{if(!(await b.fire({title:"Clock In Confirmation",text:"Are you ready to start your shift?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, Clock In",cancelButtonText:"Cancel",confirmButtonColor:"#00a651",cancelButtonColor:"#f1416c"})).isConfirmed)return;u.value=!0,k.value="Clocking in...";const e={StationID:g.value.StationID,UserID:m.value.id,AttendanceDate:new Date().toISOString().split("T")[0],TimeIn:new Date().toISOString(),Status:"Present",Notes:w.value||null};await h("/Attendance",{method:"POST",body:JSON.stringify(e)}),await b.fire({title:"Clocked In Successfully!",text:"Have a great shift!",icon:"success",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1}),w.value="",await O()}catch(s){console.error("Clock in error:",s),await b.fire({title:"Clock In Failed",text:s.message||"Unable to clock in. Please try again.",icon:"error",confirmButtonColor:"#f1416c"})}finally{u.value=!1}},at=async()=>{try{if(!(await b.fire({title:"Clock Out Confirmation",text:"Are you ready to end your shift?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, Clock Out",cancelButtonText:"Cancel",confirmButtonColor:"#f1416c",cancelButtonColor:"#3699ff"})).isConfirmed)return;u.value=!0,k.value="Clocking out...";const e={TimeOut:new Date().toISOString(),Notes:w.value||o.value.Notes};await h(`/Attendance/${o.value.AttendanceID}`,{method:"PATCH",body:JSON.stringify(e)}),await b.fire({title:"Clocked Out Successfully!",text:"Thanks for your hard work today!",icon:"success",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1}),w.value="",await O()}catch(s){console.error("Clock out error:",s),await b.fire({title:"Clock Out Failed",text:s.message||"Unable to clock out. Please try again.",icon:"error",confirmButtonColor:"#f1416c"})}finally{u.value=!1}},F=async()=>{var s,e;try{if(!((s=m.value)!=null&&s.id)||!((e=g.value)!=null&&e.StationID))return;let a=(await h(`/Attendance?UserID=${m.value.id}&StationID=${g.value.StationID}&sort=-AttendanceDate`)).records||[];a=a.filter(d=>{const f=d.AttendanceDate;return f>=_.startDate&&f<=_.endDate}),T.value=a}catch(n){console.error("Error loading attendance history:",n)}},J=async()=>{if(A.value)try{const{Chart:s,registerables:e}=await mt(async()=>{const{Chart:f,registerables:x}=await import("https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js");return{Chart:f,registerables:x}},[]);s.register(...e);const n=A.value.getContext("2d"),a=[],d=[];for(let f=6;f>=0;f--){const x=new Date;x.setDate(x.getDate()-f);const lt=x.toISOString().split("T")[0];a.push(x.toLocaleDateString("en-US",{weekday:"short"}));const it=D.value.find(rt=>rt.AttendanceDate===lt);d.push(it?1:0)}S=new s(n,{type:"bar",data:{labels:a,datasets:[{label:"Attendance",data:d,backgroundColor:["#00a651","#00a651","#00a651","#00a651","#00a651","#ffc700","#f1416c"],borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,max:1,ticks:{stepSize:1,callback:function(f){return f===1?"Present":"Absent"}}},x:{grid:{display:!1}}}}})}catch(s){console.error("Error creating chart:",s)}},y=s=>s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):null,M=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",nt=()=>{var d;if(!((d=o.value)!=null&&d.TimeIn))return"0.0 hrs";const s=new Date(o.value.TimeIn);return`${(((o.value.TimeOut?new Date(o.value.TimeOut):new Date)-s)/(1e3*60*60)).toFixed(1)} hrs`},V=s=>{if(!s.TimeIn||!s.TimeOut)return"0.0";const e=new Date(s.TimeIn);return((new Date(s.TimeOut)-e)/(1e3*60*60)).toFixed(1)},ot=s=>{switch(s){case"Present":return"bg-success";case"Late":return"bg-warning";case"Absent":return"bg-danger";default:return"bg-secondary"}},W=s=>{switch(s){case"Present":return"badge-light-success";case"Late":return"badge-light-warning";case"Absent":return"badge-light-danger";default:return"badge-light-secondary"}},O=async()=>{u.value=!0,k.value="Refreshing data...";try{await H(),await R(),j(),S&&S.destroy(),await Q(),await J(),await b.fire({title:"Data Refreshed",icon:"success",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})}catch(s){console.error("Error refreshing data:",s)}finally{u.value=!1}};let B=null;return ct(async()=>{u.value=!0,k.value="Loading attendance data...";try{P(),B=setInterval(P,1e3),await et(),await H(),await R(),j(),await Q(),await J()}catch(s){console.error("Error loading initial data:",s),await b.fire({title:"Loading Error",text:"Unable to load attendance data. Please refresh the page.",icon:"error",confirmButtonColor:"#f1416c"})}finally{u.value=!1}}),ut(()=>{B&&clearInterval(B),S&&S.destroy()}),(s,e)=>{var n;return r(),i("div",gt,[t("div",vt,[t("div",pt,[t("div",bt,[t("div",ht,[e[7]||(e[7]=ft('<div class="symbol symbol-45px bg-light-primary" data-v-9a083cec><i class="ki-duotone ki-timer fs-2 text-primary" data-v-9a083cec><span class="path1" data-v-9a083cec></span><span class="path2" data-v-9a083cec></span><span class="path3" data-v-9a083cec></span></i></div>',1)),t("div",null,[e[6]||(e[6]=t("h2",{class:"fs-2 fw-bold text-gray-900 mb-0"},"Staff Attendance",-1)),t("p",yt,l(((n=g.value)==null?void 0:n.StationName)||"Loading..."),1)])]),t("div",wt,[t("button",{class:"btn btn-sm btn-light-info",onClick:O},e[8]||(e[8]=[t("i",{class:"ki-duotone ki-arrows-circle fs-3"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)])),t("button",{class:"btn btn-sm btn-light-warning",onClick:e[0]||(e[0]=a=>I.value=!0)},e[9]||(e[9]=[t("i",{class:"ki-duotone ki-calendar fs-3"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),U(" History ")]))])]),t("div",_t,[t("div",xt,[t("div",kt,[t("div",null,[t("h3",Dt,l($.value),1),t("p",St,l(E.value),1)]),t("div",It,[t("div",{class:C(["badge",tt.value])},l(X.value),3),o.value?(r(),i("p",Ct,l(y(o.value.TimeIn)),1)):v("",!0)])])])])])]),t("div",Tt,[t("div",At,[e[20]||(e[20]=t("h3",{class:"fs-4 fw-bold text-gray-900 mb-5"},"Clock Management",-1)),t("div",Ot,[t("div",Bt,[t("button",{class:"btn btn-lg btn-light-success w-100 h-75px d-flex flex-column justify-content-center",onClick:st,disabled:u.value||o.value&&o.value.TimeIn},e[10]||(e[10]=[t("i",{class:"ki-duotone ki-entrance-right fs-2x text-success mb-2"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),t("span",{class:"fw-bold"},"Clock In",-1)]),8,Ut)]),t("div",Nt,[t("button",{class:"btn btn-lg btn-light-danger w-100 h-75px d-flex flex-column justify-content-center",onClick:at,disabled:u.value||!o.value||o.value.TimeOut},e[11]||(e[11]=[t("i",{class:"ki-duotone ki-entrance-left fs-2x text-danger mb-2"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),t("span",{class:"fw-bold"},"Clock Out",-1)]),8,Lt)])]),o.value&&o.value.TimeIn&&!o.value.TimeOut?(r(),i("div",$t,[e[12]||(e[12]=t("label",{class:"form-label fs-6 fw-semibold"},"Add Notes (Optional)",-1)),N(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>w.value=a),class:"form-control form-control-lg",rows:"3",placeholder:"Add any relevant notes about your shift..."},null,512),[[L,w.value]])])):v("",!0),o.value?(r(),i("div",Et,[t("div",Pt,[e[18]||(e[18]=t("h5",{class:"fs-5 fw-bold text-info mb-3"},"Today's Summary",-1)),t("div",Ht,[t("div",Rt,[t("div",jt,[e[14]||(e[14]=t("i",{class:"ki-duotone ki-time fs-3 text-success"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),t("div",null,[e[13]||(e[13]=t("p",{class:"fs-7 text-gray-600 mb-0"},"Time In",-1)),t("p",Ft,l(y(o.value.TimeIn)||"--:--"),1)])])]),t("div",Jt,[t("div",Mt,[e[16]||(e[16]=t("i",{class:"ki-duotone ki-time fs-3 text-danger"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),t("div",null,[e[15]||(e[15]=t("p",{class:"fs-7 text-gray-600 mb-0"},"Time Out",-1)),t("p",Vt,l(y(o.value.TimeOut)||"--:--"),1)])])])]),e[19]||(e[19]=t("div",{class:"separator my-3"},null,-1)),t("div",Wt,[e[17]||(e[17]=t("span",{class:"fs-6 text-gray-600"},"Hours Worked:",-1)),t("span",zt,l(nt()),1)])])])):v("",!0)])]),t("div",qt,[t("div",Kt,[e[25]||(e[25]=t("div",{class:"d-flex align-items-center justify-content-between mb-5"},[t("h3",{class:"fs-4 fw-bold text-gray-900 mb-0"},"Weekly Attendance"),t("div",{class:"badge badge-light-primary fs-7"},"Last 7 Days")],-1)),t("div",Qt,[t("canvas",{ref_key:"attendanceChart",ref:A,class:"mh-300px"},null,512)]),t("div",Yt,[t("div",Zt,[t("div",Gt,[t("div",Xt,l(p.present),1),e[21]||(e[21]=t("div",{class:"fs-7 text-gray-600"},"Present",-1))])]),t("div",te,[t("div",ee,[t("div",se,l(p.late),1),e[22]||(e[22]=t("div",{class:"fs-7 text-gray-600"},"Late",-1))])]),t("div",ae,[t("div",ne,[t("div",oe,l(p.absent),1),e[23]||(e[23]=t("div",{class:"fs-7 text-gray-600"},"Absent",-1))])]),t("div",le,[t("div",ie,[t("div",re,l(p.avgHours),1),e[24]||(e[24]=t("div",{class:"fs-7 text-gray-600"},"Avg Hours",-1))])])])])]),t("div",de,[t("div",ce,[e[31]||(e[31]=t("h3",{class:"fs-4 fw-bold text-gray-900 mb-5"},"Recent Records",-1)),D.value.length>0?(r(),i("div",ue,[(r(!0),i(Y,null,Z(D.value.slice(0,5),a=>(r(),i("div",{class:"timeline-item",key:a.AttendanceID},[e[29]||(e[29]=t("div",{class:"timeline-line w-2px"},null,-1)),t("div",fe,[t("div",{class:C(["symbol-label",ot(a.Status)])},e[26]||(e[26]=[t("i",{class:"ki-duotone ki-check fs-5 text-white"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)]),2)]),t("div",me,[t("div",ge,[t("span",ve,l(M(a.AttendanceDate)),1),t("div",{class:C(["badge",W(a.Status)])},l(a.Status),3)]),t("div",pe,[a.TimeIn?(r(),i("span",be,[e[27]||(e[27]=t("i",{class:"ki-duotone ki-entrance-right fs-6 text-success me-1"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),U(" "+l(y(a.TimeIn)),1)])):v("",!0),a.TimeOut?(r(),i("span",he,[e[28]||(e[28]=t("i",{class:"ki-duotone ki-entrance-left fs-6 text-danger me-1"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),U(" "+l(y(a.TimeOut)),1)])):v("",!0)]),a.Notes?(r(),i("p",ye,l(a.Notes),1)):v("",!0)])]))),128))])):(r(),i("div",we,e[30]||(e[30]=[t("i",{class:"ki-duotone ki-file-deleted fs-3x text-gray-400 mb-3"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),t("p",{class:"fs-6 text-gray-600"},"No attendance records found",-1)])))])]),I.value?(r(),i("div",_e,[t("div",xe,[t("div",ke,[t("div",De,[e[32]||(e[32]=t("h3",{class:"modal-title fs-4 fw-bold"},"Attendance History",-1)),t("button",{type:"button",class:"btn-close",onClick:e[2]||(e[2]=a=>I.value=!1)})]),t("div",Se,[t("div",Ie,[t("div",Ce,[e[33]||(e[33]=t("label",{class:"form-label fs-6 fw-semibold"},"From Date",-1)),N(t("input",{type:"date",class:"form-control form-control-lg","onUpdate:modelValue":e[3]||(e[3]=a=>_.startDate=a),onChange:F},null,544),[[L,_.startDate]])]),t("div",Te,[e[34]||(e[34]=t("label",{class:"form-label fs-6 fw-semibold"},"To Date",-1)),N(t("input",{type:"date",class:"form-control form-control-lg","onUpdate:modelValue":e[4]||(e[4]=a=>_.endDate=a),onChange:F},null,544),[[L,_.endDate]])])]),t("div",Ae,[t("table",Oe,[e[35]||(e[35]=t("thead",null,[t("tr",{class:"fw-semibold fs-6 text-gray-800 border-bottom-2 border-gray-200"},[t("th",null,"Date"),t("th",null,"Time In"),t("th",null,"Time Out"),t("th",null,"Hours"),t("th",null,"Status")])],-1)),t("tbody",null,[(r(!0),i(Y,null,Z(T.value,a=>(r(),i("tr",{key:a.AttendanceID},[t("td",Be,l(M(a.AttendanceDate)),1),t("td",null,l(y(a.TimeIn)||"--:--"),1),t("td",null,l(y(a.TimeOut)||"--:--"),1),t("td",null,l(V(a)),1),t("td",null,[t("div",{class:C(["badge",W(a.Status)])},l(a.Status),3)])]))),128))])])]),T.value.length===0?(r(),i("div",Ue,e[36]||(e[36]=[t("i",{class:"ki-duotone ki-file-deleted fs-3x text-gray-400 mb-3"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),t("p",{class:"fs-6 text-gray-600"},"No records found for selected period",-1)]))):v("",!0)]),t("div",Ne,[t("button",{type:"button",class:"btn btn-light-primary",onClick:e[5]||(e[5]=a=>I.value=!1)}," Close ")])])])])):v("",!0),u.value?(r(),i("div",Le,[t("div",$e,[t("div",Ee,[e[37]||(e[37]=t("div",{class:"spinner-border text-primary mb-3",role:"status"},null,-1)),t("p",Pe,l(k.value),1)])])])):v("",!0)])}}},Je=dt(Re,[["__scopeId","data-v-9a083cec"]]);export{Je as default};
