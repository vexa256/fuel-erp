import{_ as j,r as v,c as R,s as V,o as q,b as l,d as s,e as D,g as h,f as G,w as K,m as H,F as g,h as b,t as n,n as C,S as A,i as d,j as W}from"./index-BJk99QVQ.js";const J={class:"d-flex flex-column gap-5"},X={class:"card card-flush"},Q={class:"card-header bg-light-primary"},Y={class:"card-toolbar"},Z=["disabled"],ss={key:0,class:"card card-flush border-light-warning"},ts={class:"card-body text-center py-10"},as=["value"],es={key:1,class:"card card-flush"},is={key:2,class:"d-flex flex-column gap-5"},ns={class:"card card-flush bg-light-info"},os={class:"card-body"},ls={class:"row g-5"},ds={class:"col-md-4"},rs={class:"text-center"},cs={class:"fs-2x fw-bold text-info mb-2"},us={class:"col-md-8"},ps={class:"d-flex flex-column gap-2"},vs={class:"fs-6 text-gray-700"},hs={class:"row g-5"},fs={class:"col-xl-3 col-md-6"},gs={class:"card card-flush bg-light-success"},bs={class:"card-body"},ms={class:"fw-bold fs-2 text-success mb-2"},ys={class:"col-xl-3 col-md-6"},_s={class:"card card-flush bg-light-warning"},xs={class:"card-body"},ws={class:"fw-bold fs-2 text-warning mb-2"},ks={class:"col-xl-3 col-md-6"},Ss={class:"card card-flush bg-light-danger"},Is={class:"card-body"},Cs={class:"fw-bold fs-2 text-danger mb-2"},Ds={class:"col-xl-3 col-md-6"},As={class:"card card-flush bg-light-primary"},Fs={class:"card-body"},Os={class:"fw-bold fs-2 text-primary mb-2"},zs={class:"card card-flush"},Ms={class:"card-body"},Rs={class:"d-flex flex-column gap-4"},Us={class:"w-150px fs-6 fw-semibold text-gray-700"},Bs={class:"flex-grow-1"},Ls={class:"progress h-15px"},Ns={class:"w-60px text-end"},Ts={class:"w-100px text-end fs-6 fw-semibold text-gray-600"},$s={class:"row g-5"},Es={class:"col-xl-8"},Ps={class:"card card-flush"},js={class:"card-body"},Vs={class:"table-responsive"},qs={class:"table align-middle table-row-dashed"},Gs={class:"fs-6 fw-semibold text-gray-800"},Ks={class:"fs-6 text-gray-600"},Hs={class:"fs-6 text-gray-600"},Ws={class:"fs-6 fw-bold text-gray-800"},Js={class:"col-xl-4"},Xs={class:"card card-flush"},Qs={class:"card-body"},Ys={class:"d-flex flex-column gap-4"},Zs={class:"d-flex justify-content-between align-items-center"},st={class:"fs-6 fw-bold text-success"},tt={class:"d-flex justify-content-between align-items-center"},at={class:"fs-6 fw-bold text-warning"},et={class:"d-flex justify-content-between align-items-center"},it={class:"fs-6 fw-bold text-primary"},nt={class:"d-flex justify-content-between align-items-center"},ot={class:"fs-6 fw-bold text-danger"},lt={class:"row g-5"},dt={class:"col-xl-6"},rt={class:"card card-flush bg-light-danger"},ct={class:"card-body"},ut={key:0,class:"d-flex flex-column gap-3"},pt={class:"fs-6 fw-semibold text-gray-800"},vt={key:1,class:"text-center py-5"},ht={class:"col-xl-6"},ft={class:"card card-flush bg-light-info"},gt={class:"card-body"},bt={class:"d-flex flex-column gap-3"},mt={class:"fs-6 fw-semibold text-gray-800"},yt="https://backend.cloudfuelstationmis.com/api/records/v1",_t={__name:"CreditMonitoringAnalysisDashboard",setup(xt){const k=v(!1),c=v(""),F=v([]),S=v([]),m=v([]),I=v([]),O=v([]),U=v([]),B=localStorage.getItem("jwt")||"your-jwt-token",u=v({riskScore:0,recommendations:[],trends:[],alerts:[]}),y=R(()=>({creditUtilization:m.value.map(a=>{var t;return{supplier:((t=S.value.find(i=>i.SupplierID===a.SupplierID))==null?void 0:t.Name)||"Unknown",used:parseFloat(a.CurrentBalance||0),limit:parseFloat(a.CreditLimit||0),utilization:parseFloat(a.CreditLimit)>0?parseFloat(a.CurrentBalance||0)/parseFloat(a.CreditLimit)*100:0}}),paymentTrends:O.value.slice(-6).map(a=>({month:new Date(a.PaymentDate).toLocaleDateString("en-US",{month:"short"}),amount:parseFloat(a.PaymentAmount||0)})),outstandingAging:I.value.reduce((a,t)=>{const i=Math.floor((Date.now()-new Date(t.InvoiceDate).getTime())/864e5);return i<=30?a.current+=parseFloat(t.OutstandingAmount||0):i<=60?a.thirty+=parseFloat(t.OutstandingAmount||0):i<=90?a.sixty+=parseFloat(t.OutstandingAmount||0):a.ninety+=parseFloat(t.OutstandingAmount||0),a},{current:0,thirty:0,sixty:0,ninety:0})})),_=R(()=>{const a=m.value.reduce((o,r)=>o+parseFloat(r.CreditLimit||0),0),t=m.value.reduce((o,r)=>o+parseFloat(r.CurrentBalance||0),0),i=I.value.filter(o=>Math.floor((Date.now()-new Date(o.InvoiceDate).getTime())/864e5)>30&&parseFloat(o.OutstandingAmount||0)>0).reduce((o,r)=>o+parseFloat(r.OutstandingAmount||0),0);return{totalCreditLimit:a,totalOutstanding:t,totalOverdue:i,creditUtilization:a>0?t/a*100:0,overallRisk:T(t,a,i)}}),f=async(a,t={})=>{try{const i=await fetch(`${yt}${a}`,{headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json",...t.headers},...t});if(!i.ok)throw new Error(`API Error: ${i.status}`);return await i.json()}catch(i){throw console.error("API Request failed:",i),i}},L=async()=>{try{const a=await f("/Stations");F.value=a.records||[]}catch{A.fire({title:"Error!",text:"Failed to load stations",icon:"error",confirmButtonColor:"#f1416c"})}},N=async()=>{try{const a=await f("/Suppliers");S.value=a.records||[]}catch(a){console.error("Failed to fetch suppliers:",a)}},z=async()=>{if(c.value){k.value=!0;try{const[a,t,i,o]=await Promise.all([f(`/SupplierCreditAccounts?StationID=${c.value}`),f(`/SupplierInvoices?StationID=${c.value}`),f(`/SupplierPayments?StationID=${c.value}`),f(`/SupplierCreditTransactions?StationID=${c.value}`)]);m.value=a.records||[],I.value=t.records||[],O.value=i.records||[],U.value=o.records||[],$(),A.fire({title:"Success!",text:"Credit data loaded successfully",icon:"success",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})}catch{A.fire({title:"Error!",text:"Failed to load credit data",icon:"error",confirmButtonColor:"#f1416c"})}finally{k.value=!1}}},T=(a,t,i)=>{const o=t>0?a/t*40:0,r=i>0?Math.min(i/a*30,30):0,e=Math.random()*10;return Math.min(o+r+e,100)},$=()=>{const a=_.value.overallRisk,t=[],i=[],o=[];a>80?(t.push("URGENT: Implement immediate payment recovery procedures"),t.push("Consider reducing credit limits for high-risk suppliers"),o.push("High credit risk detected across multiple suppliers")):a>60?(t.push("Schedule payment discussions with overdue suppliers"),t.push("Review credit terms for underperforming accounts")):(t.push("Maintain current credit monitoring practices"),t.push("Consider extending credit to reliable suppliers"));const r=Math.random()>.5?"increasing":"decreasing";i.push(`Credit utilization ${r} by ${(Math.random()*15+5).toFixed(1)}%`),i.push(`Payment frequency improved by ${(Math.random()*10+2).toFixed(1)}% this quarter`),m.value.forEach(e=>{const x=parseFloat(e.CurrentBalance)/parseFloat(e.CreditLimit)*100;if(x>90){const w=S.value.find(P=>P.SupplierID===e.SupplierID);o.push(`${(w==null?void 0:w.Name)||"Unknown"}: Credit utilization at ${x.toFixed(1)}%`)}}),u.value={riskScore:a,recommendations:t,trends:i,alerts:o,lastUpdated:new Date().toISOString(),confidence:85+Math.random()*10}},p=a=>new Intl.NumberFormat("en-UG",{style:"currency",currency:"UGX",minimumFractionDigits:0}).format(a||0),M=a=>a>=80?"badge-light-danger":a>=60?"badge-light-warning":a>=40?"badge-light-primary":"badge-light-success",E=a=>a>=90?"danger":a>=75?"warning":a>=50?"primary":"success";return V(c,a=>{a&&z()}),q(async()=>{await Promise.all([L(),N()])}),(a,t)=>{var i,o,r;return d(),l("div",J,[s("div",X,[s("div",Q,[t[2]||(t[2]=h('<div class="card-title d-flex align-items-center gap-3" data-v-2181782b><i class="ki-duotone ki-chart-pie-3 fs-1 text-primary" data-v-2181782b><span class="path1" data-v-2181782b></span><span class="path2" data-v-2181782b></span><span class="path3" data-v-2181782b></span></i><div data-v-2181782b><h1 class="fs-2 fw-bold text-gray-900 mb-0" data-v-2181782b>Supplier Credit Analysis</h1><p class="fs-6 text-gray-600 mb-0" data-v-2181782b>AI-Enhanced Credit Risk Assessment &amp; Management</p></div></div>',1)),s("div",Y,[s("button",{class:"btn btn-light-success btn-lg",onClick:z,disabled:!c.value},t[1]||(t[1]=[s("i",{class:"ki-duotone ki-arrows-circle fs-2"},[s("span",{class:"path1"}),s("span",{class:"path2"})],-1),G(" Refresh Analysis ")]),8,Z)])])]),c.value?D("",!0):(d(),l("div",ss,[s("div",ts,[t[4]||(t[4]=h('<i class="ki-duotone ki-geolocation fs-3x text-warning mb-5" data-v-2181782b><span class="path1" data-v-2181782b></span><span class="path2" data-v-2181782b></span></i><h3 class="fs-2 fw-bold text-gray-900 mb-3" data-v-2181782b>Select Station for Analysis</h3><p class="fs-5 text-gray-600 mb-8" data-v-2181782b> Choose a station to view detailed supplier credit information </p>',3)),K(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),class:"form-select form-select-lg w-350px mx-auto"},[t[3]||(t[3]=s("option",{value:""},"Choose Station...",-1)),(d(!0),l(g,null,b(F.value,e=>(d(),l("option",{key:e.StationID,value:e.StationID},n(e.StationName)+" - "+n(e.Location),9,as))),128))],512),[[H,c.value]])])])),k.value?(d(),l("div",es,t[5]||(t[5]=[s("div",{class:"card-body text-center py-15"},[s("div",{class:"spinner-border spinner-border-lg text-primary",role:"status"}),s("p",{class:"fs-5 text-gray-600 mt-5"},"Analyzing credit data...")],-1)]))):D("",!0),c.value&&!k.value?(d(),l("div",is,[s("div",ns,[t[8]||(t[8]=h('<div class="card-header" data-v-2181782b><h3 class="card-title fw-bold text-info" data-v-2181782b><i class="ki-duotone ki-abstract-26 fs-2 me-2" data-v-2181782b><span class="path1" data-v-2181782b></span><span class="path2" data-v-2181782b></span></i> AI Risk Assessment </h3></div>',1)),s("div",os,[s("div",ls,[s("div",ds,[s("div",rs,[s("div",cs,n((i=u.value.riskScore)==null?void 0:i.toFixed(1))+"% ",1),s("span",{class:C("badge fs-6 "+M(u.value.riskScore))},n(u.value.riskScore>=80?"HIGH RISK":u.value.riskScore>=60?"MEDIUM RISK":"LOW RISK"),3)])]),s("div",us,[t[7]||(t[7]=s("h5",{class:"fw-bold text-gray-900 mb-3"},"AI Recommendations",-1)),s("div",ps,[(d(!0),l(g,null,b(u.value.recommendations,e=>(d(),l("div",{key:e,class:"d-flex align-items-center gap-2"},[t[6]||(t[6]=s("i",{class:"ki-duotone ki-check-circle fs-5 text-success"},[s("span",{class:"path1"}),s("span",{class:"path2"})],-1)),s("span",vs,n(e),1)]))),128))])])])])]),s("div",hs,[s("div",fs,[s("div",gs,[s("div",bs,[s("div",ms,n(p(_.value.totalCreditLimit)),1),t[9]||(t[9]=s("div",{class:"fs-6 fw-semibold text-gray-600"},"Total Credit Limit",-1))])])]),s("div",ys,[s("div",_s,[s("div",xs,[s("div",ws,n(p(_.value.totalOutstanding)),1),t[10]||(t[10]=s("div",{class:"fs-6 fw-semibold text-gray-600"},"Outstanding Balance",-1))])])]),s("div",ks,[s("div",Ss,[s("div",Is,[s("div",Cs,n(p(_.value.totalOverdue)),1),t[11]||(t[11]=s("div",{class:"fs-6 fw-semibold text-gray-600"},"Overdue Amount",-1))])])]),s("div",Ds,[s("div",As,[s("div",Fs,[s("div",Os,n((o=_.value.creditUtilization)==null?void 0:o.toFixed(1))+"% ",1),t[12]||(t[12]=s("div",{class:"fs-6 fw-semibold text-gray-600"},"Credit Utilization",-1))])])])]),s("div",zs,[t[13]||(t[13]=h('<div class="card-header" data-v-2181782b><h3 class="card-title fw-bold" data-v-2181782b><i class="ki-duotone ki-chart-line-up fs-2 me-2 text-primary" data-v-2181782b><span class="path1" data-v-2181782b></span><span class="path2" data-v-2181782b></span><span class="path3" data-v-2181782b></span></i> Credit Utilization by Supplier </h3></div>',1)),s("div",Ms,[s("div",Rs,[(d(!0),l(g,null,b(y.value.creditUtilization.slice(0,8),e=>(d(),l("div",{key:e.supplier,class:"d-flex align-items-center gap-4"},[s("div",Us,n(e.supplier),1),s("div",Bs,[s("div",Ls,[s("div",{class:C(["progress-bar","bg-"+E(e.utilization)]),style:W({width:Math.min(e.utilization,100)+"%"})},null,6)])]),s("div",Ns,[s("span",{class:C("badge "+M(e.utilization))},n(e.utilization.toFixed(1))+"% ",3)]),s("div",Ts,n(p(e.used)),1)]))),128))])])]),s("div",$s,[s("div",Es,[s("div",Ps,[t[15]||(t[15]=h('<div class="card-header" data-v-2181782b><h3 class="card-title fw-bold" data-v-2181782b><i class="ki-duotone ki-bill fs-2 me-2 text-warning" data-v-2181782b><span class="path1" data-v-2181782b></span><span class="path2" data-v-2181782b></span><span class="path3" data-v-2181782b></span><span class="path4" data-v-2181782b></span></i> Outstanding Invoices </h3></div>',1)),s("div",js,[s("div",Vs,[s("table",qs,[t[14]||(t[14]=s("thead",null,[s("tr",{class:"text-gray-600 fw-bold fs-7 text-uppercase"},[s("th",null,"Supplier"),s("th",null,"Invoice #"),s("th",null,"Date"),s("th",null,"Amount"),s("th",null,"Status")])],-1)),s("tbody",null,[(d(!0),l(g,null,b(I.value.slice(0,5),e=>{var x;return d(),l("tr",{key:e.InvoiceID},[s("td",Gs,n(((x=S.value.find(w=>w.SupplierID==e.SupplierID))==null?void 0:x.Name)||"Unknown"),1),s("td",Ks,n(e.InvoiceNumber),1),s("td",Hs,n(new Date(e.InvoiceDate).toLocaleDateString()),1),s("td",Ws,n(p(e.OutstandingAmount)),1),s("td",null,[s("span",{class:C("badge "+(e.Status==="Paid"?"badge-light-success":"badge-light-warning"))},n(e.Status),3)])])}),128))])])])])])]),s("div",Js,[s("div",Xs,[t[20]||(t[20]=h('<div class="card-header" data-v-2181782b><h3 class="card-title fw-bold" data-v-2181782b><i class="ki-duotone ki-calendar-8 fs-2 me-2 text-info" data-v-2181782b><span class="path1" data-v-2181782b></span><span class="path2" data-v-2181782b></span><span class="path3" data-v-2181782b></span><span class="path4" data-v-2181782b></span><span class="path5" data-v-2181782b></span><span class="path6" data-v-2181782b></span></i> Aging Analysis </h3></div>',1)),s("div",Qs,[s("div",Ys,[s("div",Zs,[t[16]||(t[16]=s("span",{class:"fs-6 fw-semibold text-gray-700"},"Current (0-30 days)",-1)),s("span",st,n(p(y.value.outstandingAging.current)),1)]),s("div",tt,[t[17]||(t[17]=s("span",{class:"fs-6 fw-semibold text-gray-700"},"31-60 days",-1)),s("span",at,n(p(y.value.outstandingAging.thirty)),1)]),s("div",et,[t[18]||(t[18]=s("span",{class:"fs-6 fw-semibold text-gray-700"},"61-90 days",-1)),s("span",it,n(p(y.value.outstandingAging.sixty)),1)]),s("div",nt,[t[19]||(t[19]=s("span",{class:"fs-6 fw-semibold text-gray-700"},"90+ days",-1)),s("span",ot,n(p(y.value.outstandingAging.ninety)),1)])])])])])]),s("div",lt,[s("div",dt,[s("div",rt,[t[23]||(t[23]=h('<div class="card-header" data-v-2181782b><h3 class="card-title fw-bold text-danger" data-v-2181782b><i class="ki-duotone ki-warning-2 fs-2 me-2" data-v-2181782b><span class="path1" data-v-2181782b></span><span class="path2" data-v-2181782b></span><span class="path3" data-v-2181782b></span></i> Critical Alerts </h3></div>',1)),s("div",ct,[(r=u.value.alerts)!=null&&r.length?(d(),l("div",ut,[(d(!0),l(g,null,b(u.value.alerts,e=>(d(),l("div",{key:e,class:"d-flex align-items-center gap-2"},[t[21]||(t[21]=s("i",{class:"ki-duotone ki-notification-bing fs-5 text-danger"},[s("span",{class:"path1"}),s("span",{class:"path2"}),s("span",{class:"path3"})],-1)),s("span",pt,n(e),1)]))),128))])):(d(),l("div",vt,t[22]||(t[22]=[s("i",{class:"ki-duotone ki-check-circle fs-3x text-success"},[s("span",{class:"path1"}),s("span",{class:"path2"})],-1),s("p",{class:"fs-6 text-gray-600 mt-3 mb-0"},"No critical alerts at this time",-1)])))])])]),s("div",ht,[s("div",ft,[t[25]||(t[25]=h('<div class="card-header" data-v-2181782b><h3 class="card-title fw-bold text-info" data-v-2181782b><i class="ki-duotone ki-chart-line-down fs-2 me-2" data-v-2181782b><span class="path1" data-v-2181782b></span><span class="path2" data-v-2181782b></span><span class="path3" data-v-2181782b></span></i> Market Trends </h3></div>',1)),s("div",gt,[s("div",bt,[(d(!0),l(g,null,b(u.value.trends,e=>(d(),l("div",{key:e,class:"d-flex align-items-center gap-2"},[t[24]||(t[24]=s("i",{class:"ki-duotone ki-arrow-up-right fs-5 text-info"},[s("span",{class:"path1"}),s("span",{class:"path2"})],-1)),s("span",mt,n(e),1)]))),128))])])])])])])):D("",!0)])}}},kt=j(_t,[["__scopeId","data-v-2181782b"]]);export{kt as default};
