import{_ as et,r as B,c as te,a as W,o as tt,k as Ae,S,l as st,b as d,d as e,g as U,e as w,n as x,f as $,t as l,w as D,v as P,m as oe,F as Ee,h as Ie,p as J,q as Oe,i as u}from"./index-BJk99QVQ.js";const at={class:"d-flex flex-column gap-5 h-100"},ot={class:"card card-flush shadow-sm"},nt={class:"card-header pt-7 pb-4"},rt={class:"card-toolbar"},it={class:"d-flex align-items-center gap-3"},lt={key:1,class:"badge badge-light-info fs-7 fw-bold px-3 py-2"},ct={key:2,class:"badge badge-light-warning fs-7 fw-bold px-3 py-2"},dt={key:3,class:"badge badge-light-danger fs-7 fw-bold px-3 py-2"},ut={class:"badge badge-light-success fs-7 fw-bold px-3 py-2"},pt=["disabled"],ft={class:"card card-flush shadow-sm flex-grow-1"},vt={class:"card-body p-0"},ht={class:"stepper stepper-pills stepper-column d-flex flex-column flex-xl-row flex-row-fluid gap-10",id:"kt_create_account_stepper"},mt={class:"card d-flex justify-content-center justify-content-xl-start flex-row-auto w-100 w-xl-300px w-xxl-400px border-0"},gt={class:"card-body px-6 px-lg-10 px-xxl-15 py-20"},yt={class:"stepper-nav"},wt={class:"card d-flex flex-row-fluid flex-center"},bt={class:"card-body py-20 w-100 mw-xl-700px px-9"},xt={key:0,class:"current"},Ct={class:"w-100"},St={key:0,class:"d-flex flex-column align-items-center py-10"},_t={class:"text-center"},kt={class:"text-gray-700 mb-2"},Dt={class:"text-muted fs-7"},At={key:1,class:"row g-6"},Et={class:"col-12"},It={class:"card card-flush border border-primary h-xl-100"},Ot={class:"card-header bg-light-primary"},Tt={class:"card-title d-flex align-items-center"},Rt={class:"text-primary mb-1"},$t={class:"text-muted fs-7 fw-semibold"},Nt={key:0,class:"badge badge-success ms-2"},Bt={key:1,class:"badge badge-info ms-2"},Ut={key:2,class:"badge badge-warning ms-2"},Ft={class:"card-body"},Vt={class:"row g-4"},Pt={class:"col-md-3"},Ht={class:"fs-6 fw-bold text-gray-800"},Lt={class:"col-md-3"},Mt={class:"fs-6 fw-bold text-gray-800"},Gt={class:"col-md-3"},qt={class:"fs-6 fw-bold text-success"},zt={class:"col-md-3"},jt={class:"fs-6 fw-bold text-info"},Xt={class:"mt-6 p-4 bg-light-info rounded"},Yt={class:"d-flex align-items-center"},Kt={class:"text-muted fs-7 mb-0"},Wt={class:"mt-6 p-4 bg-light-success rounded"},Jt={class:"d-flex align-items-center"},Qt={class:"text-muted fs-7 mb-0"},Zt={key:0,class:"badge badge-primary ms-2"},es={key:0,class:"mt-6 p-4 bg-light-warning rounded border border-warning"},ts={class:"col-12"},ss={class:"card card-flush border border-gray-300"},as={class:"card-body"},os={key:2,class:"col-12"},ns={class:"text-center py-10"},rs={class:"text-muted fs-6"},is={key:1,class:"current"},ls={class:"w-100"},cs={class:"card bg-light-primary border border-primary mb-8"},ds={class:"card-body"},us={class:"card-title text-primary"},ps={class:"row g-4"},fs={class:"col-md-3"},vs={class:"fs-6 fw-bold text-gray-800"},hs={class:"col-md-3"},ms={class:"fs-6 fw-bold text-gray-800"},gs={class:"col-md-3"},ys={class:"fs-6 fw-bold text-success"},ws={class:"col-md-3"},bs={class:"fs-6 fw-bold text-info"},xs={class:"card card-flush"},Cs={class:"card-body"},Ss={class:"row g-6"},_s={class:"col-md-6"},ks=["disabled"],Ds={key:0,class:"invalid-feedback"},As={key:1,class:"form-text text-warning"},Es={class:"col-md-6"},Is=["disabled"],Os={class:"mt-8 p-6 bg-light-info rounded border border-info"},Ts={class:"row g-4"},Rs={class:"col-md-3"},$s={class:"fs-5 fw-bold text-gray-800"},Ns={class:"col-md-3"},Bs={class:"fs-5 fw-bold text-primary"},Us={class:"col-md-3"},Fs={class:"fs-5 fw-bold text-warning"},Vs={class:"col-md-3"},Ps={key:0,class:"fs-6"},Hs={class:"d-flex align-items-center"},Ls={class:"mb-1"},Ms={class:"text-muted fs-7 mb-0"},Gs={class:"mt-8"},qs={class:"card card-flush border border-gray-300"},zs={class:"card-body"},js={key:2,class:"current"},Xs={class:"w-100"},Ys={class:"card-body"},Ks={class:"d-flex align-items-center"},Ws={class:"flex-grow-1"},Js={class:"mb-1"},Qs={class:"text-muted fs-6 mb-0"},Zs={class:"card card-flush"},ea={class:"card-body"},ta={class:"row g-6"},sa={class:"col-md-6"},aa=["disabled"],oa={key:0,class:"invalid-feedback"},na={class:"col-md-6"},ra=["disabled"],ia={key:0,class:"invalid-feedback"},la={class:"row g-6 mt-6"},ca={class:"col-12"},da=["disabled"],ua={key:0,class:"invalid-feedback"},pa={class:"row g-6 mt-6"},fa={class:"col-md-6"},va={class:"d-flex flex-wrap gap-2"},ha=["value","disabled"],ma={class:"form-check-label fs-7"},ga={class:"col-md-6"},ya={class:"d-flex flex-wrap gap-2"},wa=["value","disabled"],ba={class:"form-check-label fs-7"},xa={key:3,class:"current"},Ca={class:"w-100"},Sa={class:"card card-flush"},_a={class:"card-body"},ka={class:"row g-6"},Da={class:"col-12"},Aa=["disabled"],Ea={key:0,class:"invalid-feedback"},Ia={class:"row g-6 mt-6"},Oa={class:"col-md-6"},Ta=["disabled"],Ra={class:"col-md-6"},$a=["disabled"],Na={class:"row g-6 mt-6"},Ba={class:"col-12"},Ua=["disabled"],Fa={key:0,class:"invalid-feedback"},Va={key:0,class:"mt-8 p-6 bg-light-warning rounded border border-warning"},Pa={class:"row g-4"},Ha={class:"col-md-6"},La={class:"col-md-6"},Ma={key:4,class:"current"},Ga={class:"w-100"},qa={class:"card card-flush mb-8"},za={class:"card-body"},ja={class:"row g-6"},Xa={class:"col-md-4"},Ya={class:"card bg-light-info border border-info"},Ka={class:"card-body text-center"},Wa={class:"fs-4 fw-bold text-gray-800 mb-0"},Ja={class:"col-md-4"},Qa={class:"card bg-light-warning border border-warning"},Za={class:"card-body text-center"},eo={class:"fs-6 fw-bold text-gray-800 mb-0"},to={class:"col-md-4"},so={class:"card bg-light-success border border-success"},ao={class:"card-body text-center"},oo={class:"fs-6 fw-bold text-gray-800 mb-0"},no={key:0,class:"card card-flush"},ro={class:"card-body"},io={class:"row g-6"},lo={class:"col-12"},co={class:"form-check form-check-custom form-check-success"},uo={class:"col-12 mt-4"},po={class:"form-check form-check-custom form-check-success"},fo={class:"col-12 mt-4"},vo={class:"form-check form-check-custom form-check-success"},ho={class:"row g-6 mt-8"},mo={class:"col-12"},go={key:1,class:"card card-flush bg-light-warning"},yo={class:"d-flex flex-stack pt-10"},wo={class:"me-2"},bo=["disabled"],xo=["disabled"],Co=["disabled"],So="https://backend.cloudfuelstationmis.com/api/records/v1",_o={__name:"CashDrawerAndVariance",setup(ko){const Te=()=>{var s;try{const t=localStorage.getItem("kigrama_user_data"),a=t?JSON.parse(t):null;return(s=a==null?void 0:a.user)!=null&&s.id?a:(console.error("‚ùå Invalid auth data structure detected - missing user"),null)}catch(t){return console.error("‚ùå Error parsing auth data:",t),null}},Re=()=>{const s=localStorage.getItem("kigrama_auth_token");return s||console.error("‚ùå No authentication token found"),s||""},ne=B(Te()),_=te(()=>{var s;return(s=ne.value)==null?void 0:s.user}),N=B(!1),f=B(1),Q=B({online:!0}),H=B(!1),z=B(!1),j=B(""),V=B(""),v=B(null),n=B(null),k=W({actualCash:"",cashPayouts:"0"}),b=W({category:"",severity:"",explanation:"",factors:[],solutions:[]}),h=W({action:"",adjustmentAmount:"",referenceNumber:"",notes:"",supervisorPassword:"",authorizedBy:""}),A=W({confirmAccuracy:!1,confirmResolution:!1,confirmHandover:!1,finalComments:""}),m=W({actualCash:"",category:"",severity:"",explanation:"",action:"",resolutionNotes:""}),$e=["Busy shift period","New attendant","System glitch","Customer disputes","Change shortage","Training issues"],Ne=["Additional training","System upgrade","Process review","Supervision increase","Equipment check","Policy clarification"],C=te(()=>{var s;try{const t=parseFloat(((s=n.value)==null?void 0:s.ExpectedCash)||"0"),a=parseFloat(k.actualCash||"0"),o=parseFloat(k.cashPayouts||"0");if(isNaN(t)||isNaN(a)||isNaN(o))return console.warn("‚ö†Ô∏è Invalid numbers in variance calculation"),0;const r=a+o-t;return isNaN(r)?0:r}catch(t){return console.error("‚ùå Error calculating variance:",t),0}}),re=te(()=>{var s;try{if((s=n.value)!=null&&s.readOnly&&f.value>1)return!1;switch(f.value){case 1:return!!(n.value&&H.value);case 2:return!!(k.actualCash&&k.actualCash!==""&&n.value);case 3:return!!(b.category&&b.severity&&b.explanation&&n.value);case 4:return!!(h.action&&h.notes&&n.value);case 5:return!!n.value;default:return!1}}catch(t){return console.error("‚ùå Error in canProceed computed:",t),!1}}),ie=te(()=>{var s;try{return(s=n.value)!=null&&s.readOnly?!1:!!(A.confirmAccuracy&&A.confirmResolution&&A.confirmHandover&&n.value)}catch(t){return console.error("‚ùå Error in canComplete computed:",t),!1}}),E=async(s,t,a=null)=>{var o;try{const r=Re();if(!r)throw new Error("SECURITY_ERROR: No authentication token available");if(!((o=_.value)!=null&&o.id))throw new Error("SECURITY_ERROR: No authenticated user context");const i={method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}};a&&(s==="POST"||s==="PATCH")&&(i.body=JSON.stringify(a));const p=new AbortController,g=setTimeout(()=>p.abort(),3e4),O=await fetch(`${So}${t}`,{...i,signal:p.signal});if(clearTimeout(g),!O.ok){let I=`HTTP ${O.status}: ${O.statusText}`;try{const T=await O.json();I=T.message||T.error||I}catch(T){console.warn("‚ö†Ô∏è Could not parse error response:",T)}throw new Error(I)}return await O.json()}catch(r){throw r.name==="AbortError"?new Error("REQUEST_TIMEOUT: Please check your connection"):r.name==="TypeError"&&r.message.includes("fetch")?new Error("NETWORK_ERROR: Please check your connection"):r}},F=async(s,t,a=null)=>{var o,r,i;try{if(!((o=v.value)!=null&&o.StationID)||!((r=_.value)!=null&&r.id))return console.warn("‚ö†Ô∏è Cannot log security event: missing station or user info"),!1;const p={StationID:v.value.StationID,UserID:_.value.id,Action:`SECURITY_EVENT: ${s}`,TableName:"CashDrawers",RecordID:((i=n.value)==null?void 0:i.DrawerID)||null,Changes:JSON.stringify({level:s,details:t,data:a,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,sessionId:`${_.value.id}-${Date.now()}`}),IPAddress:"CLIENT_IP"};return await E("POST","/AuditLogs",p),console.log(`üîê Security event logged: ${s}`),!0}catch(p){return console.error("‚ùå Failed to log security event:",p),!1}},Z=async(s,t,a,o)=>{var r,i;try{if(!((r=v.value)!=null&&r.StationID)||!((i=_.value)!=null&&i.id))return console.warn("‚ö†Ô∏è Cannot log fraud detection: missing station or user info"),!1;const p={TransactionID:null,StationID:v.value.StationID,UserID:_.value.id,RiskScore:s.toString(),Severity:t,FraudType:a,Description:o,Status:"Flagged",DetectedAt:new Date().toISOString()};return await E("POST","/FraudDetectionLogs",p),console.log(`üö® Fraud detection logged: ${a} (Risk: ${s})`),!0}catch(p){return console.error("‚ùå Failed to log fraud detection:",p),!1}},le=async()=>{var s;try{if(z.value=!0,!((s=_.value)!=null&&s.id))throw new Error("AUTHENTICATION_ERROR: No user ID available");const t=_.value.id;console.log(`üîç Loading FIRST station assignment for User ID: ${t}`);const o=(await E("GET",`/UserStations?UserID=${t}&Status=Active`)).records||[];if(console.log("üìã User Station Assignments:",o),o.length===0)throw new Error(`ACCESS_DENIED: User ${t} has no active station assignments. Contact administrator to assign stations.`);const r=o[0];console.log("üéØ Using FIRST station assignment:",r);try{const i=await E("GET",`/Stations/${r.StationID}`);let p=i;i.records&&i.records.length>0&&(p=i.records[0]),v.value={...p,...r,StationID:r.StationID,UserAssignment:r}}catch(i){console.error(`‚ùå Error loading station ${r.StationID}:`,i),v.value={StationID:r.StationID,Name:`Station ${r.StationID}`,Status:"Error Loading",UserAssignment:r,LoadError:i.message}}return console.log("üè¢ Assigned Station:",v.value),await F("SINGLE_STATION_ASSIGNED","User assigned to single station (first from UserStations)",{userId:t,stationId:v.value.StationID,stationName:v.value.Name,isPrimary:r.IsPrimary,totalAssignments:o.length,assignmentDetails:r}),o.length>1&&await S.fire({title:"Single Station Mode",html:`
          <div class="text-start">
            <p class="mb-3"><strong>You have ${o.length} station assignments.</strong></p>
            <p>Using: <strong>${v.value.Name||`Station ${v.value.StationID}`}</strong></p>
            <p class="text-muted mt-3">This system operates in single-station mode. Contact administrator if you need to work at a different station.</p>
          </div>
        `,icon:"info",confirmButtonText:"Continue",confirmButtonColor:"#3699ff"}),v.value}catch(t){throw console.error("‚ùå Error loading single user station:",t),await S.fire({title:"Station Assignment Error",html:`
        <div class="text-start">
          <p class="mb-3"><strong>Unable to load your station assignment:</strong></p>
          <p class="text-danger">${t.message}</p>
          <p class="mt-3"><strong>Required Actions:</strong></p>
          <ul class="text-muted">
            <li>Contact your administrator to assign you to a station</li>
            <li>Verify your user permissions in the system</li>
            <li>Check that you have active station assignments</li>
          </ul>
        </div>
      `,icon:"error",confirmButtonText:"Contact Administrator",confirmButtonColor:"#f1416c",allowOutsideClick:!1,allowEscapeKey:!1}),t}finally{z.value=!1}},ee=async()=>{var s,t;try{if(N.value=!0,j.value="",!((s=_.value)!=null&&s.id))throw new Error("SECURITY_ERROR: No authenticated user found");if(!((t=v.value)!=null&&t.StationID))throw new Error("SECURITY_ERROR: No station assigned. Please contact administrator.");const a=new Date().toISOString().split("T")[0],o=ce(),r=parseInt(_.value.id),i=parseInt(v.value.StationID);console.log(`üîç CONSTRAINT-SAFE shift detection for User ${r} at Station ${i}`),console.log(`üìÖ Date: ${a}, Shift: ${o}`),await F("SHIFT_ACCESS_ATTEMPT","User attempting to access shift management",{userId:r,stationId:i,stationName:v.value.Name,shiftType:o,date:a});const O=((await E("GET",`/CashDrawers?StationID=${i}&ShiftDate=${a}&ShiftType=${o}`)).records||[]).filter(y=>parseInt(y.StationID)===i&&y.ShiftDate===a&&y.ShiftType===o);if(console.log(`üîç Found ${O.length} existing shifts for constraint (${i}, ${a}, ${o})`),O.length>0){const y=O[0];if(console.log("üìã Processing existing shift:",y),y.Status==="Open")parseInt(y.AttendantID)===r?(n.value=y,H.value=!0,V.value="Resumed",await F("SHIFT_RESUMED","User resuming their own active shift",{drawerId:y.DrawerID,openedAt:y.OpenedAt,stationName:v.value.Name}),await S.fire({title:"Active Shift Resumed",text:`Resuming your ${o} shift (Drawer #${y.DrawerID}) at ${v.value.Name}`,icon:"info",toast:!0,position:"top-end",timer:4e3,showConfirmButton:!1})):await Ue(y,r);else throw y.Status==="Closed"?new Error(`DATABASE_CONSTRAINT_VIOLATION: A ${o} shift already exists for station ${i} on ${a} (Status: ${y.Status}, DrawerID: ${y.DrawerID}). The database unique constraint prevents creating another shift for this combination.`):new Error(`DATABASE_CONSTRAINT_VIOLATION: A ${o} shift with status '${y.Status}' already exists for station ${i} on ${a} (DrawerID: ${y.DrawerID}). The database unique constraint prevents creating another shift.`)}else console.log(`‚úÖ No constraint violations found, creating new ${o} shift`),await Be(r,i,a,o)}catch(a){console.error("‚ùå Error in constraint-safe shift detection:",a),j.value=a.message,a.message.includes("DATABASE_CONSTRAINT_VIOLATION")||a.message.includes("already exists")||a.message.includes("UNIQUE constraint failed")?await S.fire({title:"Shift Constraint Violation",html:`
          <div class="text-start">
            <p class="mb-3"><strong>Database Constraint Error:</strong></p>
            <p class="text-danger">${a.message}</p>
            <p class="mt-3"><strong>This means:</strong></p>
            <ul class="text-muted">
              <li>Another shift already exists for this station/date/time combination</li>
              <li>The database prevents duplicate shifts for the same constraint</li>
              <li>This is a protective measure to maintain data integrity</li>
            </ul>
            <p class="mt-3"><strong>Options:</strong></p>
            <ul class="text-muted">
              <li>Wait for the existing shift to be closed</li>
              <li>Contact the current shift owner for handover</li>
              <li>Contact your supervisor or administrator</li>
            </ul>
          </div>
        `,icon:"error",confirmButtonText:"OK",confirmButtonColor:"#f1416c"}):await S.fire({title:"Shift Initialization Error",text:a.message||"Failed to initialize shift. Please contact system administrator.",icon:"error",confirmButtonColor:"#f1416c"})}finally{N.value=!1}},Be=async(s,t,a,o)=>{var r;try{console.log(`üîß Creating constraint-safe shift: User ${s}, Station ${t}, ${a}, ${o}`);const i=await E("GET",`/CashDrawers?StationID=${t}&ShiftDate=${a}&ShiftType=${o}`);if(i.records&&i.records.length>0)throw new Error(`DATABASE_CONSTRAINT_VIOLATION: A ${o} shift was just created for station ${t} on ${a} by another process (race condition detected)`);const p=await Ve(t,a,o),g={StationID:t,ShiftDate:a,ShiftType:o,AttendantID:s,OpeningBalance:p.toFixed(2),ClosingBalance:"0.00",ExpectedCash:p.toFixed(2),ActualCash:"0.00",Variance:"0.00",CashSales:"0.00",CashPayouts:"0.00",Status:"Open",OpenedBy:s,OpenedAt:new Date().toISOString(),Notes:`Automatically created ${o} shift for ${((r=_.value)==null?void 0:r.name)||"User"} at ${L(new Date().toISOString())}`},y=["StationID","ShiftDate","ShiftType","AttendantID","OpeningBalance","ClosingBalance","ExpectedCash","ActualCash","Variance","CashSales","CashPayouts","OpenedBy","OpenedAt"].filter(Y=>g[Y]===null||g[Y]===void 0||g[Y]==="");if(y.length>0)throw new Error(`DATABASE_VALIDATION_ERROR: Missing required fields: ${y.join(", ")}`);if(!Number.isInteger(t)||t<=0)throw new Error(`FK_CONSTRAINT_ERROR: Invalid StationID ${t}`);if(!Number.isInteger(s)||s<=0)throw new Error(`FK_CONSTRAINT_ERROR: Invalid AttendantID/OpenedBy ${s}`);await Pe(s,t,a,o),console.log("üìù Creating shift with data:",g);const I=await E("POST","/CashDrawers",g);if(!I)throw new Error("DATABASE_ERROR: Failed to create shift - no response from server");let T=null;if(I.DrawerID?T=I.DrawerID:I.records&&I.records.length>0?T=I.records[0].DrawerID:I.id&&(T=I.id),!T)throw console.error("‚ùå Unexpected response format:",I),new Error("DATABASE_ERROR: Failed to create shift - invalid response format");n.value={...g,DrawerID:T},H.value=!0,V.value="Created",await F("CONSTRAINT_SAFE_SHIFT_CREATED","Shift created with constraint safety checks",{drawerId:T,openingBalance:p,shiftType:o,userId:s,stationId:t,constraintKey:`${t}-${a}-${o}`}),await S.fire({title:"Shift Successfully Created!",html:`
        <div class="text-start">
          <p class="mb-2"><strong>New Shift Details:</strong></p>
          <ul class="list-unstyled">
            <li>‚Ä¢ Drawer ID: #${T}</li>
            <li>‚Ä¢ Shift Type: ${o}</li>
            <li>‚Ä¢ Station: ${v.value.Name}</li>
            <li>‚Ä¢ Opening Balance: UGX ${R(p)}</li>
            <li>‚Ä¢ Opened: ${L(new Date().toISOString())}</li>
          </ul>
        </div>
      `,icon:"success",confirmButtonText:"Continue",confirmButtonColor:"#1BC5BD"})}catch(i){throw console.error("‚ùå Error creating constraint-safe shift:",i),await F("SHIFT_CREATION_FAILED","Failed to create constraint-safe shift",{error:i.message,userId:s,stationId:t,shiftType:o,date:a,constraintKey:`${t}-${a}-${o}`}),i}},Ue=async(s,t)=>{try{const a=await He(s.AttendantID),o=await S.fire({title:"Shift Handover Required",html:`
        <div class="text-start">
          <p class="mb-3"><strong>An active ${s.ShiftType} shift already exists:</strong></p>
          <ul class="list-unstyled">
            <li>‚Ä¢ Drawer: #${s.DrawerID}</li>
            <li>‚Ä¢ Current Attendant: ${a}</li>
            <li>‚Ä¢ Opened: ${L(s.OpenedAt)}</li>
            <li>‚Ä¢ Opening Balance: UGX ${R(s.OpeningBalance)}</li>
          </ul>
          <p class="text-warning mt-3"><strong>Options:</strong></p>
          <p class="text-muted fs-7">You can take over this shift or view it in read-only mode.</p>
        </div>
      `,icon:"question",showCancelButton:!0,showDenyButton:!0,confirmButtonText:"Take Over Shift",denyButtonText:"View Only (Read-Only)",cancelButtonText:"Cancel",confirmButtonColor:"#1BC5BD",denyButtonColor:"#3699ff",cancelButtonColor:"#f1416c"});if(o.isConfirmed)await Fe(s,t);else if(o.isDenied)n.value={...s,readOnly:!0},H.value=!0,V.value="Viewing (Read-Only)",await S.fire({title:"Read-Only Access",text:"You have read-only access to this shift. Some functions are limited.",icon:"info",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1});else throw new Error("Shift access cancelled by user. Cannot proceed without active shift.")}catch(a){throw console.error("‚ùå Error handling shift handover:",a),a}},Fe=async(s,t)=>{try{await F("SHIFT_HANDOVER_INITIATED","User attempting to take over existing shift",{drawerId:s.DrawerID,previousAttendant:s.AttendantID,newAttendant:t});try{await E("GET",`/users/${t}`)}catch{throw new Error(`FK_CONSTRAINT_ERROR: User ID ${t} does not exist in users table`)}const a={AttendantID:t,Notes:`${s.Notes||""}

Shift handed over to User #${t} at ${L(new Date().toISOString())}`},o=await E("PATCH",`/CashDrawers/${s.DrawerID}`,a);let r=o;o.records&&o.records.length>0&&(r=o.records[0]),n.value={...s,...a,...r},H.value=!0,V.value="Taken Over",await F("SHIFT_HANDOVER_COMPLETED","Shift successfully handed over",{drawerId:s.DrawerID,previousAttendant:s.AttendantID,newAttendant:t}),await S.fire({title:"Shift Handover Complete!",text:`You have successfully taken over ${s.ShiftType} shift (Drawer #${s.DrawerID})`,icon:"success",confirmButtonColor:"#1BC5BD"})}catch(a){throw console.error("‚ùå Error performing shift handover:",a),await F("SHIFT_HANDOVER_FAILED","Shift handover failed",{error:a.message,drawerId:s.DrawerID}),a}},ce=()=>{const s=new Date().getHours();return s>=6&&s<14?"Morning":s>=14&&s<22?"Afternoon":"Night"},Ve=async(s,t,a)=>{try{let o=1e5;const i=(await E("GET",`/CashDrawers?StationID=${s}&Status=Closed&limit=1&sort=-ClosedAt`)).records||[];if(i.length>0){const p=parseFloat(i[0].ClosingBalance||"0");p>0&&(o=p)}return o>1e6&&(await Z(75,"high","Suspicious Opening Balance",`Unusually high opening balance: UGX ${R(o)}`),o=5e5),o}catch(o){return console.error("‚ùå Error calculating opening balance:",o),1e5}},Pe=async(s,t,a,o)=>{try{const p=((await E("GET",`/CashDrawers?AttendantID=${s}&limit=10&sort=-OpenedAt`)).records||[]).filter(O=>O.ShiftDate===a);p.length>=2&&await Z(80,"high","Excessive Shift Creation",`User attempting to create ${p.length+1} shifts in one day`);const g=new Date().getHours();(o==="Morning"&&(g<5||g>15)||o==="Afternoon"&&(g<13||g>23)||o==="Night"&&g<21&&g>7)&&await Z(60,"medium","Off-Hours Shift Creation",`${o} shift created at unusual time: ${g}:00`)}catch(r){console.error("‚ùå Error in fraud checks:",r)}},He=async s=>{try{const t=await E("GET",`/users/${s}`);let a=t;return t.records&&t.records.length>0&&(a=t.records[0]),(a==null?void 0:a.name)||(a==null?void 0:a.email)||`User #${s}`}catch(t){return console.error("‚ùå Error getting user name:",t),`User #${s}`}},Le=async()=>{if(!n.value){await S.fire({title:"No Active Shift",text:"There is no active shift to close",icon:"warning",confirmButtonColor:"#3699ff"});return}if(n.value.readOnly){await S.fire({title:"Access Denied",text:"You cannot close a shift in read-only mode",icon:"error",confirmButtonColor:"#f1416c"});return}if((await S.fire({title:"Close Current Shift?",html:`
      <div class="text-start">
        <p><strong>Shift Details:</strong></p>
        <ul class="list-unstyled">
          <li>‚Ä¢ Drawer: #${n.value.DrawerID}</li>
          <li>‚Ä¢ Type: ${n.value.ShiftType}</li>
          <li>‚Ä¢ Opened: ${L(n.value.OpenedAt)}</li>
          <li>‚Ä¢ Duration: ${de(n.value.OpenedAt)}</li>
        </ul>
        <p class="text-warning mt-3"><strong>Warning:</strong> This action cannot be undone.</p>
      </div>
    `,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, Close Shift",cancelButtonText:"Cancel",confirmButtonColor:"#f1416c",cancelButtonColor:"#3699ff"})).isConfirmed)try{N.value=!0;const t=_.value.id;try{await E("GET",`/users/${t}`)}catch{throw new Error(`FK_CONSTRAINT_ERROR: ClosedBy User ID ${t} does not exist`)}const a={Status:"Closed",ClosedBy:t,ClosedAt:new Date().toISOString(),ClosingBalance:n.value.ActualCash||n.value.ExpectedCash||n.value.OpeningBalance,Notes:`${n.value.Notes||""}

Shift closed manually by ${_.value.name} at ${L(new Date().toISOString())}`};await E("PATCH",`/CashDrawers/${n.value.DrawerID}`,a),await F("MANUAL_SHIFT_CLOSURE","Shift manually closed by user",{drawerId:n.value.DrawerID,shiftType:n.value.ShiftType,closingBalance:a.ClosingBalance}),await S.fire({title:"Shift Closed Successfully!",text:`Drawer #${n.value.DrawerID} has been closed`,icon:"success",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1}),se(),f.value=1,await ee()}catch(t){console.error("‚ùå Error closing shift:",t),await S.fire({title:"Error Closing Shift!",text:t.message||"Failed to close shift",icon:"error",confirmButtonColor:"#f1416c"})}finally{N.value=!1}},R=s=>{const t=parseFloat(s||0);return new Intl.NumberFormat("en-UG").format(t)},L=s=>new Date(s).toLocaleString("en-UG",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),de=s=>{const t=new Date,a=new Date(s),o=t-a,r=Math.floor(o/(1e3*60*60)),i=Math.floor(o%(1e3*60*60)/(1e3*60));return`${r}h ${i}m`},Me=s=>s===0?"text-success":s>0?"text-warning":"text-danger",Ge=s=>s===0?"bg-light-success border border-success":s>0?"bg-light-warning border border-warning":"bg-light-danger border border-danger",qe=s=>s===0?"ki-check-circle text-success":s>0?"ki-arrow-up text-warning":"ki-arrow-down text-danger",ze=s=>s<5e4?"Low":s<2e5?"Medium":"High",je=s=>s<5e4?"bg-light-info border border-info":s<2e5?"bg-light-warning border border-warning":"bg-light-danger border border-danger",Xe=s=>s<5e4?"text-info":s<2e5?"text-warning":"text-danger",Ye=s=>s<5e4?"Minor variance detected. Standard documentation required.":s<2e5?"Moderate variance detected. Supervisor review recommended.":"Significant variance detected. Management escalation required.",M=B(null),X=B(null);let G=null,q=null;const Ke=async()=>{if(!(!M.value||!n.value))try{G&&(G.destroy(),G=null);let s;try{s=(await Oe(()=>import("https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"),[])).default}catch(g){console.warn("‚ö†Ô∏è Could not load Chart.js from CDN:",g),M.value.innerHTML=`
        <div class="d-flex flex-column align-items-center justify-content-center h-200px">
          <i class="ki-duotone ki-chart-simple text-muted fs-3x mb-3">
            <span class="path1"></span>
            <span class="path2"></span>
            <span class="path3"></span>
          </i>
          <p class="text-muted text-center">Chart visualization unavailable</p>
        </div>
      `;return}const t=M.value.getContext("2d"),a=parseFloat(n.value.OpeningBalance||"0"),o=parseFloat(n.value.ExpectedCash||"0"),r=parseFloat(n.value.CashSales||"0"),i=parseFloat(n.value.CashPayouts||"0"),p=[a,r,i,o];if(p.every(g=>g===0)){M.value.innerHTML=`
        <div class="d-flex flex-column align-items-center justify-content-center h-200px">
          <i class="ki-duotone ki-information text-info fs-3x mb-3">
            <span class="path1"></span>
            <span class="path2"></span>
            <span class="path3"></span>
          </i>
          <p class="text-muted text-center">No financial data available yet</p>
        </div>
      `;return}G=new s(t,{type:"doughnut",data:{labels:["Opening Balance","Cash Sales","Cash Payouts","Expected Final"],datasets:[{data:p,backgroundColor:["#3699FF","#1BC5BD","#FFA800","#8950FC"],borderWidth:2,borderColor:"#ffffff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},title:{display:!0,text:`Shift #${n.value.DrawerID} Financial Overview`}}}})}catch(s){console.error("‚ùå Error creating shift stats chart:",s),M.value&&(M.value.innerHTML=`
        <div class="d-flex flex-column align-items-center justify-content-center h-200px">
          <i class="ki-duotone ki-cross-circle text-danger fs-3x mb-3">
            <span class="path1"></span>
            <span class="path2"></span>
          </i>
          <p class="text-danger text-center">Chart creation failed</p>
        </div>
      `)}},We=async()=>{var s;if(!(!X.value||!n.value))try{q&&(q.destroy(),q=null);let t;try{t=(await Oe(()=>import("https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"),[])).default}catch(p){console.warn("‚ö†Ô∏è Could not load Chart.js for variance chart:",p),X.value.innerHTML=`
        <div class="d-flex flex-column align-items-center justify-content-center h-200px">
          <i class="ki-duotone ki-chart-simple text-muted fs-3x mb-3">
            <span class="path1"></span>
            <span class="path2"></span>
            <span class="path3"></span>
          </i>
          <p class="text-muted text-center">Variance chart unavailable</p>
        </div>
      `;return}const a=X.value.getContext("2d"),o=parseFloat(((s=n.value)==null?void 0:s.ExpectedCash)||"0"),r=parseFloat(k.actualCash||"0"),i=C.value;q=new t(a,{type:"bar",data:{labels:["Expected","Actual","Variance"],datasets:[{label:"Amount (UGX)",data:[o,r,Math.abs(i)],backgroundColor:["#3699FF",i>=0?"#1BC5BD":"#F64E60",i>=0?"#FFA800":"#F64E60"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{callback:function(p){return"UGX "+p.toLocaleString()}}}},plugins:{title:{display:!0,text:"Cash Analysis Breakdown"}}}})}catch(t){console.error("‚ùå Error creating variance chart:",t),X.value&&(X.value.innerHTML=`
        <div class="d-flex flex-column align-items-center justify-content-center h-200px">
          <i class="ki-duotone ki-cross-circle text-danger fs-3x mb-3">
            <span class="path1"></span>
            <span class="path2"></span>
          </i>
          <p class="text-danger text-center">Variance chart failed</p>
        </div>
      `)}},Je=async()=>{if(re.value){if(ue(),f.value===2){if(!k.actualCash){m.actualCash="Actual cash amount is required";return}const s=Math.abs(C.value);if(s>5e4){const t=s>2e5?85:65,a=s>2e5?"high":"medium";await Z(t,a,"Cash Variance",`Significant cash variance detected: UGX ${R(s)}`)}await Ae(),We()}if(f.value===3){if(!b.category){m.category="Variance category is required";return}if(!b.severity){m.severity="Severity level is required";return}if(!b.explanation){m.explanation="Detailed explanation is required";return}}if(f.value===4){if(!h.action){m.action="Resolution action is required";return}if(!h.notes){m.resolutionNotes="Resolution notes are required";return}}f.value++}},Qe=()=>{f.value>1&&f.value--},ue=()=>{Object.keys(m).forEach(s=>{m[s]=""})},Ze=async()=>{var t;if(!ie.value){await S.fire({title:"Incomplete Form",text:"Please complete all required confirmations before proceeding",icon:"warning",confirmButtonColor:"#3699ff"});return}if((await S.fire({title:"Complete Handover?",text:"This action will close the cash drawer and cannot be undone. Are you sure?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, Complete Handover",cancelButtonText:"Cancel",confirmButtonColor:"#1BC5BD",cancelButtonColor:"#f1416c"})).isConfirmed)try{N.value=!0;const a=document.querySelector("[data-kt-indicator]");a&&a.setAttribute("data-kt-indicator","on");const o=_.value.id;try{await E("GET",`/users/${o}`)}catch{throw new Error(`FK_CONSTRAINT_ERROR: ClosedBy User ID ${o} does not exist`)}const r={ClosingBalance:parseFloat(k.actualCash||0).toFixed(2),ActualCash:parseFloat(k.actualCash||0).toFixed(2),Variance:C.value.toFixed(2),CashPayouts:parseFloat(k.cashPayouts||0).toFixed(2),Status:"Closed",ClosedBy:o,ClosedAt:new Date().toISOString(),Notes:`${((t=n.value)==null?void 0:t.Notes)||""}

Variance Resolution:
Category: ${b.category}
Action: ${h.action}
Resolution: ${h.notes}
Final Comments: ${A.finalComments}`};if(!r.ClosedBy)throw new Error("VALIDATION_ERROR: ClosedBy user ID is required");await E("PATCH",`/CashDrawers/${n.value.DrawerID}`,r),await F("HANDOVER_COMPLETION","Cash drawer variance resolution completed",{drawerId:n.value.DrawerID,variance:C.value,resolution:h.action,finalBalance:r.ClosingBalance}),await S.fire({title:"Handover Complete!",text:`Cash drawer #${n.value.DrawerID} has been successfully closed with variance resolution.`,icon:"success",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1}),se(),f.value=1,await ee()}catch(a){console.error("‚ùå Error completing handover:",a),await S.fire({title:"Error!",text:a.message||"Failed to complete handover",icon:"error",confirmButtonColor:"#f1416c"})}finally{N.value=!1;const a=document.querySelector("[data-kt-indicator]");a&&a.setAttribute("data-kt-indicator","off")}},se=()=>{n.value=null,H.value=!1,V.value="",j.value="",k.actualCash="",k.cashPayouts="0",b.category="",b.severity="",b.explanation="",b.factors=[],b.solutions=[],h.action="",h.adjustmentAmount="",h.referenceNumber="",h.notes="",h.supervisorPassword="",h.authorizedBy="",A.confirmAccuracy=!1,A.confirmResolution=!1,A.confirmHandover=!1,A.finalComments="",ue()},pe=async()=>{try{se(),f.value=1,await le(),await ee()}catch(s){console.error("‚ùå Error in retry initialization:",s),j.value=s.message}};return tt(async()=>{console.log("üéØ Cash Drawer Variance Resolution component mounted - DATABASE COMPLIANT MODE");try{if(!ne.value)throw new Error("SECURITY_ERROR: No authentication data found");if(!_.value)throw new Error("SECURITY_ERROR: User information not available");if(console.log("üë§ Current User:",_.value),console.log("üè¢ Loading single user station assignment..."),console.log(`üìç Current time: ${new Date().toLocaleString()}`),console.log(`üïê Shift type: ${ce()}`),await le(),!v.value)throw new Error("SECURITY_ERROR: No station assigned. Contact administrator to assign you to a station.");if(console.log("üè¢ Assigned Station:",v.value),Q.value.online=navigator.onLine!==!1,console.log("üîç Detecting user shift with constraint safety..."),await ee(),H.value&&n.value){await Ae();try{await Ke()}catch(s){console.warn("‚ö†Ô∏è Could not create shift stats chart:",s)}}console.log("‚úÖ Component initialization completed successfully")}catch(s){console.error("‚ùå Component initialization error:",s),j.value=s.message;let t="Initialization Error",a=["Refresh the page","Check your login status","Contact system administrator"];s.message.includes("No authentication")?(t="Authentication Error",a=["Please log in again","Clear browser cache and cookies","Contact IT support if problem persists"]):s.message.includes("station")?(t="Station Assignment Error",a=["Contact your manager to assign you to a station","Verify your user permissions","Check that you have active station assignments in the system"]):s.message.includes("DATABASE_CONSTRAINT_VIOLATION")&&(t="Database Constraint Error",a=["Wait for existing shifts to close","Contact current shift attendant for handover","Contact supervisor or administrator","Try again in a few minutes"]),await S.fire({title:t,html:`
        <div class="text-start">
          <p class="mb-3"><strong>Component failed to initialize:</strong></p>
          <p class="text-danger">${s.message}</p>
          <p class="mt-3"><strong>Possible solutions:</strong></p>
          <ul class="text-muted">
            ${a.map(o=>`<li>${o}</li>`).join("")}
          </ul>
        </div>
      `,icon:"error",confirmButtonText:"Retry",confirmButtonColor:"#3699ff",showCancelButton:!0,cancelButtonText:"Reload Page",cancelButtonColor:"#f1416c"}).then(o=>{o.isConfirmed?pe():o.isDismissed&&window.location.reload()}).catch(o=>{console.error("‚ùå Error showing initialization error dialog:",o),confirm(`Initialization failed: ${s.message}

Click OK to reload the page.`)&&window.location.reload()})}}),st(()=>{console.log("üßπ Cleaning up Cash Drawer Variance Resolution component");try{G&&(G.destroy(),G=null),q&&(q.destroy(),q=null)}catch(s){console.warn("‚ö†Ô∏è Error during cleanup:",s)}}),(s,t)=>{var a,o,r,i,p,g,O,y,I,T,Y,fe,ve,he,me,ge,ye,we,be,xe,Ce,Se,_e,ke,De;return u(),d("div",at,[e("div",ot,[e("div",nt,[t[24]||(t[24]=U('<div class="card-title" data-v-713e2ca8><h1 class="fw-bold text-gray-900 fs-2x" data-v-713e2ca8><i class="ki-duotone ki-wallet text-primary fs-1 me-3" data-v-713e2ca8><span class="path1" data-v-713e2ca8></span><span class="path2" data-v-713e2ca8></span><span class="path3" data-v-713e2ca8></span></i> Cash Drawer Variance Resolution </h1></div>',1)),e("div",rt,[e("div",it,[n.value?(u(),d("div",{key:0,class:x(["badge fs-7 fw-bold px-3 py-2",n.value.readOnly?"badge-light-warning":"badge-light-primary"])},[e("i",{class:x(["ki-duotone fs-6 me-1",n.value.readOnly?"ki-eye text-warning":"ki-calendar text-primary"])},t[17]||(t[17]=[e("span",{class:"path1"},null,-1),e("span",{class:"path2"},null,-1)]),2),$(" "+l(n.value.readOnly?"View Only":"Shift")+": "+l(n.value.ShiftType)+" #"+l(n.value.DrawerID),1)],2)):w("",!0),v.value?(u(),d("div",lt,[t[18]||(t[18]=e("i",{class:"ki-duotone ki-home text-info fs-6 me-1"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1)),$(" Station: "+l(v.value.Name||`Station ${v.value.StationID}`),1)])):z.value?(u(),d("div",ct,t[19]||(t[19]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),$(" Loading Station... ")]))):v.value?w("",!0):(u(),d("div",dt,t[20]||(t[20]=[e("i",{class:"ki-duotone ki-cross-circle text-danger fs-6 me-1"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1),$(" No Station Assigned ")]))),e("div",ut,[t[21]||(t[21]=e("i",{class:"ki-duotone ki-user text-success fs-6 me-1"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1)),$(" "+l(((a=_.value)==null?void 0:a.name)||"User"),1)]),e("div",{class:x(["badge fs-7 fw-bold px-3 py-2",Q.value.online?"badge-light-success":"badge-light-danger"])},[e("i",{class:x(["ki-duotone fs-6 me-1",Q.value.online?"ki-check-circle text-success":"ki-cross-circle text-danger"])},t[22]||(t[22]=[e("span",{class:"path1"},null,-1),e("span",{class:"path2"},null,-1)]),2),$(" "+l(Q.value.online?"Online":"Offline"),1)],2),n.value&&!n.value.readOnly?(u(),d("button",{key:4,onClick:Le,class:"btn btn-sm btn-light-danger",disabled:N.value},t[23]||(t[23]=[e("i",{class:"ki-duotone ki-cross-circle text-danger fs-6 me-1"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1),$(" Close Shift ")]),8,pt)):w("",!0)])])])]),e("div",ft,[e("div",vt,[e("div",ht,[e("div",mt,[e("div",gt,[e("div",yt,[e("div",{class:x(["stepper-item",{current:f.value===1,completed:f.value>1}])},t[25]||(t[25]=[U('<div class="stepper-wrapper" data-v-713e2ca8><div class="stepper-icon" data-v-713e2ca8><i class="ki-duotone ki-check stepper-check fs-1" data-v-713e2ca8></i><span class="stepper-number" data-v-713e2ca8>1</span></div><div class="stepper-label" data-v-713e2ca8><h3 class="stepper-title" data-v-713e2ca8>Shift Detection</h3><div class="stepper-desc fw-semibold" data-v-713e2ca8>Initialize cash drawer</div></div></div><div class="stepper-line h-40px" data-v-713e2ca8></div>',2)]),2),e("div",{class:x(["stepper-item",{current:f.value===2,completed:f.value>2}])},t[26]||(t[26]=[U('<div class="stepper-wrapper" data-v-713e2ca8><div class="stepper-icon" data-v-713e2ca8><i class="ki-duotone ki-check stepper-check fs-1" data-v-713e2ca8></i><span class="stepper-number" data-v-713e2ca8>2</span></div><div class="stepper-label" data-v-713e2ca8><h3 class="stepper-title" data-v-713e2ca8>Variance Detection</h3><div class="stepper-desc fw-semibold" data-v-713e2ca8>Calculate discrepancies</div></div></div><div class="stepper-line h-40px" data-v-713e2ca8></div>',2)]),2),e("div",{class:x(["stepper-item",{current:f.value===3,completed:f.value>3}])},t[27]||(t[27]=[U('<div class="stepper-wrapper" data-v-713e2ca8><div class="stepper-icon" data-v-713e2ca8><i class="ki-duotone ki-check stepper-check fs-1" data-v-713e2ca8></i><span class="stepper-number" data-v-713e2ca8>3</span></div><div class="stepper-label" data-v-713e2ca8><h3 class="stepper-title" data-v-713e2ca8>Discrepancy Analysis</h3><div class="stepper-desc fw-semibold" data-v-713e2ca8>Document variances</div></div></div><div class="stepper-line h-40px" data-v-713e2ca8></div>',2)]),2),e("div",{class:x(["stepper-item",{current:f.value===4,completed:f.value>4}])},t[28]||(t[28]=[U('<div class="stepper-wrapper" data-v-713e2ca8><div class="stepper-icon" data-v-713e2ca8><i class="ki-duotone ki-check stepper-check fs-1" data-v-713e2ca8></i><span class="stepper-number" data-v-713e2ca8>4</span></div><div class="stepper-label" data-v-713e2ca8><h3 class="stepper-title" data-v-713e2ca8>Resolution Actions</h3><div class="stepper-desc fw-semibold" data-v-713e2ca8>Apply corrections</div></div></div><div class="stepper-line h-40px" data-v-713e2ca8></div>',2)]),2),e("div",{class:x(["stepper-item",{current:f.value===5,completed:f.value>5}])},t[29]||(t[29]=[U('<div class="stepper-wrapper" data-v-713e2ca8><div class="stepper-icon" data-v-713e2ca8><i class="ki-duotone ki-check stepper-check fs-1" data-v-713e2ca8></i><span class="stepper-number" data-v-713e2ca8>5</span></div><div class="stepper-label" data-v-713e2ca8><h3 class="stepper-title" data-v-713e2ca8>Handover Completion</h3><div class="stepper-desc fw-semibold" data-v-713e2ca8>Finalize shift transfer</div></div></div>',1)]),2)])])]),e("div",wt,[e("div",bt,[f.value===1?(u(),d("div",xt,[e("div",Ct,[t[45]||(t[45]=e("div",{class:"pb-10 pb-lg-12"},[e("h2",{class:"fw-bold text-gray-900 fs-2x mb-4"},"Current Shift Status"),e("p",{class:"text-muted fs-6 fw-semibold"}," Review your active cash drawer and shift information. ")],-1)),N.value&&(!H.value||z.value)?(u(),d("div",St,[t[30]||(t[30]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("div",_t,[e("h5",kt,l(z.value?"Loading Your Assigned Station":"Detecting Your Current Shift"),1),e("span",Dt,l(z.value?"Retrieving station assignment from database...":"Checking for existing shift or creating new one..."),1)])])):n.value?(u(),d("div",At,[e("div",Et,[e("div",It,[e("div",Ot,[e("div",Tt,[t[31]||(t[31]=e("i",{class:"ki-duotone ki-wallet text-primary fs-2x me-3"},[e("span",{class:"path1"}),e("span",{class:"path2"}),e("span",{class:"path3"})],-1)),e("div",null,[e("h3",Rt,l(V.value)+" Cash Drawer #"+l(n.value.DrawerID),1),e("span",$t,l(n.value.ShiftType)+" Shift",1),V.value==="Created"?(u(),d("span",Nt,"Auto-Created")):V.value==="Resumed"?(u(),d("span",Bt,"Resumed")):V.value==="Taken Over"?(u(),d("span",Ut,"Taken Over")):w("",!0)])])]),e("div",Ft,[e("div",Vt,[e("div",Pt,[t[32]||(t[32]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Shift Date",-1)),e("span",Ht,l(n.value.ShiftDate),1)]),e("div",Lt,[t[33]||(t[33]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Opened At",-1)),e("span",Mt,l(L(n.value.OpenedAt)),1)]),e("div",Gt,[t[34]||(t[34]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Opening Balance",-1)),e("span",qt,"UGX "+l(R(n.value.OpeningBalance)),1)]),e("div",zt,[t[35]||(t[35]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Expected Cash",-1)),e("span",jt,"UGX "+l(R(n.value.ExpectedCash)),1)])]),e("div",Xt,[e("div",Yt,[t[37]||(t[37]=e("i",{class:"ki-duotone ki-time text-info fs-2x me-3"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1)),e("div",null,[t[36]||(t[36]=e("h5",{class:"text-info mb-1"},"Shift Duration",-1)),e("p",Kt,l(de(n.value.OpenedAt)),1)])])]),e("div",Wt,[e("div",Jt,[t[39]||(t[39]=e("i",{class:"ki-duotone ki-home text-success fs-2x me-3"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1)),e("div",null,[t[38]||(t[38]=e("h5",{class:"text-success mb-1"},"Assigned Station",-1)),e("p",Qt,[$(l(((o=v.value)==null?void 0:o.Name)||`Station ${(r=v.value)==null?void 0:r.StationID}`)+" ",1),((i=v.value)==null?void 0:i.IsPrimary)==="1"?(u(),d("span",Zt,"Primary")):w("",!0)])])])]),(p=n.value)!=null&&p.readOnly?(u(),d("div",es,t[40]||(t[40]=[U('<div class="d-flex align-items-center" data-v-713e2ca8><i class="ki-duotone ki-eye text-warning fs-2x me-3" data-v-713e2ca8><span class="path1" data-v-713e2ca8></span><span class="path2" data-v-713e2ca8></span></i><div data-v-713e2ca8><h5 class="text-warning mb-1" data-v-713e2ca8>Read-Only Access</h5><p class="text-muted fs-7 mb-0" data-v-713e2ca8> You have view-only access to this shift. Contact the shift owner to take over. </p></div></div>',1)]))):w("",!0)])])]),e("div",ts,[e("div",ss,[t[41]||(t[41]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Shift Performance Dashboard")],-1)),e("div",as,[e("canvas",{ref_key:"shiftStatsChart",ref:M,width:"400",height:"200"},null,512)])])])])):!N.value&&!n.value?(u(),d("div",os,[e("div",ns,[t[43]||(t[43]=e("i",{class:"ki-duotone ki-cross-circle fs-3x text-danger mb-4"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1)),t[44]||(t[44]=e("h3",{class:"text-danger"},"Shift Initialization Failed",-1)),e("p",rs,l(j.value||"Unable to initialize shift. Please contact system administrator."),1),e("button",{onClick:pe,class:"btn btn-primary"},t[42]||(t[42]=[e("i",{class:"ki-duotone ki-arrows-circle fs-6 me-2"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1),$(" Retry Initialization ")]))])])):w("",!0)])])):w("",!0),f.value===2?(u(),d("div",is,[e("div",ls,[t[61]||(t[61]=e("div",{class:"pb-10 pb-lg-12"},[e("h2",{class:"fw-bold text-gray-900 fs-2x mb-4"},"Variance Detection"),e("p",{class:"text-muted fs-6 fw-semibold"}," Calculate and analyze cash discrepancies for the selected drawer. ")],-1)),e("div",cs,[e("div",ds,[e("h4",us," Current Cash Drawer #"+l((g=n.value)==null?void 0:g.DrawerID),1),e("div",ps,[e("div",fs,[t[46]||(t[46]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Shift Type",-1)),e("span",vs,l((O=n.value)==null?void 0:O.ShiftType),1)]),e("div",hs,[t[47]||(t[47]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Attendant",-1)),e("span",ms,l((y=_.value)==null?void 0:y.name),1)]),e("div",gs,[t[48]||(t[48]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Opening Balance",-1)),e("span",ys,"UGX "+l(R((I=n.value)==null?void 0:I.OpeningBalance)),1)]),e("div",ws,[t[49]||(t[49]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Expected Cash",-1)),e("span",bs,"UGX "+l(R((T=n.value)==null?void 0:T.ExpectedCash)),1)])])])]),e("div",xs,[t[60]||(t[60]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Physical Cash Count")],-1)),e("div",Cs,[e("div",Ss,[e("div",_s,[t[51]||(t[51]=e("label",{class:"required form-label"},"Actual Cash Amount (UGX)",-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>k.actualCash=c),type:"number",step:"0.01",min:"0",class:x(["form-control form-control-lg",{"is-invalid":m.actualCash}]),disabled:(Y=n.value)==null?void 0:Y.readOnly,placeholder:"Enter physical cash count"},null,10,ks),[[P,k.actualCash]]),m.actualCash?(u(),d("div",Ds,l(m.actualCash),1)):w("",!0),(fe=n.value)!=null&&fe.readOnly?(u(),d("div",As,t[50]||(t[50]=[e("i",{class:"ki-duotone ki-information-5 fs-6 me-1"},[e("span",{class:"path1"}),e("span",{class:"path2"}),e("span",{class:"path3"})],-1),$(" Read-only mode - input disabled ")]))):w("",!0)]),e("div",Es,[t[52]||(t[52]=e("label",{class:"form-label"},"Additional Cash Payouts",-1)),D(e("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>k.cashPayouts=c),type:"number",step:"0.01",min:"0",class:"form-control form-control-lg",disabled:(ve=n.value)==null?void 0:ve.readOnly,placeholder:"Enter any cash payouts"},null,8,Is),[[P,k.cashPayouts]])])]),e("div",Os,[t[58]||(t[58]=e("h4",{class:"text-info mb-4"},"Variance Calculation",-1)),e("div",Ts,[e("div",Rs,[t[53]||(t[53]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Expected Cash",-1)),e("span",$s,"UGX "+l(R(((he=n.value)==null?void 0:he.ExpectedCash)||0)),1)]),e("div",Ns,[t[54]||(t[54]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Actual Cash",-1)),e("span",Bs,"UGX "+l(R(k.actualCash||0)),1)]),e("div",Us,[t[55]||(t[55]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Cash Payouts",-1)),e("span",Fs,"UGX "+l(R(k.cashPayouts||0)),1)]),e("div",Vs,[t[56]||(t[56]=e("span",{class:"text-muted fs-7 fw-semibold d-block"},"Net Variance",-1)),e("span",{class:x(["fs-4 fw-bold",Me(C.value)])},[$(" UGX "+l(R(Math.abs(C.value)))+" ",1),C.value!==0?(u(),d("span",Ps," ("+l(C.value>0?"Over":"Short")+") ",1)):w("",!0)],2)])]),Math.abs(C.value)>0?(u(),d("div",{key:0,class:x(["mt-6 p-4 rounded",je(Math.abs(C.value))])},[e("div",Hs,[e("i",{class:x(["ki-duotone ki-security-user fs-2x me-3",Xe(Math.abs(C.value))])},t[57]||(t[57]=[e("span",{class:"path1"},null,-1),e("span",{class:"path2"},null,-1)]),2),e("div",null,[e("h5",Ls,l(ze(Math.abs(C.value)))+" Risk Detection ",1),e("p",Ms,l(Ye(Math.abs(C.value))),1)])])],2)):w("",!0)]),e("div",Gs,[e("div",qs,[t[59]||(t[59]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Variance Analysis Chart")],-1)),e("div",zs,[e("canvas",{ref_key:"varianceChart",ref:X,width:"400",height:"200"},null,512)])])])])])])])):w("",!0),f.value===3?(u(),d("div",js,[e("div",Xs,[t[71]||(t[71]=e("div",{class:"pb-10 pb-lg-12"},[e("h2",{class:"fw-bold text-gray-900 fs-2x mb-4"},"Discrepancy Analysis"),e("p",{class:"text-muted fs-6 fw-semibold"}," Document and categorize the identified variance. ")],-1)),e("div",{class:x(["card mb-8",Ge(C.value)])},[e("div",Ys,[e("div",Ks,[e("i",{class:x(["ki-duotone fs-3x me-4",qe(C.value)])},t[62]||(t[62]=[e("span",{class:"path1"},null,-1),e("span",{class:"path2"},null,-1),e("span",{class:"path3"},null,-1)]),2),e("div",Ws,[e("h3",Js," Variance Detected: UGX "+l(R(Math.abs(C.value))),1),e("p",Qs,l(C.value>0?"Cash overage detected":C.value<0?"Cash shortage detected":"No variance detected"),1)])])])],2),e("div",Zs,[t[70]||(t[70]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Variance Documentation")],-1)),e("div",ea,[e("div",ta,[e("div",sa,[t[64]||(t[64]=e("label",{class:"required form-label"},"Variance Category",-1)),D(e("select",{"onUpdate:modelValue":t[2]||(t[2]=c=>b.category=c),class:x(["form-select form-select-lg",{"is-invalid":m.category}]),disabled:(me=n.value)==null?void 0:me.readOnly},t[63]||(t[63]=[U('<option value="" data-v-713e2ca8>Select category...</option><option value="counting_error" data-v-713e2ca8>Counting Error</option><option value="transaction_error" data-v-713e2ca8>Transaction Error</option><option value="change_mistake" data-v-713e2ca8>Change Mistake</option><option value="fraudulent_activity" data-v-713e2ca8>Fraudulent Activity</option><option value="system_error" data-v-713e2ca8>System Error</option><option value="unaccounted_sale" data-v-713e2ca8>Unaccounted Sale</option><option value="other" data-v-713e2ca8>Other</option>',8)]),10,aa),[[oe,b.category]]),m.category?(u(),d("div",oa,l(m.category),1)):w("",!0)]),e("div",na,[t[66]||(t[66]=e("label",{class:"required form-label"},"Severity Level",-1)),D(e("select",{"onUpdate:modelValue":t[3]||(t[3]=c=>b.severity=c),class:x(["form-select form-select-lg",{"is-invalid":m.severity}]),disabled:(ge=n.value)==null?void 0:ge.readOnly},t[65]||(t[65]=[e("option",{value:""},"Select severity...",-1),e("option",{value:"low"},"Low (Under UGX 50,000)",-1),e("option",{value:"medium"},"Medium (UGX 50,000 - 200,000)",-1),e("option",{value:"high"},"High (Over UGX 200,000)",-1)]),10,ra),[[oe,b.severity]]),m.severity?(u(),d("div",ia,l(m.severity),1)):w("",!0)])]),e("div",la,[e("div",ca,[t[67]||(t[67]=e("label",{class:"required form-label"},"Detailed Explanation",-1)),D(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=c=>b.explanation=c),class:x(["form-control form-control-lg",{"is-invalid":m.explanation}]),disabled:(ye=n.value)==null?void 0:ye.readOnly,rows:"4",placeholder:"Provide a detailed explanation of the variance..."},null,10,da),[[P,b.explanation]]),m.explanation?(u(),d("div",ua,l(m.explanation),1)):w("",!0)])]),e("div",pa,[e("div",fa,[t[68]||(t[68]=e("label",{class:"form-label"},"Contributing Factors",-1)),e("div",va,[(u(),d(Ee,null,Ie($e,c=>{var K;return e("label",{key:c,class:"form-check form-check-custom form-check-success"},[D(e("input",{"onUpdate:modelValue":t[5]||(t[5]=ae=>b.factors=ae),value:c,type:"checkbox",class:"form-check-input",disabled:(K=n.value)==null?void 0:K.readOnly},null,8,ha),[[J,b.factors]]),e("span",ma,l(c),1)])}),64))])]),e("div",ga,[t[69]||(t[69]=e("label",{class:"form-label"},"Potential Solutions",-1)),e("div",ya,[(u(),d(Ee,null,Ie(Ne,c=>{var K;return e("label",{key:c,class:"form-check form-check-custom form-check-primary"},[D(e("input",{"onUpdate:modelValue":t[6]||(t[6]=ae=>b.solutions=ae),value:c,type:"checkbox",class:"form-check-input",disabled:(K=n.value)==null?void 0:K.readOnly},null,8,wa),[[J,b.solutions]]),e("span",ba,l(c),1)])}),64))])])])])])])])):w("",!0),f.value===4?(u(),d("div",xa,[e("div",Ca,[t[81]||(t[81]=e("div",{class:"pb-10 pb-lg-12"},[e("h2",{class:"fw-bold text-gray-900 fs-2x mb-4"},"Resolution Actions"),e("p",{class:"text-muted fs-6 fw-semibold"}," Apply corrections and document resolution actions. ")],-1)),e("div",Sa,[t[80]||(t[80]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Resolution Method")],-1)),e("div",_a,[e("div",ka,[e("div",Da,[t[73]||(t[73]=e("label",{class:"required form-label"},"Primary Action",-1)),D(e("select",{"onUpdate:modelValue":t[7]||(t[7]=c=>h.action=c),class:x(["form-select form-select-lg",{"is-invalid":m.action}]),disabled:(we=n.value)==null?void 0:we.readOnly},t[72]||(t[72]=[U('<option value="" data-v-713e2ca8>Select resolution action...</option><option value="adjust_drawer" data-v-713e2ca8>Adjust Drawer Balance</option><option value="create_variance_entry" data-v-713e2ca8>Create Variance Entry</option><option value="investigate_further" data-v-713e2ca8>Mark for Investigation</option><option value="transfer_shortage" data-v-713e2ca8>Transfer Shortage to Loss</option><option value="recount_cash" data-v-713e2ca8>Initiate Recount</option>',6)]),10,Aa),[[oe,h.action]]),m.action?(u(),d("div",Ea,l(m.action),1)):w("",!0)])]),e("div",Ia,[e("div",Oa,[t[74]||(t[74]=e("label",{class:"form-label"},"Adjustment Amount (UGX)",-1)),D(e("input",{"onUpdate:modelValue":t[8]||(t[8]=c=>h.adjustmentAmount=c),type:"number",step:"0.01",class:"form-control form-control-lg",disabled:(be=n.value)==null?void 0:be.readOnly,placeholder:"Enter adjustment amount"},null,8,Ta),[[P,h.adjustmentAmount]])]),e("div",Ra,[t[75]||(t[75]=e("label",{class:"form-label"},"Reference Number",-1)),D(e("input",{"onUpdate:modelValue":t[9]||(t[9]=c=>h.referenceNumber=c),type:"text",class:"form-control form-control-lg",disabled:(xe=n.value)==null?void 0:xe.readOnly,placeholder:"Enter reference number"},null,8,$a),[[P,h.referenceNumber]])])]),e("div",Na,[e("div",Ba,[t[76]||(t[76]=e("label",{class:"required form-label"},"Resolution Notes",-1)),D(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=c=>h.notes=c),class:x(["form-control form-control-lg",{"is-invalid":m.resolutionNotes}]),disabled:(Ce=n.value)==null?void 0:Ce.readOnly,rows:"4",placeholder:"Document the resolution actions taken..."},null,10,Ua),[[P,h.notes]]),m.resolutionNotes?(u(),d("div",Fa,l(m.resolutionNotes),1)):w("",!0)])]),(Se=n.value)!=null&&Se.readOnly?w("",!0):(u(),d("div",Va,[t[79]||(t[79]=e("h4",{class:"text-warning mb-4"},"Authorization Required",-1)),e("div",Pa,[e("div",Ha,[t[77]||(t[77]=e("label",{class:"form-label"},"Supervisor Password",-1)),D(e("input",{"onUpdate:modelValue":t[11]||(t[11]=c=>h.supervisorPassword=c),type:"password",class:"form-control form-control-lg",placeholder:"Enter supervisor password"},null,512),[[P,h.supervisorPassword]])]),e("div",La,[t[78]||(t[78]=e("label",{class:"form-label"},"Authorized By",-1)),D(e("input",{"onUpdate:modelValue":t[12]||(t[12]=c=>h.authorizedBy=c),type:"text",class:"form-control form-control-lg",placeholder:"Supervisor name"},null,512),[[P,h.authorizedBy]])])])]))])])])])):w("",!0),f.value===5?(u(),d("div",Ma,[e("div",Ga,[t[94]||(t[94]=e("div",{class:"pb-10 pb-lg-12"},[e("h2",{class:"fw-bold text-gray-900 fs-2x mb-4"},"Handover Completion"),e("p",{class:"text-muted fs-6 fw-semibold"}," Finalize the shift handover and close the cash drawer. ")],-1)),e("div",qa,[t[87]||(t[87]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Resolution Summary")],-1)),e("div",za,[e("div",ja,[e("div",Xa,[e("div",Ya,[e("div",Ka,[t[82]||(t[82]=U('<i class="ki-duotone ki-wallet text-info fs-3x mb-3" data-v-713e2ca8><span class="path1" data-v-713e2ca8></span><span class="path2" data-v-713e2ca8></span><span class="path3" data-v-713e2ca8></span></i><h4 class="text-info" data-v-713e2ca8>Original Variance</h4>',2)),e("p",Wa," UGX "+l(R(Math.abs(C.value))),1)])])]),e("div",Ja,[e("div",Qa,[e("div",Za,[t[83]||(t[83]=e("i",{class:"ki-duotone ki-abstract-39 text-warning fs-3x mb-3"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1)),t[84]||(t[84]=e("h4",{class:"text-warning"},"Resolution Action",-1)),e("p",eo,l(h.action||"Not selected"),1)])])]),e("div",to,[e("div",so,[e("div",ao,[t[85]||(t[85]=e("i",{class:"ki-duotone ki-check-circle text-success fs-3x mb-3"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1)),t[86]||(t[86]=e("h4",{class:"text-success"},"Final Status",-1)),e("p",oo,l((_e=n.value)!=null&&_e.readOnly?"View Only":"Ready to Close"),1)])])])])])]),(ke=n.value)!=null&&ke.readOnly?(u(),d("div",go,t[93]||(t[93]=[U('<div class="card-body text-center" data-v-713e2ca8><i class="ki-duotone ki-eye text-warning fs-3x mb-3" data-v-713e2ca8><span class="path1" data-v-713e2ca8></span><span class="path2" data-v-713e2ca8></span></i><h4 class="text-warning" data-v-713e2ca8>Read-Only Access</h4><p class="text-muted mb-0" data-v-713e2ca8> You are viewing this shift in read-only mode. Contact the shift owner to take over and complete the handover process. </p></div>',1)]))):(u(),d("div",no,[t[92]||(t[92]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Final Confirmation")],-1)),e("div",ro,[e("div",io,[e("div",lo,[e("div",co,[D(e("input",{"onUpdate:modelValue":t[13]||(t[13]=c=>A.confirmAccuracy=c),type:"checkbox",class:"form-check-input",id:"confirmAccuracy"},null,512),[[J,A.confirmAccuracy]]),t[88]||(t[88]=e("label",{class:"form-check-label fw-semibold",for:"confirmAccuracy"}," I confirm that all information provided is accurate and complete ",-1))])]),e("div",uo,[e("div",po,[D(e("input",{"onUpdate:modelValue":t[14]||(t[14]=c=>A.confirmResolution=c),type:"checkbox",class:"form-check-input",id:"confirmResolution"},null,512),[[J,A.confirmResolution]]),t[89]||(t[89]=e("label",{class:"form-check-label fw-semibold",for:"confirmResolution"}," I confirm that the variance has been properly resolved according to company policy ",-1))])]),e("div",fo,[e("div",vo,[D(e("input",{"onUpdate:modelValue":t[15]||(t[15]=c=>A.confirmHandover=c),type:"checkbox",class:"form-check-input",id:"confirmHandover"},null,512),[[J,A.confirmHandover]]),t[90]||(t[90]=e("label",{class:"form-check-label fw-semibold",for:"confirmHandover"}," I authorize the closure of this cash drawer and completion of shift handover ",-1))])])]),e("div",ho,[e("div",mo,[t[91]||(t[91]=e("label",{class:"form-label"},"Final Comments",-1)),D(e("textarea",{"onUpdate:modelValue":t[16]||(t[16]=c=>A.finalComments=c),class:"form-control form-control-lg",rows:"3",placeholder:"Any final comments or observations..."},null,512),[[P,A.finalComments]])])])])]))])])):w("",!0),e("div",yo,[e("div",wo,[f.value>1?(u(),d("button",{key:0,onClick:Qe,type:"button",class:"btn btn-lg btn-light-primary me-3",disabled:N.value},t[95]||(t[95]=[e("i",{class:"ki-duotone ki-arrow-left fs-4 me-1"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1),$(" Previous ")]),8,bo)):w("",!0)]),e("div",null,[f.value<5?(u(),d("button",{key:0,onClick:Je,type:"button",class:"btn btn-lg btn-primary",disabled:!re.value||N.value},t[96]||(t[96]=[$(" Next "),e("i",{class:"ki-duotone ki-arrow-right fs-4 ms-1"},[e("span",{class:"path1"}),e("span",{class:"path2"})],-1)]),8,xo)):(De=n.value)!=null&&De.readOnly?w("",!0):(u(),d("button",{key:1,onClick:Ze,type:"button",class:"btn btn-lg btn-success",disabled:!ie.value||N.value,"data-kt-indicator":"off"},t[97]||(t[97]=[U('<span class="indicator-label" data-v-713e2ca8><i class="ki-duotone ki-check fs-4 me-1" data-v-713e2ca8><span class="path1" data-v-713e2ca8></span><span class="path2" data-v-713e2ca8></span></i> Complete Handover </span><span class="indicator-progress" data-v-713e2ca8> Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2" data-v-713e2ca8></span></span>',2)]),8,Co))])])])])])])])])}}},Ao=et(_o,[["__scopeId","data-v-713e2ca8"]]);export{Ao as default};
