import{_ as At,r as A,c as x,a as B,o as bt,S as y,l as Rt,b as c,e as q,d as t,g as f,t as r,f as w,n as R,w as M,m as ee,v as Te,F as H,h as Y,p as Dt,k as Ce,i as d,j as wt,A as Ee,x as _t}from"./index-BJk99QVQ.js";const It={class:"container-fluid p-4 bg-light-primary min-vh-100"},St={key:0,class:"text-center py-20"},xt={class:"card card-flush border-0 shadow-lg"},kt={class:"card-body p-10"},Tt={class:"bg-light-warning rounded-3 p-4 mb-5"},Ct={class:"text-gray-700 mb-0"},Et={class:"text-gray-700 mb-0"},qt={key:1},Pt={key:0,class:"alert alert-dismissible bg-light-danger border-danger mb-6"},Nt={class:"d-flex align-items-center"},Lt={class:"flex-grow-1"},Ot={class:"text-gray-800 mb-0"},Mt={class:"fs-7 text-gray-600 mt-1"},Ut={class:"card card-flush border-0 shadow-lg mb-6"},Ft={class:"card-body p-6"},Vt={class:"d-flex align-items-center justify-content-between flex-wrap gap-3"},$t={class:"d-flex align-items-center gap-4"},Gt={class:"text-gray-600 fs-5 mb-0"},Bt={class:"badge badge-light-info fs-7 mt-1"},Ht={class:"d-flex align-items-center gap-2"},Yt={class:"text-end me-3"},jt=["disabled"],Jt={class:"row g-4 mt-5"},zt={class:"col-lg-3 col-md-6"},Xt={class:"bg-light-danger rounded-4 p-4 text-center"},Qt={class:"text-danger fw-bolder fs-2"},Kt={class:"col-lg-3 col-md-6"},Wt={class:"bg-light-warning rounded-4 p-4 text-center"},Zt={class:"text-warning fw-bolder fs-2"},es={class:"col-lg-3 col-md-6"},ts={class:"bg-light-info rounded-4 p-4 text-center"},ss={class:"text-info fw-bolder fs-2"},as={class:"col-lg-3 col-md-6"},ns={class:"bg-light-success rounded-4 p-4 text-center"},os={class:"text-success fw-bolder fs-2"},is={class:"card border border-success mt-5"},rs={class:"card-body"},ls={class:"row g-4"},cs={class:"col-md-3"},ds={class:"bg-light-success rounded-3 p-3 text-center"},us={class:"text-success fw-bold fs-6"},ps={class:"col-md-3"},vs={class:"bg-light-primary rounded-3 p-3 text-center"},gs={class:"text-primary fw-bold fs-6"},ms={class:"col-md-3"},hs={class:"bg-light-warning rounded-3 p-3 text-center"},fs={class:"text-warning fw-bold fs-6"},ys={class:"col-md-3"},As={class:"bg-light-info rounded-3 p-3 text-center"},bs={class:"text-info fw-bold fs-6"},Rs={class:"card card-flush border-0 shadow-lg mb-6"},Ds={class:"card-body p-4"},ws={class:"row g-3"},_s={class:"col-lg-2 col-md-4 col-6"},Is={class:"col-lg-2 col-md-4 col-6"},Ss={class:"col-lg-2 col-md-4 col-6"},xs={class:"col-lg-2 col-md-4 col-6"},ks={class:"col-lg-2 col-md-4 col-6"},Ts={key:1,class:"row g-4"},Cs=["onClick","aria-label","onKeydown"],Es={key:0,class:"position-absolute top-0 end-0 m-3",style:{"z-index":"5"}},qs={class:"card-body p-6"},Ps={class:"d-flex align-items-start justify-content-between mb-4"},Ns={class:"d-flex align-items-center gap-3"},Ls={class:"text-gray-900 fw-bolder fs-5 mb-1"},Os={class:"text-gray-600 fs-6 mb-0"},Ms={class:"d-flex flex-column gap-1"},Us={class:"bg-light-info rounded-3 p-3 mb-4"},Fs={class:"row g-2"},Vs={class:"col-6"},$s={class:"text-center"},Gs={class:"text-info fw-bold fs-6"},Bs={class:"col-6"},Hs={class:"text-center"},Ys={class:"text-info fw-bold fs-6"},js={class:"row g-3 mb-4"},Js={class:"col-6"},zs={class:"text-center"},Xs={class:"text-gray-900 fw-bold fs-6"},Qs={class:"col-6"},Ks={class:"text-center"},Ws={class:"text-primary fw-bold fs-6"},Zs={class:"bg-light-secondary rounded-3 p-3 mb-4"},ea={class:"d-flex align-items-center gap-2"},ta={class:"text-gray-900 fw-bold fs-7"},sa={class:"text-gray-600 fs-8"},aa={class:"mb-4"},na={class:"d-flex align-items-center justify-content-between mb-2"},oa={class:"fw-bold fs-6"},ia={class:"progress h-8px bg-light-secondary rounded-3"},ra={class:"d-flex align-items-center justify-content-between"},la={class:"d-flex align-items-center gap-2"},ca={class:"text-end"},da={key:2,class:"text-center py-20"},ua={class:"text-gray-600 fw-bold fs-4"},pa={key:3,class:"text-center py-20"},va={key:2,class:"modal fade",id:"approvalModal",tabindex:"-1"},ga={class:"modal-dialog modal-dialog-centered modal-xl"},ma={class:"modal-content border-0 shadow-xl"},ha={class:"modal-header bg-primary"},fa={class:"d-flex align-items-center gap-3"},ya={class:"modal-title text-white fw-bolder mb-0"},Aa={class:"text-light fs-6 mb-0"},ba={class:"modal-body p-6"},Ra={key:0,class:"card border border-danger mb-6"},Da={class:"card-body"},wa={class:"row g-4"},_a={class:"col-md-4"},Ia={class:"text-center"},Sa={class:"text-danger fw-bolder fs-2"},xa={class:"col-md-4"},ka={class:"text-center"},Ta={class:"text-warning fw-bolder fs-2"},Ca={class:"col-md-4"},Ea={class:"text-center"},qa={class:"mt-4"},Pa={class:"bg-light rounded-3 p-3"},Na={class:"mb-0"},La={key:0,class:"mt-4"},Oa={class:"bg-light-info rounded-3 p-3"},Ma={class:"mb-0"},Ua={class:"card border border-info mb-6"},Fa={class:"card-body"},Va={class:"row g-4"},$a={class:"col-md-6"},Ga={class:"bg-light rounded-3 p-3"},Ba={class:"mb-2"},Ha={class:"mb-2"},Ya={class:"mb-2"},ja={class:"mb-2"},Ja={class:"mb-0"},za={class:"col-md-6"},Xa={class:"bg-light rounded-3 p-3"},Qa={class:"mb-2"},Ka={class:"mb-2"},Wa={class:"mb-2"},Za={class:"mb-0"},en={class:"mt-4"},tn={class:"bg-light-secondary rounded-3 p-3"},sn={class:"mb-0"},an={class:"card border border-success mb-6"},nn={class:"card-body"},on={class:"timeline"},rn={class:"timeline-content ms-3"},ln={class:"d-flex align-items-center justify-content-between mb-2"},cn={class:"text-gray-900 fw-bold mb-0"},dn={class:"text-gray-600 fs-7 mb-1"},un={class:"text-gray-500 fs-8 mb-0"},pn={key:1,class:"card border border-warning mb-6"},vn={class:"card-body"},gn={class:"row g-4"},mn={class:"col-12"},hn={class:"form-text d-flex justify-content-between"},fn={key:0,class:"mt-4"},yn={class:"bg-light-danger rounded-3 p-4"},An={class:"form-check"},bn={class:"modal-footer bg-light-secondary p-6"},Rn={class:"d-flex w-100 gap-3"},Dn={key:0,class:"d-flex gap-3 flex-grow-1"},wn=["disabled"],_n={key:0,class:"spinner-border spinner-border-sm me-2"},In={key:1,class:"ki-duotone ki-cross fs-4 me-2"},Sn=["disabled"],xn={key:0,class:"spinner-border spinner-border-sm me-2"},kn={key:1,class:"ki-duotone ki-check fs-4 me-2"},Tn={key:1,class:"flex-grow-1 text-center"},Cn={class:"modal fade",id:"statsModal",tabindex:"-1"},En={class:"modal-dialog modal-dialog-centered modal-lg"},qn={class:"modal-content border-0 shadow-lg"},Pn={class:"modal-body p-6"},Nn={class:"mb-6"},Ln={class:"row g-4"},On={class:"col-md-3"},Mn={class:"text-center"},Un={class:"text-success fw-bold fs-3"},Fn={class:"col-md-3"},Vn={class:"text-center"},$n={class:"text-danger fw-bold fs-3"},Gn={class:"col-md-3"},Bn={class:"text-center"},Hn={class:"text-warning fw-bold fs-3"},Yn={class:"col-md-3"},jn={class:"text-center"},Jn={class:"text-info fw-bold fs-3"},zn={class:"bg-light rounded-3 p-4"},Xn={key:0},Qn={class:"flex-grow-1"},Kn={class:"text-gray-900 fw-bold fs-7"},Wn={class:"text-gray-600 fs-8"},Zn={class:"text-gray-500 fs-8"},eo={key:1,class:"text-center text-gray-600"},to="https://backend.cloudfuelstationmis.com/api/records/v1",so={__name:"ApprovalsStation",setup(ao){var xe;const $=A(JSON.parse(localStorage.getItem("kigrama_user_data")||"{}")),u=x(()=>$.value.user||{}),b=x(()=>{const s=$.value.stations||[];return s.find(e=>e.IsPrimary==="1")||s[0]||null}),k=x(()=>{var s;return((s=u.value)==null?void 0:s.Role)||"Unknown"}),U=x(()=>{const s=$.value.positions||[],e=s.find(a=>a.IsPrimary==="1")||s[0];return(e==null?void 0:e.PositionTitle)||"Unknown"}),ce=x(()=>{const s=k.value.toLowerCase(),e=U.value.toLowerCase();return s.includes("admin")||s.includes("manager")||s.includes("supervisor")||s.includes("controller")||s.includes("cfo")||s.includes("approver")||e.includes("manager")||e.includes("supervisor")||e.includes("controller")||e.includes("head")||e.includes("lead")}),p=x(()=>{const s=k.value.toLowerCase(),e=U.value.toLowerCase();return s.includes("cfo")||e.includes("cfo")?"CFO Level":s.includes("finance")&&(s.includes("controller")||e.includes("controller"))?"Finance Controller":s.includes("manager")||e.includes("manager")?"Manager Level":s.includes("supervisor")||e.includes("supervisor")?"Supervisor Level":s.includes("admin")?"System Admin":"Approver"}),S=x(()=>{const s=k.value.toLowerCase();return s.includes("cfo")?"Unlimited":s.includes("controller")?"Finance":s.includes("manager")?"Station":"Limited"}),qe=x(()=>{switch(S.value){case"Unlimited":return"badge-light-success";case"Finance":return"badge-light-info";case"Station":return"badge-light-warning";default:return"badge-light-secondary"}}),T=A(!0),O=A("Initializing approval management system..."),de=A(""),te=A(`${((xe=u.value)==null?void 0:xe.id)||"unknown"}-${Date.now()}`),F=A([]),h=A([]),ue=A([]);A([]);const N=A([]),j=B(new Map),pe=B(new Map),ve=B(new Map),_=A(null),C=A(null),g=B({status:"",type:"",priority:"",riskLevel:"",dateFrom:"",dateTo:""}),v=A(null),D=A(""),V=A(!1),L=A(!1),P=B({approved:0,denied:0,escalated:0,avgTime:0}),se=A([]);let J=null,z=null;const ge=x(()=>{let s=h.value;if(g.status&&(s=s.filter(e=>e.Status===g.status)),g.type&&(s=s.filter(e=>e.RequestType===g.type)),g.priority&&(s=s.filter(e=>e.Priority===g.priority)),g.riskLevel){const e=g.riskLevel;s=s.filter(a=>Ae(a)===e)}return g.dateFrom&&(s=s.filter(e=>new Date(e.RequestDate)>=new Date(g.dateFrom))),s.sort((e,a)=>{const o={Critical:4,High:3,Normal:2,Low:1},i=o[e.Priority]||0,l=o[a.Priority]||0;return i!==l?l-i:new Date(a.RequestDate)-new Date(e.RequestDate)})}),me=x(()=>h.value.filter(s=>E(s)>=75).length),Pe=x(()=>{const s=new Date,e=new Date(s.getTime()-24*60*60*1e3),a=h.value.filter(i=>new Date(i.CompletedAt||i.UpdatedAt)>=e&&(i.Status==="Approved"||i.Status==="Denied")).length,o=F.value.length;return o===0?100:Math.min(100,Math.round(a/(a+o)*100))}),Ne=x(()=>{const s=new Date().toISOString().split("T")[0];return h.value.filter(e=>(e.CompletedAt||e.UpdatedAt||"").split("T")[0]===s&&(e.Status==="Approved"||e.Status==="Denied")).length}),he=()=>{const s=new Date;de.value=s.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})},m=async(s,e={})=>{var a,o,i,l;try{const n=await fetch(`${to}${s}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${Le()}`,"X-Station-ID":(o=(a=b.value)==null?void 0:a.StationID)==null?void 0:o.toString(),"X-User-ID":(l=(i=u.value)==null?void 0:i.id)==null?void 0:l.toString(),"X-Session-ID":te.value,"X-Approval-Authority":p.value,...e.headers},...e});if(!n.ok){const I=await n.json().catch(()=>({}));throw new Error(I.message||`HTTP ${n.status}`)}return await n.json()}catch(n){throw console.error("API Error:",n),n}},Le=()=>$.value.token||localStorage.getItem("kigrama_auth_token")||"",fe=async()=>{var s,e,a;console.log("📊 METER READING APPROVAL SYSTEM: Loading approval data with authority level:",p.value);try{O.value="Loading meter reading approval requests...";let o="/Approvals?RequestType=Meter_Reading_Variance";S.value==="Station"&&((s=b.value)!=null&&s.StationID)?o+=`&RequesterStationID=${b.value.StationID}`:S.value==="Unlimited"||S.value==="Limited"&&(o+=`&CurrentApproverUserID=${(e=u.value)==null?void 0:e.id}`),console.log("📡 APPROVAL QUERY:",o);const i=await m(o);h.value=i.records||[],console.log("📊 LOADED METER READING APPROVALS:",{total:h.value.length,pending:h.value.filter(l=>l.Status==="Pending").length,approved:h.value.filter(l=>l.Status==="Approved").length,denied:h.value.filter(l=>l.Status==="Denied").length,authority:S.value}),F.value=h.value.filter(l=>{var n,I;return l.Status!=="Pending"?!1:S.value==="Unlimited"?!0:S.value==="Station"&&((n=b.value)!=null&&n.StationID)?l.RequesterStationID===b.value.StationID:S.value==="Limited"?l.CurrentApproverUserID===((I=u.value)==null?void 0:I.id):!1}),console.log("📊 FILTERED PENDING APPROVALS:",{pendingCount:F.value.length,authority:S.value,stationId:(a=b.value)==null?void 0:a.StationID}),O.value="Loading user information...",await Oe(),O.value="Loading station data...",await Me(),O.value="Checking meter reading fraud detection...",await Ue(),O.value="Loading approval statistics...",await Ve()}catch(o){throw console.error("💥 METER READING APPROVAL LOADING ERROR:",o),o}},Oe=async()=>{try{((await m("/users")).records||[]).forEach(a=>{j.set(a.id,{name:a.name||a.email,role:a.Role,position:a.Position,email:a.email})}),console.log("✅ APPROVAL SYSTEM: Loaded user lookup:",j.size)}catch(s){console.error("Error loading users:",s)}},Me=async()=>{try{const[s,e]=await Promise.all([m("/Stations"),m("/Departments")]),a=s.records||[],o=e.records||[];a.forEach(i=>{pe.set(i.StationID,i.StationName)}),o.forEach(i=>{ve.set(i.DepartmentID,i.DepartmentName)}),console.log("✅ APPROVAL SYSTEM: Loaded lookup data")}catch(s){console.error("Error loading lookup data:",s)}},Ue=async()=>{try{const s=await m("/FraudDetectionLogs?Status=Open&FraudType=Meter_Reading_Variance");N.value=s.records||[],console.log("📊 METER READING FRAUD DETECTION:",{totalFraudLogs:N.value.length,criticalAlerts:N.value.filter(a=>a.Severity==="Critical").length,highRiskAlerts:N.value.filter(a=>a.Severity==="High").length});const e=N.value.find(a=>a.Severity==="Critical"&&parseFloat(a.RiskScore||"0")>=90&&a.FraudType==="Meter_Reading_Variance");e&&(_.value={id:e.FraudLogID,description:e.Description||"High-risk meter reading variance detected - potential fuel theft or manipulation",riskScore:e.RiskScore||"90",severity:e.Severity||"Critical",detectedAt:e.DetectedAt,fraudType:"Meter_Reading_Variance"}),await Fe(),console.log("✅ METER READING FRAUD DETECTION: Loaded fraud detection data:",N.value.length)}catch(s){console.error("💥 METER READING FRAUD DETECTION ERROR:",s)}},Fe=async()=>{try{const e=(await m("/FraudDetectionRules")).records||[],a=[{RuleName:"Excessive_Meter_Variance",Description:"Detects meter reading variances exceeding 50L threshold",Threshold:"50.0",Enabled:"1"},{RuleName:"Repeated_High_Variances",Description:"Detects attendants with multiple high variance submissions",Threshold:"3.0",Enabled:"1"},{RuleName:"Off_Hours_Reading_Manipulation",Description:"Detects suspicious meter readings submitted during off-hours",Threshold:"22.0",Enabled:"1"}];for(const o of a)e.find(l=>l.RuleName===o.RuleName)||(console.log("📡 CREATING FRAUD RULE:",o.RuleName),await m("/FraudDetectionRules",{method:"POST",body:JSON.stringify(o)}))}catch(s){console.error("Error creating fraud rules:",s)}},Ve=async()=>{try{const s=h.value.filter(a=>{var o,i;return a.CurrentApproverUserID===((o=u.value)==null?void 0:o.id)||a.Status!=="Pending"&&a.RequesterUserID===((i=u.value)==null?void 0:i.id)});P.approved=s.filter(a=>a.Status==="Approved").length,P.denied=s.filter(a=>a.Status==="Denied").length,P.escalated=s.filter(a=>a.Status==="Escalated").length;const e=s.filter(a=>a.CompletedAt);if(e.length>0){const a=e.reduce((o,i)=>{const l=new Date(i.RequestDate),n=new Date(i.CompletedAt);return o+(n-l)},0);P.avgTime=Math.round(a/e.length/(1e3*60*60))}$e(),console.log("✅ APPROVAL SYSTEM: Statistics loaded:",P)}catch(s){console.error("Error loading approval stats:",s)}},$e=()=>{const s=h.value.filter(e=>e.UpdatedAt||e.CompletedAt).sort((e,a)=>new Date(a.UpdatedAt||a.CompletedAt)-new Date(e.UpdatedAt||e.CompletedAt)).slice(0,5).map(e=>({id:e.ApprovalID,action:e.Status,title:e.RequestTitle,description:`${e.RequestType.replace("_"," ")} - ${X(e.RequestAmount)}`,timeAgo:ot(e.UpdatedAt||e.CompletedAt)}));se.value=s},E=s=>{let e=0;const a=parseFloat(s.RequestAmount||"0");a>1e5?e+=30:a>5e4?e+=20:a>1e4?e+=10:e+=5;const o=new Date(s.RequestDate),i=o.getHours(),l=o.getDay();(i<6||i>22)&&(e+=15),(l===0||l===6)&&(e+=10),s.Priority==="Critical"?e+=15:s.Priority==="High"&&(e+=10),e+={Purchase_Order:10,Stock_Adjustment:15,Price_Change:20,Emergency_Override:25,Ledger_Correction:15}[s.RequestType]||5;const I=ye(s.RequesterUserID);return e+=I,Math.min(100,Math.max(0,e))},ye=s=>{const e=h.value.filter(i=>i.RequesterUserID===s);if(e.length===0)return 5;const o=e.filter(i=>i.Status==="Denied").length/e.length;return o>.3?15:o>.2?10:o>.1?7:3},Ge=s=>[s.RequestAmount?20:0,s.RequestDetails?15:0,s.RequesterUserID?20:0,s.RequestType?15:0,s.Priority?10:0,s.RequesterStationID?10:0,s.RequesterDepartmentID?10:0].reduce((a,o)=>a+o,0),Ae=s=>{const e=E(s);return e>=75?"Critical":e>=60?"High":e>=40?"Medium":"Low"},Be=s=>E(s)>=80||N.value.some(e=>e.TransactionID===s.RequestTypeID&&e.Severity==="Critical"),He=s=>{const e=E(s),a=[],o=[];if(s.RequestType==="Meter_Reading_Variance"){const i=parseFloat(s.RequestAmount||"0");i>50?(a.push(`Extremely high meter variance: ${i}L exceeds normal operational limits`),o.push("Verify physical meter readings and check for equipment malfunction or manipulation")):i>30&&(a.push(`Significant meter variance: ${i}L requires detailed investigation`),o.push("Review transaction logs and compare with dip stick readings"));const n=new Date(s.RequestDate).getHours();(n<6||n>22)&&(a.push("Meter reading submitted during off-business hours - unusual timing"),o.push("Verify attendant was on authorized shift and readings are legitimate")),ye(s.RequesterUserID)>10&&(a.push("Attendant has history of high variance or denied meter reading requests"),o.push("Review attendant training records and consider additional supervision"));const ke=K(s.RequesterStationID);ke!=="Unknown Station"&&h.value.filter(le=>le.RequesterStationID===s.RequesterStationID&&le.RequestType==="Meter_Reading_Variance"&&parseFloat(le.RequestAmount||"0")>20).length>3&&(a.push(`Station ${ke} has multiple high variance requests - pattern detected`),o.push("Investigate station equipment, procedures, and staff training")),i>25&&n>=22&&(a.push("High variance combined with late-night submission suggests potential fuel theft"),o.push("Immediate physical verification required - check for equipment tampering")),e>=75&&(o.push("Require dual witness verification for all readings at this station"),o.push("Implement mandatory CCTV review for high variance periods"))}else{const i=parseFloat(s.RequestAmount||"0");i>5e4&&(a.push(`High amount transaction: ${X(i)}`),o.push("Verify with finance controller and require additional documentation"));const n=new Date(s.RequestDate).getHours();(n<6||n>22)&&(a.push("Request submitted during off-business hours"),o.push("Verify requester identity and business justification")),s.Priority==="Critical"&&(a.push("Marked as critical priority - bypass attempt potential"),o.push("Verify urgency with station manager and document justification"))}return{riskScore:e,severity:Ae(s),anomalies:a.length,riskFactors:a,recommendations:o}},ae=s=>{var a;if(s.Status!=="Pending")return!1;if(k.value.toLowerCase().includes("system")&&k.value.toLowerCase().includes("admin"))return!0;if(s.RequestType==="Meter_Reading_Variance"){if(p.value.includes("Manager")&&((a=b.value)!=null&&a.StationID))return s.RequesterStationID===b.value.StationID;if(p.value.includes("Controller")||p.value==="CFO Level")return!0}const e=parseFloat(s.RequestAmount||"0");switch(s.RequestType){case"Purchase_Order":return e>1e4&&p.value!=="CFO Level"?!1:p.value.includes("Manager")||p.value.includes("Controller");case"Stock_Adjustment":return e>2e3&&!p.value.includes("Controller")?!1:p.value.includes("Manager")||p.value.includes("Controller");case"Price_Change":return p.value==="CFO Level";case"Ledger_Correction":return p.value.includes("Controller")||p.value==="CFO Level";case"Emergency_Override":return p.value.includes("Manager")||p.value==="CFO Level";default:return p.value.includes("Manager")||p.value.includes("Supervisor")}},ne=s=>{const e=E(s),a=parseFloat(s.RequestAmount||"0");return e>=70||a>5e4||s.RequestType==="Emergency_Override"||s.Priority==="Critical"},Ye=(s,e)=>!0,je=async()=>{if(!v.value)return;const s=v.value;if(ne(s)&&!V.value){await y.fire({title:"Security Verification Required",text:"Please complete the security verification before approving this high-risk request.",icon:"warning"});return}L.value=!0;try{console.log("🔄 APPROVAL PROCESSING: Starting meter reading approval workflow..."),console.log("📊 APPROVAL CONTEXT:",{approvalId:s.ApprovalID,requestType:s.RequestType,pumpId:s.RequestTypeID,stationId:s.RequesterStationID,attendantId:s.RequesterUserID,approver:u.value.name});const e={ApprovalID:s.ApprovalID,StepID:null,UserID:u.value.id,ActionType:"Approved",Comments:D.value||`Meter reading variance approved by ${u.value.name} - ${p.value}. Risk assessment completed and acceptable.`,IPAddress:"client_ip",UserAgent:navigator.userAgent};console.log("📡 CREATING APPROVAL ACTION:",e),await m("/ApprovalActions",{method:"POST",body:JSON.stringify(e)});const a={Status:"Approved",CompletedAt:new Date().toISOString(),CurrentApproverUserID:null,CurrentApprovalLevel:"1",Priority:"Completed"};console.log("📡 UPDATING APPROVAL STATUS:",a),await m(`/Approvals/${s.ApprovalID}`,{method:"PATCH",body:JSON.stringify(a)}),s.RequestType==="Meter_Reading_Variance"&&await be(s,"Approved");const o={UserID:s.RequesterUserID,StationID:s.RequesterStationID,Channel:"System",Type:"Approval_Approved",Title:"✅ Meter Reading Approved",Message:`Your meter reading variance has been approved by ${u.value.name}. You can now continue with operations.`,Status:"Queued",ScheduledAt:new Date().toISOString()};console.log("📡 CREATING APPROVAL NOTIFICATION:",o),await m("/Notifications",{method:"POST",body:JSON.stringify(o)}),await Z("METER_READING_APPROVED",{approvalId:s.ApprovalID,requestType:s.RequestType,pumpId:s.RequestTypeID,stationId:s.RequesterStationID,attendantId:s.RequesterUserID,variance:s.RequestAmount,riskScore:E(s),securityVerified:V.value,comments:D.value,approver:u.value.name,approverLevel:p.value,completedAt:new Date().toISOString()}),await y.fire({title:"Meter Reading Approved!",html:`
        <div class="text-start">
          <p><strong>${s.RequestTitle}</strong> has been approved.</p>
          <hr/>
          <p><strong>Details:</strong></p>
          <ul>
            <li><strong>Pump:</strong> ${s.RequestTitle}</li>
            <li><strong>Variance:</strong> ${s.RequestAmount}L</li>
            <li><strong>Attendant:</strong> ${Q(s.RequesterUserID)}</li>
            <li><strong>Station:</strong> ${K(s.RequesterStationID)}</li>
          </ul>
          <p class="text-success">✅ The attendant can now continue operations.</p>
        </div>
      `,icon:"success",toast:!0,position:"top-end",timer:5e3,showConfirmButton:!1}),W(),await re()}catch(e){console.error("💥 APPROVAL ERROR:",e),await y.fire({title:"Approval Failed!",text:e.message,icon:"error"})}finally{L.value=!1}},Je=async()=>{if(!v.value)return;if(!D.value){await y.fire({title:"Comments Required",text:"Please provide detailed comments explaining why this meter reading variance is being denied.",icon:"warning"});return}if((await y.fire({title:"Confirm Meter Reading Denial",html:`
      <div class="text-start">
        <p>Are you sure you want to deny this meter reading variance?</p>
        <hr/>
        <p><strong>Impact:</strong></p>
        <ul>
          <li>The attendant will need to re-record readings</li>
          <li>The pump will remain locked until corrected</li>
          <li>This will be logged in the audit trail</li>
        </ul>
        <p><strong>Your reason:</strong></p>
        <div class="bg-light p-3 rounded">${D.value}</div>
      </div>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Deny Request",cancelButtonText:"Cancel",confirmButtonColor:"#f1416c"})).isConfirmed){L.value=!0;try{const e=v.value;console.log("🔄 DENIAL PROCESSING: Starting meter reading denial workflow..."),console.log("📊 DENIAL CONTEXT:",{approvalId:e.ApprovalID,requestType:e.RequestType,pumpId:e.RequestTypeID,denialReason:D.value,denier:u.value.name});const a={ApprovalID:e.ApprovalID,StepID:null,UserID:u.value.id,ActionType:"Denied",Comments:D.value,IPAddress:"client_ip",UserAgent:navigator.userAgent};console.log("📡 CREATING DENIAL ACTION:",a),await m("/ApprovalActions",{method:"POST",body:JSON.stringify(a)});const o={Status:"Denied",CompletedAt:new Date().toISOString(),CurrentApproverUserID:null,CurrentApprovalLevel:"1",Priority:"Denied"};console.log("📡 UPDATING APPROVAL STATUS TO DENIED:",o),await m(`/Approvals/${e.ApprovalID}`,{method:"PATCH",body:JSON.stringify(o)}),e.RequestType==="Meter_Reading_Variance"&&await be(e,"Denied");const i={UserID:e.RequesterUserID,StationID:e.RequesterStationID,Channel:"System",Type:"Approval_Denied",Title:"❌ Meter Reading Denied",Message:`Your meter reading variance has been denied by ${u.value.name}. Reason: ${D.value}. Please re-record accurate readings.`,Status:"Queued",ScheduledAt:new Date().toISOString()};console.log("📡 CREATING DENIAL NOTIFICATION:",i),await m("/Notifications",{method:"POST",body:JSON.stringify(i)}),await Z("METER_READING_DENIED",{approvalId:e.ApprovalID,requestType:e.RequestType,pumpId:e.RequestTypeID,stationId:e.RequesterStationID,attendantId:e.RequesterUserID,variance:e.RequestAmount,riskScore:E(e),denialReason:D.value,denier:u.value.name,approverLevel:p.value,completedAt:new Date().toISOString()}),await y.fire({title:"Meter Reading Denied",html:`
        <div class="text-start">
          <p><strong>${e.RequestTitle}</strong> has been denied.</p>
          <hr/>
          <p><strong>Reason:</strong> ${D.value}</p>
          <p class="text-warning">⚠️ The attendant must re-record accurate readings.</p>
        </div>
      `,icon:"success",toast:!0,position:"top-end",timer:5e3,showConfirmButton:!1}),W(),await re()}catch(e){console.error("💥 DENIAL ERROR:",e),await y.fire({title:"Denial Failed!",text:e.message,icon:"error"})}finally{L.value=!1}}},be=async(s,e)=>{console.log("🔄 METER READING HANDLER: Processing specific meter reading logic..."),console.log("📊 METER READING CONTEXT:",{pumpId:s.RequestTypeID,stationId:s.RequesterStationID,attendantId:s.RequesterUserID,actionType:e});try{if(e==="Approved"){const o=(await m(`/DailyReadings?PumpID=${s.RequestTypeID}&RecordedBy=${s.RequesterUserID}&Status=Pending_Approval`)).records||[];console.log("📡 FOUND DAILY READINGS:",o.length);for(const i of o){const l={Status:"Approved",VerifiedBy:u.value.id,Notes:(i.Notes||"")+` | APPROVED by ${u.value.name} on ${new Date().toISOString()}`};if(console.log("📡 UPDATING DAILY READING:",i.ReadingID,l),await m(`/DailyReadings/${i.ReadingID}`,{method:"PATCH",body:JSON.stringify(l)}),i.ClosingReading){const I={MeterReading:i.ClosingReading,UpdatedAt:new Date().toISOString()};console.log("📡 UPDATING PUMP METER READING:",s.RequestTypeID,I),await m(`/Pumps/${s.RequestTypeID}`,{method:"PATCH",body:JSON.stringify(I)})}const n={StationID:s.RequesterStationID,ProductID:i.ProductID||1,PumpID:s.RequestTypeID,TransactionID:null,TransferID:null,ChangeDate:new Date().toISOString(),ChangeType:"Variance_Approved",PreviousQuantity:i.OpeningReading||"0",QuantityChange:i.Variance||"0",NewQuantity:i.ClosingReading||"0",ReasonForChange:`Meter reading variance approved: ${i.Variance}L variance`,AdjustmentCategory:"Approved_Variance",AuthorizedBy:u.value.id,RecordedBy:s.RequesterUserID,VerifiedBy:u.value.id,Notes:`Approval ID: ${s.ApprovalID} | Approved by: ${u.value.name}`};console.log("📡 CREATING INVENTORY HISTORY:",n),await m("/InventoryHistory",{method:"POST",body:JSON.stringify(n)})}}else if(e==="Denied"){const o=(await m(`/DailyReadings?PumpID=${s.RequestTypeID}&RecordedBy=${s.RequesterUserID}&Status=Pending_Approval`)).records||[];console.log("📡 FOUND DAILY READINGS FOR DENIAL:",o.length);for(const i of o){const l={Status:"Denied",VerifiedBy:u.value.id,Notes:(i.Notes||"")+` | DENIED by ${u.value.name} on ${new Date().toISOString()} - Reason: ${D.value}`};console.log("📡 UPDATING DAILY READING TO DENIED:",i.ReadingID,l),await m(`/DailyReadings/${i.ReadingID}`,{method:"PATCH",body:JSON.stringify(l)})}}console.log("✅ METER READING HANDLER: Successfully processed meter reading logic")}catch(a){throw console.error("💥 METER READING HANDLER ERROR:",a),a}},ze=()=>{console.log("🔄 REAL-TIME POLLING: Starting approval status monitoring for meter reading integration..."),approvalPollingInterval.value&&clearInterval(approvalPollingInterval.value),approvalPollingInterval.value=setInterval(async()=>{try{await Qe()}catch(s){console.error("💥 APPROVAL POLLING ERROR:",s)}},15e3)},Xe=()=>{approvalPollingInterval.value&&(clearInterval(approvalPollingInterval.value),approvalPollingInterval.value=null,console.log("🛑 REAL-TIME POLLING: Stopped"))},Qe=async()=>{if(!T.value)try{const e=(await m("/Approvals?RequestType=Meter_Reading_Variance&Status=Pending")).records||[],a=new Set(h.value.map(i=>i.ApprovalID)),o=e.filter(i=>!a.has(i.ApprovalID));if(o.length>0&&(console.log("📡 NEW METER READING APPROVALS DETECTED:",o.length),h.value=[...h.value,...o],F.value=h.value.filter(i=>i.Status==="Pending"&&ae(i)),o.length>0)){const i=o[0];await y.fire({title:"New Meter Reading Approval",html:`
            <div class="text-start">
              <p><strong>${i.RequestTitle}</strong></p>
              <p><strong>Variance:</strong> ${i.RequestAmount}L</p>
              <p><strong>Station:</strong> ${K(i.RequesterStationID)}</p>
              <p><strong>Attendant:</strong> ${Q(i.RequesterUserID)}</p>
            </div>
          `,icon:"info",toast:!0,position:"top-end",timer:5e3,showConfirmButton:!1})}}catch(s){console.error("Error checking for approval updates:",s)}},Re=s=>{const e=parseFloat(s.RequestAmount||"0");switch(s.RequestType){case"Purchase_Order":return e>5e4?3:2;case"Price_Change":return 3;case"Emergency_Override":return 2;default:return 2}},Ke=s=>{const e=parseInt(s.CurrentApprovalLevel)||1,a=Re(s);return Math.round(e/a*100)},We=s=>{const e=E(s);return e>=80?"border-danger":e>=60?"border-warning":s.Priority==="Critical"?"border-danger":""},Ze=s=>{switch(s.Status){case"Approved":return"bg-light-success";case"Denied":return"bg-light-danger";case"Escalated":return"bg-light-warning";default:return"bg-light-primary"}},et=s=>{switch(s.Status){case"Approved":return"ki-check text-success";case"Denied":return"ki-cross text-danger";case"Escalated":return"ki-arrow-up text-warning";default:return"ki-time text-primary"}},tt=s=>{switch(s){case"Approved":return"badge-light-success";case"Denied":return"badge-light-danger";case"Escalated":return"badge-light-warning";case"Pending":return"badge-light-primary";default:return"badge-light-secondary"}},st=s=>{switch(s){case"Critical":return"badge-light-danger";case"High":return"badge-light-warning";case"Normal":return"badge-light-info";case"Low":return"badge-light-secondary";default:return"badge-light-secondary"}},at=s=>{switch(s){case"Critical":return"badge-danger";case"High":return"badge-warning";case"Medium":return"badge-info";default:return"badge-secondary"}},nt=s=>{switch(De(s)){case"Critical":return"badge-danger";case"High":return"badge-warning";case"Medium":return"badge-info";default:return"badge-secondary"}},De=s=>{const e=Ie(s.RequestDate),a=E(s);return s.Priority==="Critical"||a>=80||e>=7?"Critical":s.Priority==="High"||a>=60||e>=3?"High":e>=1?"Medium":"Low"},we=s=>{if(!s.DueDate)return"No SLA";const e=new Date,o=new Date(s.DueDate)-e;if(o<0)return"Overdue";const i=Math.floor(o/(1e3*60*60));return i<24?`${i}h remaining`:`${Math.floor(i/24)}d remaining`},_e=s=>{const e=we(s);return e==="Overdue"?"text-danger":e.includes("h")&&parseInt(e)<=6?"text-warning":"text-info"},X=s=>{const e=parseFloat(s||"0");return new Intl.NumberFormat("en-UG",{style:"currency",currency:"UGX",minimumFractionDigits:0}).format(e)},oe=s=>s?new Date(s).toLocaleString("en-UG"):"Not set",Ie=s=>{const e=new Date(s),o=new Date-e;return Math.floor(o/(1e3*60*60*24))},ot=s=>{const e=new Date(s),o=new Date-e,i=Math.floor(o/(1e3*60));if(i<60)return`${i}m ago`;const l=Math.floor(i/60);return l<24?`${l}h ago`:`${Math.floor(l/24)}d ago`},Q=s=>{const e=j.get(s);return(e==null?void 0:e.name)||"Unknown User"},it=s=>{const e=j.get(s);return(e==null?void 0:e.position)||"Unknown Position"},K=s=>pe.get(s)||"Unknown Station",rt=s=>ve.get(s)||"Unknown Department",lt=s=>s.ApproverUserID?Q(s.ApproverUserID):s.ApproverType||"Auto-assigned",ct=(s,e)=>s.Status==="Completed"?"bg-success":s.Status==="In_Progress"?"bg-warning":"bg-light-secondary",dt=s=>{switch(s.Status){case"Completed":return"bg-success";case"In_Progress":return"bg-warning";default:return"bg-light-secondary"}},ut=s=>{switch(s){case"Completed":return"badge-light-success";case"In_Progress":return"badge-light-warning";default:return"badge-light-secondary"}},pt=s=>{switch(s){case"Approved":return"bg-light-success";case"Denied":return"bg-light-danger";case"Escalated":return"bg-light-warning";default:return"bg-light-info"}},vt=s=>{switch(s){case"Approved":return"ki-check text-success";case"Denied":return"ki-cross text-danger";case"Escalated":return"ki-arrow-up text-warning";default:return"ki-time text-info"}},ie=s=>{v.value=s,D.value="",V.value=!1,C.value=He(s),ue.value=[{StepID:1,StepNumber:1,ApproverType:p.value,ApproverUserID:u.value.id,Status:"In_Progress",StartedAt:s.RequestDate}],gt()},gt=()=>{Ce(()=>{const s=document.getElementById("approvalModal");s&&(J=new bootstrap.Modal(s),J.show())})},W=()=>{J&&J.hide(),v.value=null,C.value=null},mt=()=>{Ce(()=>{const s=document.getElementById("statsModal");s&&(z=new bootstrap.Modal(s),z.show())})},ht=()=>{z&&z.hide()},G=()=>{console.log("Filters applied:",g)},Se=()=>{Object.keys(g).forEach(s=>{g[s]=""})},ft=async()=>{if(!_.value)return;const s=await y.fire({title:"Fraud Investigation",html:`
      <div class="text-start">
        <p><strong>Risk Score:</strong> ${_.value.riskScore}%</p>
        <p><strong>Severity:</strong> ${_.value.severity}</p>
        <p><strong>Description:</strong> ${_.value.description}</p>
        <hr/>
        <p>How would you like to proceed?</p>
      </div>
    `,icon:"warning",showCancelButton:!0,showDenyButton:!0,confirmButtonText:"Escalate to Security",denyButtonText:"Mark as False Positive",cancelButtonText:"Continue Monitoring"});s.isConfirmed?(await Z("FRAUD_ESCALATED",{fraudLogId:_.value.id,action:"escalated_to_security",riskScore:_.value.riskScore}),await y.fire({title:"Escalated!",text:"Security team has been notified.",icon:"success"})):s.isDenied&&(await Z("FRAUD_FALSE_POSITIVE",{fraudLogId:_.value.id,action:"marked_false_positive"}),await y.fire({title:"Marked as False Positive",text:"The alert has been dismissed.",icon:"info"})),_.value=null},yt=async()=>{var e,a;if((await y.fire({title:"Request Approval Access",html:`
      <div class="text-start">
        <p>Submit a request for approval management access?</p>
        <hr/>
        <p><strong>Your Details:</strong></p>
        <ul>
          <li><strong>Name:</strong> ${u.value.name}</li>
          <li><strong>Role:</strong> ${k.value}</li>
          <li><strong>Position:</strong> ${U.value}</li>
          <li><strong>Station:</strong> ${(e=b.value)==null?void 0:e.StationName}</li>
        </ul>
      </div>
    `,icon:"question",showCancelButton:!0,confirmButtonText:"Submit Request",cancelButtonText:"Cancel"})).isConfirmed)try{const o={RequestType:"Access_Request",RequestTitle:"Approval Management Access Request",RequestDetails:`User ${u.value.name} requesting approval management access. Current role: ${k.value}, Position: ${U.value}`,RequesterUserID:u.value.id,RequesterStationID:(a=b.value)==null?void 0:a.StationID,Status:"Pending",Priority:"Normal"};await m("/Approvals",{method:"POST",body:JSON.stringify(o)}),await y.fire({title:"Request Submitted!",text:"Your access request has been sent to management for review.",icon:"success"})}catch(o){await y.fire({title:"Request Failed!",text:o.message,icon:"error"})}},re=async()=>{T.value=!0,O.value="Refreshing approval data...";try{await fe(),await y.fire({title:"Refreshed!",text:"Approval data has been updated.",icon:"success",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})}catch(s){await y.fire({title:"Refresh Failed!",text:s.message,icon:"error"})}finally{T.value=!1}},Z=async(s,e={})=>{var a,o;try{const i={StationID:(a=b.value)==null?void 0:a.StationID,UserID:(o=u.value)==null?void 0:o.id,Action:s.toUpperCase(),TableName:"Approvals",RecordID:e.approvalId||null,Changes:JSON.stringify({...e,sessionId:te.value,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,approverLevel:p.value,authorityLevel:S.value}),IPAddress:"client_ip"};await m("/AuditLogs",{method:"POST",body:JSON.stringify(i)})}catch(i){console.error("Audit logging failed:",i)}};return bt(async()=>{var e,a;console.log("🔄 METER READING APPROVAL MANAGEMENT: Initializing with authority level:",p.value),he();const s=setInterval(he,6e4);if(!$.value.user||!b.value){console.error("❌ AUTHENTICATION: Missing user or station data"),await y.fire({title:"Authentication Required",text:"Please login to access the meter reading approval system",icon:"warning"}),window.location.href="/login";return}if(!ce.value){console.log("❌ ACCESS CONTROL: Insufficient approval authority for meter reading approvals"),T.value=!1;return}try{await fe(),ze(),console.log("✅ METER READING APPROVAL MANAGEMENT: Initialization completed"),console.log("📊 METER READING APPROVAL FINAL STATE:",{userRole:k.value,userPosition:U.value,approverLevel:p.value,authorityLevel:S.value,totalApprovals:h.value.length,pendingApprovals:F.value.length,meterReadingApprovals:h.value.filter(o=>o.RequestType==="Meter_Reading_Variance").length,highRiskApprovals:me.value,fraudAlerts:N.value.length,stationId:(e=b.value)==null?void 0:e.StationID,stationName:(a=b.value)==null?void 0:a.StationName})}catch(o){console.error("💥 METER READING APPROVAL INITIALIZATION ERROR:",o),await y.fire({title:"System Error!",text:o.message,icon:"error"})}finally{T.value=!1}Rt(()=>{clearInterval(s),Xe()})}),(s,e)=>{var a,o,i,l;return d(),c("div",It,[ce.value?(d(),c("div",qt,[_.value?(d(),c("div",Pt,[t("div",Nt,[e[12]||(e[12]=f('<i class="ki-duotone ki-security-check fs-2x text-danger me-4" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span><span class="path5" data-v-9ce5c566></span><span class="path6" data-v-9ce5c566></span></i>',1)),t("div",Lt,[e[11]||(e[11]=t("h5",{class:"text-danger fw-bold mb-1"},"🚨 AI Fraud Detection Alert",-1)),t("p",Ot,r(_.value.description),1),t("div",Mt," Risk Score: "+r(_.value.riskScore)+"% • Severity: "+r(_.value.severity),1)]),t("button",{type:"button",class:"btn btn-sm btn-light-danger me-2",onClick:ft}," Investigate "),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=n=>_.value=null)})])])):q("",!0),t("div",Ut,[t("div",Ft,[t("div",Vt,[t("div",$t,[e[14]||(e[14]=f('<div class="symbol symbol-60px symbol-circle bg-light-success" data-v-9ce5c566><i class="ki-duotone ki-security-check fs-2x text-success" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span><span class="path5" data-v-9ce5c566></span><span class="path6" data-v-9ce5c566></span></i></div>',1)),t("div",null,[e[13]||(e[13]=t("h1",{class:"text-gray-900 fw-bolder fs-2 mb-1"},"Approval Management Center",-1)),t("p",Gt,r(((o=b.value)==null?void 0:o.StationName)||"System-wide Approvals"),1),t("div",Bt,r(p.value)+" • "+r(k.value),1)])]),t("div",Ht,[t("div",Yt,[e[15]||(e[15]=t("div",{class:"text-gray-900 fw-bold fs-6"},"Approval Authority",-1)),t("div",{class:R(["badge",qe.value])},r(S.value),3)]),t("button",{onClick:mt,class:"btn btn-light-info btn-sm"},e[16]||(e[16]=[f('<i class="ki-duotone ki-chart-simple fs-4" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span></i>',1)])),t("button",{onClick:re,class:"btn btn-light-primary btn-sm",disabled:T.value},[t("i",{class:R(["ki-duotone ki-arrows-circle fs-4",{"spinner-border spinner-border-sm":T.value}])},e[17]||(e[17]=[t("span",{class:"path1"},null,-1),t("span",{class:"path2"},null,-1)]),2)],8,jt)])]),t("div",Jt,[t("div",zt,[t("div",Xt,[e[18]||(e[18]=t("i",{class:"ki-duotone ki-time fs-3x text-danger mb-3"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),t("div",Qt,r(F.value.length),1),e[19]||(e[19]=t("div",{class:"text-gray-600 fw-bold fs-7"},"Pending Approvals",-1))])]),t("div",Kt,[t("div",Wt,[e[20]||(e[20]=f('<i class="ki-duotone ki-security-check fs-3x text-warning mb-3" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span><span class="path5" data-v-9ce5c566></span><span class="path6" data-v-9ce5c566></span></i>',1)),t("div",Zt,r(me.value),1),e[21]||(e[21]=t("div",{class:"text-gray-600 fw-bold fs-7"},"High Risk Items",-1))])]),t("div",es,[t("div",ts,[e[22]||(e[22]=t("i",{class:"ki-duotone ki-chart-line-up fs-3x text-info mb-3"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),t("div",ss,r(Pe.value)+"%",1),e[23]||(e[23]=t("div",{class:"text-gray-600 fw-bold fs-7"},"24h Velocity",-1))])]),t("div",as,[t("div",ns,[e[24]||(e[24]=f('<i class="ki-duotone ki-verify fs-3x text-success mb-3" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span><span class="path5" data-v-9ce5c566></span><span class="path6" data-v-9ce5c566></span></i>',1)),t("div",os,r(Ne.value),1),e[25]||(e[25]=t("div",{class:"text-gray-600 fw-bold fs-7"},"Completed Today",-1))])])]),t("div",is,[e[30]||(e[30]=f('<div class="card-header bg-light-success" data-v-9ce5c566><h5 class="text-success fw-bold mb-0" data-v-9ce5c566><i class="ki-duotone ki-user-tick fs-4 me-2" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span></i> Auto-Detected Approver Session </h5></div>',1)),t("div",rs,[t("div",ls,[t("div",cs,[t("div",ds,[t("div",us,r((i=u.value)==null?void 0:i.name),1),e[26]||(e[26]=t("div",{class:"text-gray-600 fs-8"},"Approver",-1))])]),t("div",ps,[t("div",vs,[t("div",gs,r(p.value),1),e[27]||(e[27]=t("div",{class:"text-gray-600 fs-8"},"Authority Level",-1))])]),t("div",ms,[t("div",hs,[t("div",fs,r(de.value),1),e[28]||(e[28]=t("div",{class:"text-gray-600 fs-8"},"Session Time",-1))])]),t("div",ys,[t("div",As,[t("div",bs,r(te.value.split("-")[0]),1),e[29]||(e[29]=t("div",{class:"text-gray-600 fs-8"},"Session ID",-1))])])])])])])]),t("div",Rs,[t("div",Ds,[t("div",ws,[t("div",_s,[M(t("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>g.status=n),onChange:G,class:"form-select form-select-lg"},e[31]||(e[31]=[f('<option value="" data-v-9ce5c566>All Status</option><option value="Pending" data-v-9ce5c566>Pending</option><option value="Approved" data-v-9ce5c566>Approved</option><option value="Denied" data-v-9ce5c566>Denied</option><option value="Escalated" data-v-9ce5c566>Escalated</option>',5)]),544),[[ee,g.status]])]),t("div",Is,[M(t("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>g.type=n),onChange:G,class:"form-select form-select-lg"},e[32]||(e[32]=[f('<option value="" data-v-9ce5c566>All Types</option><option value="Purchase_Order" data-v-9ce5c566>Purchase Orders</option><option value="Meter_Reading_Variance" data-v-9ce5c566>Meter Variances</option><option value="Stock_Adjustment" data-v-9ce5c566>Stock Adjustments</option><option value="Price_Change" data-v-9ce5c566>Price Changes</option><option value="Transfer_Request" data-v-9ce5c566>Transfers</option><option value="Ledger_Correction" data-v-9ce5c566>Ledger Corrections</option><option value="Emergency_Override" data-v-9ce5c566>Emergency Overrides</option>',8)]),544),[[ee,g.type]])]),t("div",Ss,[M(t("select",{"onUpdate:modelValue":e[3]||(e[3]=n=>g.priority=n),onChange:G,class:"form-select form-select-lg"},e[33]||(e[33]=[f('<option value="" data-v-9ce5c566>All Priority</option><option value="Critical" data-v-9ce5c566>Critical</option><option value="High" data-v-9ce5c566>High</option><option value="Normal" data-v-9ce5c566>Normal</option><option value="Low" data-v-9ce5c566>Low</option>',5)]),544),[[ee,g.priority]])]),t("div",xs,[M(t("select",{"onUpdate:modelValue":e[4]||(e[4]=n=>g.riskLevel=n),onChange:G,class:"form-select form-select-lg"},e[34]||(e[34]=[f('<option value="" data-v-9ce5c566>All Risk</option><option value="Critical" data-v-9ce5c566>Critical Risk</option><option value="High" data-v-9ce5c566>High Risk</option><option value="Medium" data-v-9ce5c566>Medium Risk</option><option value="Low" data-v-9ce5c566>Low Risk</option>',5)]),544),[[ee,g.riskLevel]])]),t("div",ks,[M(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>g.dateFrom=n),type:"date",class:"form-control form-control-lg",onChange:G},null,544),[[Te,g.dateFrom]])]),t("div",{class:"col-lg-2 col-md-4 col-6"},[t("button",{onClick:Se,class:"btn btn-light-secondary w-100 h-100"},e[35]||(e[35]=[t("i",{class:"ki-duotone ki-arrows-circle fs-4"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),w(" Reset ")]))])])])]),T.value?q("",!0):(d(),c("div",Ts,[(d(!0),c(H,null,Y(ge.value,n=>(d(),c("div",{key:n.ApprovalID,class:"col-xl-6 col-lg-6"},[t("div",{class:R(["card card-flush border-0 shadow-lg h-100 approval-card",We(n)]),onClick:I=>ie(n),role:"button","aria-label":`${n.RequestTitle} - ${n.Status}`,tabindex:"0",onKeydown:[Ee(I=>ie(n),["enter"]),Ee(_t(I=>ie(n),["prevent"]),["space"])]},[Be(n)?(d(),c("div",Es,e[36]||(e[36]=[f('<div class="badge badge-light-danger fs-8" data-v-9ce5c566><i class="ki-duotone ki-security-check fs-6 me-1" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span><span class="path5" data-v-9ce5c566></span><span class="path6" data-v-9ce5c566></span></i> FRAUD RISK </div>',1)]))):q("",!0),t("div",qs,[t("div",Ps,[t("div",Ns,[t("div",{class:R(["symbol symbol-50px symbol-circle",Ze(n)])},[t("i",{class:R(["ki-duotone fs-2x",et(n)])},e[37]||(e[37]=[f('<span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span><span class="path5" data-v-9ce5c566></span><span class="path6" data-v-9ce5c566></span>',6)]),2)],2),t("div",null,[t("h4",Ls,r(n.RequestTitle),1),t("p",Os,r(n.RequestType.replace("_"," ")),1)])]),t("div",Ms,[t("div",{class:R(["badge fs-6",tt(n.Status)])},r(n.Status),3),t("div",{class:R(["badge",st(n.Priority)])},r(n.Priority),3)])]),t("div",Us,[t("div",Fs,[t("div",Vs,[t("div",$s,[t("div",Gs,r(E(n))+"%",1),e[38]||(e[38]=t("div",{class:"text-gray-600 fs-8"},"AI Risk Score",-1))])]),t("div",Bs,[t("div",Hs,[t("div",Ys,r(Ge(n))+"%",1),e[39]||(e[39]=t("div",{class:"text-gray-600 fs-8"},"AI Confidence",-1))])])])]),t("div",js,[t("div",Js,[t("div",zs,[t("div",Xs,r(X(n.RequestAmount)),1),e[40]||(e[40]=t("div",{class:"text-gray-600 fs-7"},"Amount",-1))])]),t("div",Qs,[t("div",Ks,[t("div",Ws,r(Ie(n.RequestDate)),1),e[41]||(e[41]=t("div",{class:"text-gray-600 fs-7"},"Days Old",-1))])])]),t("div",Zs,[t("div",ea,[e[42]||(e[42]=t("i",{class:"ki-duotone ki-user fs-4 text-secondary"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),t("div",null,[t("div",ta,r(Q(n.RequesterUserID)),1),t("div",sa,r(it(n.RequesterUserID)),1)])])]),t("div",aa,[t("div",na,[e[43]||(e[43]=t("span",{class:"text-gray-600 fs-7 fw-bold"},"Approval Progress",-1)),t("span",oa," Step "+r(n.CurrentApprovalLevel)+" of "+r(Re(n)),1)]),t("div",ia,[t("div",{class:"progress-bar bg-primary rounded-3",style:wt({width:Ke(n)+"%"})},null,4)])]),t("div",ra,[t("div",la,[t("i",{class:R(["ki-duotone ki-time fs-4",_e(n)])},e[44]||(e[44]=[t("span",{class:"path1"},null,-1),t("span",{class:"path2"},null,-1)]),2),t("span",{class:R(["fw-bold fs-7",_e(n)])},r(we(n)),3)]),t("div",ca,[t("div",{class:R(["badge",nt(n)])},r(De(n)),3)])])])],42,Cs)]))),128))])),T.value?(d(),c("div",da,[e[45]||(e[45]=t("div",{class:"spinner-border text-primary mb-4",style:{width:"4rem",height:"4rem"}},null,-1)),t("p",ua,r(O.value),1)])):q("",!0),!T.value&&ge.value.length===0?(d(),c("div",pa,[t("div",{class:"card card-flush border-0 shadow-lg"},[t("div",{class:"card-body p-10"},[e[47]||(e[47]=f('<i class="ki-duotone ki-check-circle fs-3x text-success mb-5" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span></i><h3 class="text-gray-900 fw-bolder fs-2 mb-3" data-v-9ce5c566>All Clear!</h3><p class="text-gray-600 fs-4 mb-5" data-v-9ce5c566>No pending approvals match your current filters.</p>',3)),t("button",{onClick:Se,class:"btn btn-light-primary"},e[46]||(e[46]=[t("i",{class:"ki-duotone ki-arrows-circle fs-4 me-2"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),w(" Reset Filters ")]))])])])):q("",!0)])):(d(),c("div",St,[t("div",xt,[t("div",kt,[e[10]||(e[10]=f('<i class="ki-duotone ki-security-user fs-3x text-danger mb-5" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span></i><h3 class="text-gray-900 fw-bolder fs-2 mb-3" data-v-9ce5c566>Approval Access Restricted</h3><p class="text-gray-600 fs-4 mb-5" data-v-9ce5c566> Only authorized approvers can access the approval management system. </p>',3)),t("div",Tt,[e[8]||(e[8]=t("p",{class:"text-warning fw-bold mb-2"},"Your Current Authorization:",-1)),t("p",Ct,r(k.value)+" - "+r(U.value),1),t("p",Et,"Station: "+r((a=b.value)==null?void 0:a.StationName),1)]),t("button",{onClick:yt,class:"btn btn-light-primary"},e[9]||(e[9]=[t("i",{class:"ki-duotone ki-message-question fs-4 me-2"},[t("span",{class:"path1"}),t("span",{class:"path2"}),t("span",{class:"path3"})],-1),w(" Request Approval Access ")]))])])])),v.value?(d(),c("div",va,[t("div",ga,[t("div",ma,[t("div",ha,[t("div",fa,[e[48]||(e[48]=f('<div class="symbol symbol-45px symbol-circle bg-light-success" data-v-9ce5c566><i class="ki-duotone ki-security-check fs-2x text-success" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span><span class="path5" data-v-9ce5c566></span><span class="path6" data-v-9ce5c566></span></i></div>',1)),t("div",null,[t("h3",ya,r(v.value.RequestTitle),1),t("p",Aa,r(v.value.RequestType.replace("_"," "))+" • ID: "+r(v.value.ApprovalID),1)])]),t("button",{type:"button",class:"btn-close btn-close-white",onClick:W})]),t("div",ba,[C.value?(d(),c("div",Ra,[e[53]||(e[53]=f('<div class="card-header bg-light-danger" data-v-9ce5c566><h5 class="text-danger fw-bold mb-0" data-v-9ce5c566><i class="ki-duotone ki-security-check fs-4 me-2" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span><span class="path5" data-v-9ce5c566></span><span class="path6" data-v-9ce5c566></span></i> AI Fraud Detection Analysis </h5></div>',1)),t("div",Da,[t("div",wa,[t("div",_a,[t("div",Ia,[t("div",Sa,r(C.value.riskScore)+"% ",1),e[49]||(e[49]=t("div",{class:"text-gray-600 fs-7"},"Risk Score",-1))])]),t("div",xa,[t("div",ka,[t("div",Ta,r(C.value.anomalies),1),e[50]||(e[50]=t("div",{class:"text-gray-600 fs-7"},"Anomalies",-1))])]),t("div",Ca,[t("div",Ea,[t("div",{class:R(["badge",at(C.value.severity)])},r(C.value.severity),3)])])]),t("div",qa,[e[51]||(e[51]=t("h6",{class:"text-gray-800 fw-bold mb-3"},"Risk Factors:",-1)),t("div",Pa,[t("ul",Na,[(d(!0),c(H,null,Y(C.value.riskFactors,n=>(d(),c("li",{key:n,class:"mb-1"},r(n),1))),128))])])]),C.value.recommendations.length>0?(d(),c("div",La,[e[52]||(e[52]=t("h6",{class:"text-gray-800 fw-bold mb-3"},"AI Recommendations:",-1)),t("div",Oa,[t("ul",Ma,[(d(!0),c(H,null,Y(C.value.recommendations,n=>(d(),c("li",{key:n,class:"mb-1 text-info"},r(n),1))),128))])])])):q("",!0)])])):q("",!0),t("div",Ua,[e[66]||(e[66]=f('<div class="card-header bg-light-info" data-v-9ce5c566><h5 class="text-info fw-bold mb-0" data-v-9ce5c566><i class="ki-duotone ki-document-copy fs-4 me-2" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span></i> Request Details &amp; Business Context </h5></div>',1)),t("div",Fa,[t("div",Va,[t("div",$a,[e[59]||(e[59]=t("h6",{class:"text-gray-800 fw-bold mb-3"},"Basic Information:",-1)),t("div",Ga,[t("div",Ba,[e[54]||(e[54]=t("strong",null,"Type:",-1)),w(" "+r(v.value.RequestType.replace("_"," ")),1)]),t("div",Ha,[e[55]||(e[55]=t("strong",null,"Amount:",-1)),w(" "+r(X(v.value.RequestAmount)),1)]),t("div",Ya,[e[56]||(e[56]=t("strong",null,"Priority:",-1)),w(" "+r(v.value.Priority),1)]),t("div",ja,[e[57]||(e[57]=t("strong",null,"Status:",-1)),w(" "+r(v.value.Status),1)]),t("div",Ja,[e[58]||(e[58]=t("strong",null,"Submitted:",-1)),w(" "+r(oe(v.value.RequestDate)),1)])])]),t("div",za,[e[64]||(e[64]=t("h6",{class:"text-gray-800 fw-bold mb-3"},"Business Impact:",-1)),t("div",Xa,[t("div",Qa,[e[60]||(e[60]=t("strong",null,"Station:",-1)),w(" "+r(K(v.value.RequesterStationID)),1)]),t("div",Ka,[e[61]||(e[61]=t("strong",null,"Department:",-1)),w(" "+r(rt(v.value.RequesterDepartmentID)),1)]),t("div",Wa,[e[62]||(e[62]=t("strong",null,"SLA Deadline:",-1)),w(" "+r(oe(v.value.DueDate)),1)]),t("div",Za,[e[63]||(e[63]=t("strong",null,"Escalation Level:",-1)),w(" Level "+r(v.value.CurrentApprovalLevel),1)])])])]),t("div",en,[e[65]||(e[65]=t("h6",{class:"text-gray-800 fw-bold mb-3"},"Request Description:",-1)),t("div",tn,[t("p",sn,r(v.value.RequestDetails||"No additional details provided."),1)])])])]),t("div",an,[e[68]||(e[68]=f('<div class="card-header bg-light-success" data-v-9ce5c566><h5 class="text-success fw-bold mb-0" data-v-9ce5c566><i class="ki-duotone ki-route fs-4 me-2" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span></i> Approval Workflow &amp; History </h5></div>',1)),t("div",nn,[t("div",on,[(d(!0),c(H,null,Y(ue.value,(n,I)=>(d(),c("div",{key:n.StepID,class:"timeline-item"},[t("div",{class:R(["timeline-line",ct(n)])},null,2),t("div",{class:R(["timeline-icon",dt(n)])},e[67]||(e[67]=[t("i",{class:"ki-duotone ki-check fs-2x"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)]),2),t("div",rn,[t("div",ln,[t("h6",cn," Step "+r(n.StepNumber)+": "+r(n.ApproverType),1),t("span",{class:R(["badge",ut(n.Status)])},r(n.Status),3)]),t("p",dn,"Approver: "+r(lt(n)),1),t("p",un,r(n.StartedAt?oe(n.StartedAt):"Not started"),1)])]))),128))])])]),ae(v.value)?(d(),c("div",pn,[e[73]||(e[73]=f('<div class="card-header bg-light-warning" data-v-9ce5c566><h5 class="text-warning fw-bold mb-0" data-v-9ce5c566><i class="ki-duotone ki-security-user fs-4 me-2" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span></i> Your Approval Action Required </h5></div>',1)),t("div",vn,[t("div",gn,[t("div",mn,[e[70]||(e[70]=t("label",{class:"form-label text-gray-800 fw-bold"},"Comments & Justification",-1)),M(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=n=>D.value=n),class:"form-control border-warning",rows:"4",placeholder:"Enter your comments, justification, or concerns about this approval request...",maxlength:"1000"},null,512),[[Te,D.value]]),t("div",hn,[e[69]||(e[69]=t("span",null,"Required for denials and high-risk approvals",-1)),t("span",null,r(((l=D.value)==null?void 0:l.length)||0)+"/1000",1)])])]),ne(v.value)?(d(),c("div",fn,[t("div",yn,[e[72]||(e[72]=f('<h6 class="text-danger fw-bold mb-3" data-v-9ce5c566><i class="ki-duotone ki-security-check fs-4 me-2" data-v-9ce5c566><span class="path1" data-v-9ce5c566></span><span class="path2" data-v-9ce5c566></span><span class="path3" data-v-9ce5c566></span><span class="path4" data-v-9ce5c566></span><span class="path5" data-v-9ce5c566></span><span class="path6" data-v-9ce5c566></span></i> Security Verification Required </h6>',1)),t("div",An,[M(t("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>V.value=n),class:"form-check-input",type:"checkbox",id:"securityCheck"},null,512),[[Dt,V.value]]),e[71]||(e[71]=t("label",{class:"form-check-label text-gray-700",for:"securityCheck"}," I verify this approval complies with company policies and fraud prevention measures ",-1))])])])):q("",!0)])])):q("",!0)]),t("div",bn,[t("div",Rn,[t("button",{type:"button",class:"btn btn-light",onClick:W}," Cancel "),ae(v.value)?(d(),c("div",Dn,[t("button",{onClick:Je,class:"btn btn-danger",disabled:L.value||!D.value&&Ye(v.value)},[L.value?(d(),c("span",_n)):(d(),c("i",In,e[74]||(e[74]=[t("span",{class:"path1"},null,-1),t("span",{class:"path2"},null,-1)]))),e[75]||(e[75]=w(" Deny Request "))],8,wn),t("button",{onClick:je,class:"btn btn-success flex-grow-1",disabled:L.value||ne(v.value)&&!V.value},[L.value?(d(),c("span",xn)):(d(),c("i",kn,e[76]||(e[76]=[t("span",{class:"path1"},null,-1),t("span",{class:"path2"},null,-1)]))),e[77]||(e[77]=w(" Approve Meter Reading "))],8,Sn)])):(d(),c("div",Tn,e[78]||(e[78]=[t("div",{class:"alert alert-warning mb-0"},[t("strong",null,"No Approval Authority:"),w(" You cannot approve this request. ")],-1)])))])])])])])):q("",!0),t("div",Cn,[t("div",En,[t("div",qn,[t("div",{class:"modal-header bg-info"},[e[79]||(e[79]=t("h3",{class:"modal-title text-white fw-bold"},"Approval Statistics & Analytics",-1)),t("button",{type:"button",class:"btn-close btn-close-white",onClick:ht})]),t("div",Pn,[t("div",Nn,[e[84]||(e[84]=t("h6",{class:"text-gray-800 fw-bold mb-4"},"Your Approval Performance",-1)),t("div",Ln,[t("div",On,[t("div",Mn,[t("div",Un,r(P.approved),1),e[80]||(e[80]=t("div",{class:"text-gray-600 fs-8"},"Approved",-1))])]),t("div",Fn,[t("div",Vn,[t("div",$n,r(P.denied),1),e[81]||(e[81]=t("div",{class:"text-gray-600 fs-8"},"Denied",-1))])]),t("div",Gn,[t("div",Bn,[t("div",Hn,r(P.escalated),1),e[82]||(e[82]=t("div",{class:"text-gray-600 fs-8"},"Escalated",-1))])]),t("div",Yn,[t("div",jn,[t("div",Jn,r(P.avgTime)+"h",1),e[83]||(e[83]=t("div",{class:"text-gray-600 fs-8"},"Avg Time",-1))])])])]),t("div",null,[e[87]||(e[87]=t("h6",{class:"text-gray-800 fw-bold mb-4"},"Recent Activity (Last 7 Days)",-1)),t("div",zn,[se.value.length>0?(d(),c("div",Xn,[(d(!0),c(H,null,Y(se.value,n=>(d(),c("div",{key:n.id,class:"d-flex align-items-center gap-3 mb-3"},[t("div",{class:R(["symbol symbol-35px symbol-circle",pt(n.action)])},[t("i",{class:R(["ki-duotone fs-5",vt(n.action)])},e[85]||(e[85]=[t("span",{class:"path1"},null,-1),t("span",{class:"path2"},null,-1)]),2)],2),t("div",Qn,[t("div",Kn,r(n.title),1),t("div",Wn,r(n.description),1)]),t("div",Zn,r(n.timeAgo),1)]))),128))])):(d(),c("div",eo,e[86]||(e[86]=[t("p",{class:"mb-0"},"No recent approval activity",-1)])))])])])])])])])}}},io=At(so,[["__scopeId","data-v-9ce5c566"]]);export{io as default};
