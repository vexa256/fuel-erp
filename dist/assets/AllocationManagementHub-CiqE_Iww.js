import { _ as _t, r, a as K, c as S, o as xt, d as l, e as t, g as u, f as _, i as m, y as T, F as $, k as N, t as i, h as O, S as Q, p as n, w as kt, v as wt } from "./index-Fk_fMhvq.js"; const St = { class: "d-flex flex-column min-vh-100 bg-light" }, It = { class: "bg-white border-bottom shadow-sm" }, Dt = { class: "container-fluid px-4 py-3" }, Pt = { class: "d-flex justify-content-between align-items-center" }, At = { class: "d-flex align-items-center gap-2" }, Ct = { class: "flex-grow-1 container-fluid p-4" }, $t = { class: "row g-4" }, Nt = { class: "col-lg-8" }, Ot = { class: "card card-flush mb-4" }, jt = { class: "card-body py-3" }, Et = { class: "d-flex justify-content-between align-items-center position-relative" }, Mt = { class: "position-absolute top-50 start-0 w-100", style: { height: "2px", "z-index": "0" } }, Tt = { key: 0, class: "ki-duotone ki-check fs-3" }, Bt = { key: 1, class: "fw-bold" }, Lt = { class: "card card-flush shadow-sm" }, Ft = { class: "card-body" }, Ut = { key: 0, class: "animate__animated animate__fadeIn" }, Rt = { key: 0, class: "text-center py-5" }, Vt = { key: 1, class: "row g-3" }, zt = ["onClick"], Gt = { class: "card-body" }, Ht = { class: "d-flex justify-content-between align-items-start" }, Wt = { class: "fw-bold mb-1" }, Jt = { class: "text-muted fs-7" }, qt = { class: "mt-2" }, Xt = { class: "badge badge-light-success" }, Kt = { key: 0 }, Qt = { key: 2, class: "alert alert-light-danger mt-3" }, Yt = { key: 1, class: "animate__animated animate__fadeIn" }, Zt = { class: "d-flex align-items-center gap-3 mb-4" }, ts = { class: "text-muted fs-6" }, ss = { key: 0, class: "text-center py-5" }, es = { key: 1, class: "alert alert-light-warning" }, as = { key: 2, class: "row g-3" }, ls = ["onClick"], ns = { class: "card-body" }, is = { class: "d-flex justify-content-between align-items-center" }, os = { class: "d-flex align-items-center gap-3" }, ds = { class: "fw-bold mb-1" }, cs = { class: "d-flex gap-3 text-muted fs-7" }, rs = { key: 0 }, us = { key: 0 }, vs = { key: 1, class: "text-end" }, ps = { class: "fw-bold" }, ms = { key: 2, class: "animate__animated animate__fadeIn" }, hs = { key: 0, class: "text-center py-5" }, fs = { key: 1, class: "alert alert-light-warning" }, gs = { key: 2 }, bs = { class: "table-responsive" }, ys = { class: "table table-row-bordered table-row-gray-200 align-middle gs-0 gy-4" }, _s = ["onClick"], xs = { class: "ps-4" }, ks = { class: "fw-bold text-gray-800" }, ws = { class: "badge badge-light-info" }, Ss = { class: "text-end fw-semibold" }, Is = { class: "text-end" }, Ds = { class: "text-success fw-bold" }, Ps = { class: "text-end pe-4" }, As = { class: "form-check form-check-custom form-check-solid" }, Cs = ["checked"], $s = { key: 3, class: "animate__animated animate__fadeIn" }, Ns = { class: "d-flex align-items-center gap-3 mb-4" }, Os = { class: "text-end" }, js = { class: "fs-3 fw-bold text-success" }, Es = { key: 0, class: "text-center py-5" }, Ms = { key: 1, class: "alert alert-light-info" }, Ts = { key: 2 }, Bs = { class: "table-responsive mb-4" }, Ls = { class: "table table-row-bordered table-row-gray-200 align-middle gs-0 gy-3" }, Fs = { class: "ps-4" }, Us = { class: "d-flex flex-column" }, Rs = { class: "fw-bold text-gray-800" }, Vs = { class: "fs-7 text-muted" }, zs = { key: 0, class: "mt-1" }, Gs = { class: "badge badge-light-danger fs-8" }, Hs = { class: "fs-8 text-muted" }, Ws = { class: "text-end" }, Js = { class: "text-end" }, qs = { class: "fw-bold text-danger" }, Xs = { class: "text-end pe-4" }, Ks = { class: "input-group" }, Qs = ["onUpdate:modelValue", "max", "onInput"], Ys = { class: "fw-bold bg-light" }, Zs = { class: "text-end pe-4" }, te = { key: 0, class: "alert alert-light-danger mb-4" }, se = { class: "mb-0" }, ee = { key: 4, class: "animate__animated animate__fadeIn" }, ae = { key: 0, class: "card-footer bg-light" }, le = { class: "d-flex justify-content-between align-items-center" }, ne = ["disabled"], ie = { class: "d-flex gap-2" }, oe = ["disabled"], de = { key: 0, class: "spinner-border spinner-border-sm me-2" }, ce = { key: 1, class: "ki-duotone ki-check fs-2 me-2" }, re = ["disabled"], ue = { class: "col-lg-4" }, ve = { class: "card card-flush mb-4" }, pe = { class: "card-body" }, me = { class: "d-flex flex-column gap-4" }, he = { key: 0 }, fe = { class: "fw-bold" }, ge = { key: 1 }, be = { class: "fw-bold" }, ye = { key: 2 }, _e = { class: "fw-bold" }, xe = { class: "fs-7 text-muted" }, ke = { key: 3 }, we = { class: "progress", style: { height: "8px" } }, Se = { class: "d-flex justify-content-between mt-2 fs-7" }, Ie = { class: "text-muted" }, De = { key: 0, class: "card card-flush" }, Pe = { class: "card-body" }, Ae = { class: "mb-4" }, Ce = { class: "d-flex align-items-center justify-content-between mb-2" }, $e = { class: "badge badge-light-success" }, Ne = { class: "progress", style: { height: "8px" } }, Oe = { class: "mb-4" }, je = { class: "d-flex align-items-center justify-content-between mb-2" }, Ee = { class: "badge badge-light-warning" }, Me = { class: "progress", style: { height: "8px" } }, Te = { class: "mb-4" }, Be = { class: "d-flex align-items-center justify-content-between mb-2" }, Le = { class: "badge badge-light-danger" }, Fe = { class: "progress", style: { height: "8px" } }, Ue = { key: 0, class: "mt-4" }, Re = { class: "d-flex flex-column gap-2" }, Ve = { class: "d-flex align-items-center" }, ze = { class: "fs-7" }, Ge = { key: 0, class: "modal fade show d-block", style: { background: "rgba(0, 0, 0, 0.5)" } }, He = { class: "modal-dialog modal-dialog-centered modal-lg" }, We = { class: "modal-content" }, Je = { class: "modal-header" }, qe = { class: "modal-footer" }, I = "https://backend.cloudfuelstationmis.com/api/records/v1", Xe = { __name: "AllocationManagementHub", setup(Ke) { const et = localStorage.getItem("jwt") || "", U = [{ title: "Station", icon: "map-pin" }, { title: "Supplier", icon: "user-square" }, { title: "Payment", icon: "credit-card" }, { title: "Allocate", icon: "document" }, { title: "Complete", icon: "check-circle" }], d = r(0), R = r([]), D = r([]), E = r([]), j = r([]), v = r(""), f = r(""), x = r(""), P = K({}), V = r(!1), z = r(!1), G = r(!1), H = r(!1), B = r(!1), W = r(!0), L = r(!1), M = r(""), k = r([]), b = K({}), A = r([]), h = K({ series: [0, 0, 0], total: 0 }), J = S(() => R.value.find(a => String(a.StationID) === v.value)), Y = S(() => D.value.find(a => a.SupplierID === f.value)), C = S(() => E.value.find(a => a.PaymentID === x.value)), y = S(() => C.value ? Number(C.value.PaymentAmount || 0) : 0), g = S(() => Object.values(P).reduce((a, s) => a + (Number(s) || 0), 0)), at = S(() => y.value ? Math.min(100, g.value / y.value * 100) : 0), Z = S(() => { switch (d.value) { case 0: return !!v.value; case 1: return !!f.value; case 2: return !!x.value; case 3: return g.value > 0 && g.value <= y.value; default: return !1 } }), tt = S(() => g.value > 0 && g.value <= y.value && k.value.length === 0), p = a => new Intl.NumberFormat("en-UG", { style: "currency", currency: "UGX", minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(a), st = a => a ? new Date(a).toLocaleDateString("en-UG") : "", lt = a => { const s = Math.floor((new Date - new Date(a)) / 864e5); return s <= 0 ? "Not overdue" : `${s} days overdue` }, nt = a => { const s = Math.floor((new Date - new Date(a)) / 864e5); return s > 60 ? "text-danger" : s > 30 ? "text-warning" : s > 0 ? "text-info" : "text-success" }, it = a => a.PaymentAmount, q = a => h.total ? Math.round(h.series[a] / h.total * 100) : 0, w = async (a, s = {}) => { try { const c = await fetch(a, { ...s, headers: { Authorization: `Bearer ${et}`, "Content-Type": "application/json", ...s.headers } }); if (!c.ok) throw new Error(`API Error: ${c.status}`); return await c.json() } catch (c) { throw console.error("API Call Failed:", c), c } }, ot = async () => { V.value = !0, M.value = ""; try { const a = await w(`${I}/Stations`); R.value = a.records || [] } catch { M.value = "Failed to load stations. Please check your connection.", Q.fire({ icon: "error", title: "Failed to load stations", text: M.value }) } finally { V.value = !1 } }, dt = async () => { if (v.value) { z.value = !0; try { const s = ((await w(`${I}/SupplierStations?StationID=${v.value}`)).records || []).map(e => e.SupplierID); if (s.length === 0) { D.value = []; return } const c = await w(`${I}/Suppliers?SupplierID=in.(${s.join(",")})`); D.value = c.records || []; for (const e of D.value) try { const o = await w(`${I}/SupplierCreditAccounts?SupplierID=${e.SupplierID}&StationID=${v.value}`); o.records && o.records[0] && (e.creditLimit = o.records[0].CreditLimit, e.currentBalance = o.records[0].CurrentBalance) } catch { console.warn("Could not fetch credit data for supplier", e.SupplierID) } } catch (a) { console.error("Error fetching suppliers:", a), D.value = [] } finally { z.value = !1 } } }, ct = async () => { if (!(!f.value || !v.value)) { G.value = !0; try { const a = await w(`${I}/SupplierPayments?SupplierID=${f.value}&StationID=${v.value}`); E.value = (a.records || []).filter(s => s.Status === "Completed") } catch (a) { console.error("Error fetching payments:", a), E.value = [] } finally { G.value = !1 } } }, rt = async () => { if (!(!f.value || !v.value)) { H.value = !0; try { const a = await w(`${I}/SupplierInvoices?SupplierID=${f.value}&StationID=${v.value}&Status=Outstanding`); j.value = (a.records || []).filter(s => Number(s.OutstandingAmount) > 0), ut(), vt() } catch (a) { console.error("Error fetching invoices:", a), j.value = [] } finally { H.value = !1 } } }, ut = () => { Object.keys(b).forEach(s => delete b[s]), A.value = []; const a = {}; for (const s of j.value) { const c = `${s.InvoiceNumber}-${s.SupplierID}`; a[c] && (b[s.InvoiceID] = "Possible duplicate invoice", A.value.push(`Duplicate invoice detected: ${s.InvoiceNumber}`)), a[c] = !0, Math.floor((new Date - new Date(s.DueDate)) / (1e3 * 60 * 60 * 24)) > 180 && (b[s.InvoiceID] = "Severely overdue (>180 days)", A.value.push(`Invoice ${s.InvoiceNumber} is severely overdue`)), s.OutstandingAmount > 1e8 && (b[s.InvoiceID] = "Unusually high amount", A.value.push(`High value invoice: ${s.InvoiceNumber}`)) } }, vt = () => { const a = [], s = [], c = []; for (const e of j.value) { const o = Math.floor((new Date - new Date(e.DueDate)) / 864e5), X = Number(e.OutstandingAmount); o <= 30 ? a.push(X) : o <= 60 ? s.push(X) : c.push(X) } h.series = [a.reduce((e, o) => e + o, 0), s.reduce((e, o) => e + o, 0), c.reduce((e, o) => e + o, 0)], h.total = h.series.reduce((e, o) => e + o, 0) }, pt = a => { k.value = []; const s = Number(P[a.InvoiceID] || 0); s < 0 && k.value.push("Allocation amounts cannot be negative"), s > a.OutstandingAmount && k.value.push(`Cannot allocate more than outstanding amount for invoice ${a.InvoiceNumber}`), g.value > y.value && k.value.push("Total allocation exceeds available payment amount") }, mt = a => { v.value = String(a.StationID), F() }, ht = a => { f.value = a.SupplierID, F() }, ft = a => { x.value = a.PaymentID, F() }, F = () => { if (Z.value && d.value < U.length - 1) switch (d.value++, d.value) { case 1: dt(); break; case 2: ct(); break; case 3: rt(); break } }, gt = () => { d.value > 0 && d.value-- }, bt = async () => { if (tt.value) { B.value = !0; try { const a = []; for (const [s, c] of Object.entries(P)) c > 0 && a.push(w(`${I}/SupplierPaymentAllocations`, { method: "POST", body: JSON.stringify({ PaymentID: x.value, InvoiceID: Number(s), AllocatedAmount: String(c), AllocationDate: new Date().toISOString().split("T")[0] }) })); await Promise.all(a), await w(`${I}/SupplierCreditTransactions`, { method: "POST", body: JSON.stringify({ SupplierID: f.value, StationID: Number(v.value), TransactionType: "Payment", ReferenceID: x.value, Amount: String(g.value), PreviousBalance: "0", NewBalance: "0", Description: `Payment allocation for ${C.value.PaymentReference}`, CreatedBy: 1 }) }), d.value = 4, Q.fire({ icon: "success", title: "Success!", text: "Payment has been allocated successfully", toast: !0, position: "top-end", timer: 3e3, showConfirmButton: !1 }) } catch (a) { console.error("Error completing allocation:", a), Q.fire({ icon: "error", title: "Allocation Failed", text: "Failed to complete allocation. Please try again." }) } finally { B.value = !1 } } }, yt = () => { d.value = 0, v.value = "", f.value = "", x.value = "", Object.keys(P).forEach(a => delete P[a]), k.value = [], Object.keys(b).forEach(a => delete b[a]), A.value = [], h.series = [0, 0, 0], h.total = 0 }; return xt(() => { ot() }), (a, s) => { var c; return n(), l("div", St, [t("div", It, [t("div", Dt, [t("div", Pt, [s[6] || (s[6] = _('<div class="d-flex align-items-center gap-3" data-v-610a4e23><div class="d-flex align-items-center gap-2" data-v-610a4e23><div class="bg-light-primary rounded-3 p-2" data-v-610a4e23><i class="ki-duotone ki-wallet fs-2x text-primary" data-v-610a4e23><span class="path1" data-v-610a4e23></span><span class="path2" data-v-610a4e23></span><span class="path3" data-v-610a4e23></span><span class="path4" data-v-610a4e23></span></i></div><div data-v-610a4e23><h4 class="mb-0 fw-bold text-gray-900" data-v-610a4e23>Payment Allocation</h4><div class="text-muted fs-7" data-v-610a4e23>Supplier Credit Management</div></div></div></div>', 1)), t("div", At, [t("button", { class: "btn btn-light btn-sm", onClick: s[0] || (s[0] = e => W.value = !W.value) }, s[4] || (s[4] = [t("i", { class: "ki-duotone ki-chart-line fs-2" }, [t("span", { class: "path1" }), t("span", { class: "path2" })], -1), m(" Analytics ")])), t("button", { class: "btn btn-light btn-sm", onClick: s[1] || (s[1] = e => L.value = !0) }, s[5] || (s[5] = [t("i", { class: "ki-duotone ki-information fs-2" }, [t("span", { class: "path1" }), t("span", { class: "path2" }), t("span", { class: "path3" })], -1), m(" Help ")]))])])])]), t("div", Ct, [t("div", $t, [t("div", Nt, [t("div", Ot, [t("div", jt, [t("div", Et, [t("div", Mt, [s[7] || (s[7] = t("div", { class: "bg-gray-300 h-100" }, null, -1)), t("div", { class: "bg-primary h-100 position-absolute top-0 start-0 transition-all", style: T(`width: ${d.value / (U.length - 1) * 100}%`) }, null, 4)]), (n(), l($, null, N(U, (e, o) => t("div", { key: o, class: "d-flex flex-column align-items-center position-relative bg-white px-2", style: { "z-index": "1" } }, [t("div", { class: O(["rounded-circle d-flex align-items-center justify-content-center mb-1", d.value >= o ? "bg-primary text-white" : "bg-gray-200 text-gray-600", "transition-all"]), style: { width: "40px", height: "40px" } }, [d.value > o ? (n(), l("i", Tt, s[8] || (s[8] = [t("span", { class: "path1" }, null, -1), t("span", { class: "path2" }, null, -1)]))) : (n(), l("span", Bt, i(o + 1), 1))], 2), t("div", { class: O(["fs-7", d.value >= o ? "text-gray-900 fw-semibold" : "text-gray-500"]) }, i(e.title), 3)])), 64))])])]), t("div", Lt, [t("div", Ft, [d.value === 0 ? (n(), l("div", Ut, [s[11] || (s[11] = _('<div class="d-flex align-items-center gap-3 mb-4" data-v-610a4e23><div class="bg-light-primary rounded-2 p-3" data-v-610a4e23><i class="ki-duotone ki-map-pin fs-2x text-primary" data-v-610a4e23><span class="path1" data-v-610a4e23></span><span class="path2" data-v-610a4e23></span></i></div><div data-v-610a4e23><h5 class="mb-1 fw-bold" data-v-610a4e23>Select Station</h5><div class="text-muted fs-6" data-v-610a4e23> Choose the station for this payment allocation </div></div></div>', 1)), V.value ? (n(), l("div", Rt, s[9] || (s[9] = [t("div", { class: "spinner-border text-primary", role: "status" }, [t("span", { class: "visually-hidden" }, "Loading...")], -1)]))) : (n(), l("div", Vt, [(n(!0), l($, null, N(R.value, e => (n(), l("div", { key: e.StationID, class: "col-md-6" }, [t("div", { class: O(["card border hover-elevate-up cursor-pointer h-100", v.value === String(e.StationID) ? "border-primary bg-light-primary" : ""]), onClick: o => mt(e) }, [t("div", Gt, [t("div", Ht, [t("div", null, [t("h6", Wt, i(e.StationName), 1), t("div", Jt, i(e.Location), 1), t("div", qt, [t("span", Xt, i(e.Status), 1)])]), v.value === String(e.StationID) ? (n(), l("div", Kt, s[10] || (s[10] = [t("i", { class: "ki-duotone ki-check-circle fs-2x text-primary" }, [t("span", { class: "path1" }), t("span", { class: "path2" })], -1)]))) : u("", !0)])])], 10, zt)]))), 128))])), M.value ? (n(), l("div", Qt, i(M.value), 1)) : u("", !0)])) : u("", !0), d.value === 1 ? (n(), l("div", Yt, [t("div", Zt, [s[13] || (s[13] = _('<div class="bg-light-success rounded-2 p-3" data-v-610a4e23><i class="ki-duotone ki-user-square fs-2x text-success" data-v-610a4e23><span class="path1" data-v-610a4e23></span><span class="path2" data-v-610a4e23></span><span class="path3" data-v-610a4e23></span><span class="path4" data-v-610a4e23></span></i></div>', 1)), t("div", null, [s[12] || (s[12] = t("h5", { class: "mb-1 fw-bold" }, "Select Supplier", -1)), t("div", ts, " Choose supplier assigned to " + i((c = J.value) == null ? void 0 : c.StationName), 1)])]), z.value ? (n(), l("div", ss, s[14] || (s[14] = [t("div", { class: "spinner-border text-primary", role: "status" }, [t("span", { class: "visually-hidden" }, "Loading...")], -1)]))) : D.value.length ? (n(), l("div", as, [(n(!0), l($, null, N(D.value, e => (n(), l("div", { key: e.SupplierID, class: "col-12" }, [t("div", { class: O(["card border hover-elevate-up cursor-pointer", f.value === e.SupplierID ? "border-primary bg-light-primary" : ""]), onClick: o => ht(e) }, [t("div", ns, [t("div", is, [t("div", os, [s[18] || (s[18] = _('<div class="symbol symbol-50px" data-v-610a4e23><div class="symbol-label bg-light-warning" data-v-610a4e23><i class="ki-duotone ki-truck fs-2x text-warning" data-v-610a4e23><span class="path1" data-v-610a4e23></span><span class="path2" data-v-610a4e23></span><span class="path3" data-v-610a4e23></span><span class="path4" data-v-610a4e23></span><span class="path5" data-v-610a4e23></span></i></div></div>', 1)), t("div", null, [t("h6", ds, i(e.Name), 1), t("div", cs, [t("span", null, [s[16] || (s[16] = t("i", { class: "ki-duotone ki-phone fs-6 me-1" }, [t("span", { class: "path1" }), t("span", { class: "path2" })], -1)), m(" " + i(e.Phone), 1)]), e.Email ? (n(), l("span", rs, [s[17] || (s[17] = t("i", { class: "ki-duotone ki-sms fs-6 me-1" }, [t("span", { class: "path1" }), t("span", { class: "path2" })], -1)), m(" " + i(e.Email), 1)])) : u("", !0)])])]), t("div", null, [f.value === e.SupplierID ? (n(), l("div", us, s[19] || (s[19] = [t("i", { class: "ki-duotone ki-check-circle fs-2x text-primary" }, [t("span", { class: "path1" }), t("span", { class: "path2" })], -1)]))) : (n(), l("div", vs, [s[20] || (s[20] = t("div", { class: "fs-7 text-muted" }, "Credit Limit", -1)), t("div", ps, i(p(e.creditLimit || 0)), 1)]))])])])], 10, ls)]))), 128))])) : (n(), l("div", es, s[15] || (s[15] = [t("i", { class: "ki-duotone ki-information-5 fs-2 me-2" }, [t("span", { class: "path1" }), t("span", { class: "path2" }), t("span", { class: "path3" })], -1), m(" No suppliers assigned to this station ")])))])) : u("", !0), d.value === 2 ? (n(), l("div", ms, [s[24] || (s[24] = _('<div class="d-flex align-items-center gap-3 mb-4" data-v-610a4e23><div class="bg-light-info rounded-2 p-3" data-v-610a4e23><i class="ki-duotone ki-credit-card fs-2x text-info" data-v-610a4e23><span class="path1" data-v-610a4e23></span><span class="path2" data-v-610a4e23></span></i></div><div data-v-610a4e23><h5 class="mb-1 fw-bold" data-v-610a4e23>Select Payment</h5><div class="text-muted fs-6" data-v-610a4e23>Choose an unallocated payment to allocate</div></div></div>', 1)), G.value ? (n(), l("div", hs, s[21] || (s[21] = [t("div", { class: "spinner-border text-primary", role: "status" }, [t("span", { class: "visually-hidden" }, "Loading...")], -1)]))) : E.value.length ? (n(), l("div", gs, [t("div", bs, [t("table", ys, [s[23] || (s[23] = t("thead", null, [t("tr", { class: "fw-bold text-muted bg-light" }, [t("th", { class: "ps-4 min-w-150px" }, "Payment Reference"), t("th", { class: "min-w-100px" }, "Date"), t("th", { class: "min-w-100px" }, "Method"), t("th", { class: "min-w-125px text-end" }, "Amount"), t("th", { class: "min-w-125px text-end" }, "Unallocated"), t("th", { class: "min-w-50px text-end pe-4" }, "Select")])], -1)), t("tbody", null, [(n(!0), l($, null, N(E.value, e => (n(), l("tr", { key: e.PaymentID, class: O([{ "bg-light-primary": x.value === e.PaymentID }, "cursor-pointer"]), onClick: o => ft(e) }, [t("td", xs, [t("div", ks, i(e.PaymentReference), 1)]), t("td", null, i(st(e.PaymentDate)), 1), t("td", null, [t("span", ws, i(e.PaymentMethod), 1)]), t("td", Ss, i(p(e.PaymentAmount)), 1), t("td", Is, [t("span", Ds, i(p(it(e))), 1)]), t("td", Ps, [t("div", As, [t("input", { class: "form-check-input", type: "radio", checked: x.value === e.PaymentID }, null, 8, Cs)])])], 10, _s))), 128))])])])])) : (n(), l("div", fs, s[22] || (s[22] = [t("i", { class: "ki-duotone ki-information-5 fs-2 me-2" }, [t("span", { class: "path1" }), t("span", { class: "path2" }), t("span", { class: "path3" })], -1), m(" No unallocated payments found for this supplier ")])))])) : u("", !0), d.value === 3 ? (n(), l("div", $s, [t("div", Ns, [s[26] || (s[26] = _('<div class="bg-light-warning rounded-2 p-3" data-v-610a4e23><i class="ki-duotone ki-document fs-2x text-warning" data-v-610a4e23><span class="path1" data-v-610a4e23></span><span class="path2" data-v-610a4e23></span></i></div><div class="flex-grow-1" data-v-610a4e23><h5 class="mb-1 fw-bold" data-v-610a4e23>Allocate to Invoices</h5><div class="text-muted fs-6" data-v-610a4e23> Distribute payment across outstanding invoices </div></div>', 2)), t("div", Os, [s[25] || (s[25] = t("div", { class: "fs-7 text-muted" }, "Available to Allocate", -1)), t("div", js, i(p(y.value)), 1)])]), H.value ? (n(), l("div", Es, s[27] || (s[27] = [t("div", { class: "spinner-border text-primary", role: "status" }, [t("span", { class: "visually-hidden" }, "Loading...")], -1)]))) : j.value.length ? (n(), l("div", Ts, [t("div", Bs, [t("table", Ls, [s[32] || (s[32] = t("thead", null, [t("tr", { class: "fw-bold text-muted bg-light" }, [t("th", { class: "ps-4 min-w-200px" }, "Invoice Details"), t("th", { class: "min-w-100px" }, "Due Date"), t("th", { class: "min-w-125px text-end" }, "Total Amount"), t("th", { class: "min-w-125px text-end" }, "Outstanding"), t("th", { class: "min-w-150px text-end pe-4" }, "Allocate")])], -1)), t("tbody", null, [(n(!0), l($, null, N(j.value, e => (n(), l("tr", { key: e.InvoiceID }, [t("td", Fs, [t("div", Us, [t("div", Rs, i(e.InvoiceNumber), 1), t("div", Vs, i(e.Description || "No description"), 1), b[e.InvoiceID] ? (n(), l("div", zs, [t("span", Gs, [s[29] || (s[29] = t("i", { class: "ki-duotone ki-information-5 fs-7 me-1" }, [t("span", { class: "path1" }), t("span", { class: "path2" }), t("span", { class: "path3" })], -1)), m(" " + i(b[e.InvoiceID]), 1)])])) : u("", !0)])]), t("td", null, [t("div", { class: O(["fw-semibold", nt(e.DueDate)]) }, i(st(e.DueDate)), 3), t("div", Hs, i(lt(e.DueDate)), 1)]), t("td", Ws, i(p(e.TotalAmount)), 1), t("td", Js, [t("div", qs, i(p(e.OutstandingAmount)), 1)]), t("td", Xs, [t("div", Ks, [s[30] || (s[30] = t("span", { class: "input-group-text" }, "UGX", -1)), kt(t("input", { type: "number", class: "form-control text-end", "onUpdate:modelValue": o => P[e.InvoiceID] = o, max: Math.min(e.OutstandingAmount, y.value), min: 0, step: "0.01", onInput: o => pt(e) }, null, 40, Qs), [[wt, P[e.InvoiceID], void 0, { number: !0 }]])])])]))), 128))]), t("tfoot", null, [t("tr", Ys, [s[31] || (s[31] = t("td", { colspan: "4", class: "text-end ps-4" }, "Total Allocated:", -1)), t("td", Zs, [t("div", { class: O(["fs-4", g.value > y.value ? "text-danger" : "text-success"]) }, i(p(g.value)), 3)])])])])]), k.value.length ? (n(), l("div", te, [s[33] || (s[33] = _('<div class="d-flex align-items-center mb-2" data-v-610a4e23><i class="ki-duotone ki-information-5 fs-2 me-2" data-v-610a4e23><span class="path1" data-v-610a4e23></span><span class="path2" data-v-610a4e23></span><span class="path3" data-v-610a4e23></span></i><div class="fw-bold" data-v-610a4e23>Validation Errors</div></div>', 1)), t("ul", se, [(n(!0), l($, null, N(k.value, (e, o) => (n(), l("li", { key: o }, i(e), 1))), 128))])])) : u("", !0)])) : (n(), l("div", Ms, s[28] || (s[28] = [t("i", { class: "ki-duotone ki-information-5 fs-2 me-2" }, [t("span", { class: "path1" }), t("span", { class: "path2" }), t("span", { class: "path3" })], -1), m(" No outstanding invoices found for this supplier ")])))])) : u("", !0), d.value === 4 ? (n(), l("div", ee, [t("div", { class: "text-center py-8" }, [s[36] || (s[36] = _('<div class="mb-4" data-v-610a4e23><div class="bg-light-success rounded-circle d-inline-flex align-items-center justify-content-center" style="width:100px;height:100px;" data-v-610a4e23><i class="ki-duotone ki-check fs-1 text-success" data-v-610a4e23><span class="path1" data-v-610a4e23></span><span class="path2" data-v-610a4e23></span></i></div></div><h3 class="fw-bold mb-2" data-v-610a4e23>Allocation Completed Successfully!</h3><div class="text-muted fs-5 mb-5" data-v-610a4e23> Payment has been allocated and all balances have been updated. </div>', 3)), t("div", { class: "d-flex gap-2 justify-content-center" }, [t("button", { class: "btn btn-primary", onClick: yt }, s[34] || (s[34] = [t("i", { class: "ki-duotone ki-plus fs-2 me-2" }, [t("span", { class: "path1" }), t("span", { class: "path2" }), t("span", { class: "path3" })], -1), m(" New Allocation ")])), s[35] || (s[35] = t("button", { class: "btn btn-light-primary" }, [t("i", { class: "ki-duotone ki-printer fs-2 me-2" }, [t("span", { class: "path1" }), t("span", { class: "path2" })]), m(" Print Receipt ")], -1))])])])) : u("", !0)]), d.value < 4 ? (n(), l("div", ae, [t("div", le, [t("button", { class: "btn btn-light", onClick: gt, disabled: d.value === 0 }, s[37] || (s[37] = [t("i", { class: "ki-duotone ki-arrow-left fs-2 me-2" }, [t("span", { class: "path1" }), t("span", { class: "path2" })], -1), m(" Back ")]), 8, ne), t("div", ie, [d.value === 3 ? (n(), l("button", { key: 0, class: "btn btn-primary", onClick: bt, disabled: !tt.value || B.value }, [B.value ? (n(), l("span", de)) : (n(), l("i", ce, s[38] || (s[38] = [t("span", { class: "path1" }, null, -1), t("span", { class: "path2" }, null, -1)]))), s[39] || (s[39] = m(" Complete Allocation "))], 8, oe)) : (n(), l("button", { key: 1, class: "btn btn-primary", onClick: F, disabled: !Z.value }, s[40] || (s[40] = [m(" Next "), t("i", { class: "ki-duotone ki-arrow-right fs-2 ms-2" }, [t("span", { class: "path1" }), t("span", { class: "path2" })], -1)]), 8, re))])])])) : u("", !0)])]), t("div", ue, [t("div", ve, [s[46] || (s[46] = t("div", { class: "card-header pt-5" }, [t("h3", { class: "card-title fw-bold" }, "Allocation Summary")], -1)), t("div", pe, [t("div", me, [J.value ? (n(), l("div", he, [s[41] || (s[41] = t("div", { class: "fs-7 text-muted mb-1" }, "Station", -1)), t("div", fe, i(J.value.StationName), 1)])) : u("", !0), Y.value ? (n(), l("div", ge, [s[42] || (s[42] = t("div", { class: "fs-7 text-muted mb-1" }, "Supplier", -1)), t("div", be, i(Y.value.Name), 1)])) : u("", !0), C.value ? (n(), l("div", ye, [s[43] || (s[43] = t("div", { class: "fs-7 text-muted mb-1" }, "Payment", -1)), t("div", _e, i(C.value.PaymentReference), 1), t("div", xe, i(p(C.value.PaymentAmount)), 1)])) : u("", !0), d.value === 3 && C.value ? (n(), l("div", ke, [s[44] || (s[44] = t("div", { class: "separator my-4" }, null, -1)), s[45] || (s[45] = t("div", { class: "fs-7 text-muted mb-2" }, "Allocation Progress", -1)), t("div", we, [t("div", { class: "progress-bar bg-success", style: T(`width: ${at.value}%`) }, null, 4)]), t("div", Se, [t("span", null, i(p(g.value)), 1), t("span", Ie, i(p(y.value)), 1)])])) : u("", !0)])])]), W.value && h.series.length ? (n(), l("div", De, [s[52] || (s[52] = t("div", { class: "card-header pt-5" }, [t("h3", { class: "card-title fw-bold" }, "Station Analytics")], -1)), t("div", Pe, [t("div", Ae, [t("div", Ce, [s[47] || (s[47] = t("span", { class: "fs-7 fw-semibold" }, "Current (0-30 days)", -1)), t("span", $e, i(p(h.series[0])), 1)]), t("div", Ne, [t("div", { class: "progress-bar bg-success", style: T(`width: ${q(0)}%`) }, null, 4)])]), t("div", Oe, [t("div", je, [s[48] || (s[48] = t("span", { class: "fs-7 fw-semibold" }, "Overdue (31-60 days)", -1)), t("span", Ee, i(p(h.series[1])), 1)]), t("div", Me, [t("div", { class: "progress-bar bg-warning", style: T(`width: ${q(1)}%`) }, null, 4)])]), t("div", Te, [t("div", Be, [s[49] || (s[49] = t("span", { class: "fs-7 fw-semibold" }, "Critical (60+ days)", -1)), t("span", Le, i(p(h.series[2])), 1)]), t("div", Fe, [t("div", { class: "progress-bar bg-danger", style: T(`width: ${q(2)}%`) }, null, 4)])]), A.value.length ? (n(), l("div", Ue, [s[51] || (s[51] = t("div", { class: "fs-6 fw-bold mb-3" }, "Risk Indicators", -1)), t("div", Re, [(n(!0), l($, null, N(A.value, (e, o) => (n(), l("div", { key: o, class: "alert alert-light-danger py-2 mb-0" }, [t("div", Ve, [s[50] || (s[50] = t("i", { class: "ki-duotone ki-information-5 fs-2 me-2" }, [t("span", { class: "path1" }), t("span", { class: "path2" }), t("span", { class: "path3" })], -1)), t("div", ze, i(e), 1)])]))), 128))])])) : u("", !0)])])) : u("", !0)])])]), L.value ? (n(), l("div", Ge, [t("div", He, [t("div", We, [t("div", Je, [s[53] || (s[53] = t("h5", { class: "modal-title fw-bold" }, "Payment Allocation Guide", -1)), t("button", { type: "button", class: "btn-close", onClick: s[2] || (s[2] = e => L.value = !1) })]), s[54] || (s[54] = _('<div class="modal-body" data-v-610a4e23><div class="d-flex flex-column gap-4" data-v-610a4e23><div data-v-610a4e23><h6 class="fw-bold mb-2" data-v-610a4e23>Overview</h6><p class="text-muted" data-v-610a4e23> Payment allocation ensures that supplier payments are properly matched to specific invoices, maintaining accurate financial records and enabling proper cash flow management. </p></div><div data-v-610a4e23><h6 class="fw-bold mb-2" data-v-610a4e23>Process Steps</h6><ol class="text-muted" data-v-610a4e23><li data-v-610a4e23><strong data-v-610a4e23>Station Selection:</strong> Choose the station where the payment was received </li><li data-v-610a4e23><strong data-v-610a4e23>Supplier Selection:</strong> Select the supplier from those assigned to the station </li><li data-v-610a4e23><strong data-v-610a4e23>Payment Selection:</strong> Choose an unallocated payment to distribute </li><li data-v-610a4e23><strong data-v-610a4e23>Invoice Allocation:</strong> Distribute the payment across outstanding invoices </li><li data-v-610a4e23><strong data-v-610a4e23>Confirmation:</strong> Review and confirm the allocation</li></ol></div><div data-v-610a4e23><h6 class="fw-bold mb-2" data-v-610a4e23>Best Practices</h6><ul class="text-muted" data-v-610a4e23><li data-v-610a4e23>Allocate payments promptly to maintain accurate records</li><li data-v-610a4e23>Pay attention to overdue invoices (highlighted in red)</li><li data-v-610a4e23>Review fraud warnings and risk indicators</li><li data-v-610a4e23>Ensure total allocation doesn&#39;t exceed available amount</li></ul></div></div></div>', 1)), t("div", qe, [t("button", { type: "button", class: "btn btn-light", onClick: s[3] || (s[3] = e => L.value = !1) }, "Close")])])])])) : u("", !0)]) } } }, Ye = _t(Xe, [["__scopeId", "data-v-610a4e23"]]); export { Ye as default };
