import{_ as Y,r as u,c as C,o as X,S as i,b as h,d as t,e as S,g as Z,t as c,f as U,n as $,F as tt,h as et,k as st,i as v}from"./index-BJk99QVQ.js";import{C as V,r as at}from"./chart-DUfl3Dpl.js";V.register(...at);const ot={class:"d-flex flex-column gap-5"},nt={class:"card card-flush bg-light-primary"},it={class:"card-body"},rt={class:"d-flex justify-content-between align-items-center"},lt={class:"d-flex align-items-center gap-3"},ct={class:"text-gray-600 mb-0"},dt={class:"text-end"},ut={class:"badge badge-light-success fs-7"},ft={class:"text-gray-500 fs-8 mb-0"},pt={class:"row g-3"},ht={class:"col-6"},vt={class:"card card-flush bg-light-success"},mt={class:"card-body p-4"},wt={class:"d-flex align-items-center gap-2"},bt={class:"text-success fs-6 fw-bold mb-0"},gt={class:"col-6"},yt={class:"card card-flush bg-light-warning"},Ct={class:"card-body p-4"},_t={class:"d-flex align-items-center gap-2"},xt={class:"text-warning fs-6 fw-bold mb-0"},St={class:"card card-flush"},kt={class:"card-body"},Dt={class:"row g-3"},It={key:0,class:"col-6"},Ot=["disabled"],$t={key:1,class:"col-6"},At=["disabled"],Bt={key:2,class:"col-6"},Ft=["disabled"],Tt={key:3,class:"col-6"},Et=["disabled"],Pt={class:"card card-flush"},Nt={class:"card-header"},Ut={class:"card-toolbar"},Vt={class:"badge badge-light-primary"},jt={class:"card-body"},Rt={class:"card card-flush"},Jt={class:"card-body"},Lt={class:"row g-3"},Mt={class:"col-6"},zt={class:"bg-light-success rounded p-3"},Ht={class:"text-dark fs-5 fw-bold mb-0"},Wt={class:"col-6"},qt={class:"bg-light-warning rounded p-3"},Gt={class:"text-dark fs-5 fw-bold mb-0"},Kt={class:"col-6"},Qt={class:"bg-light-info rounded p-3"},Yt={class:"text-dark fs-5 fw-bold mb-0"},Xt={class:"col-6"},Zt={class:"text-dark fs-5 fw-bold mb-0"},te={class:"card card-flush"},ee={class:"card-body"},se={class:"timeline timeline-border-dashed"},ae={class:"timeline-icon symbol symbol-circle symbol-40px"},oe={class:"timeline-content mb-5"},ne={class:"pe-3 mb-2"},ie={class:"fs-6 fw-bold mb-1"},re={class:"text-gray-600 fs-7"},le={class:"overflow-auto"},ce={class:"badge badge-light-primary"},de={key:0,class:"position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-dark bg-opacity-50",style:{"z-index":"1050"}},ue="https://backend.cloudfuelstationmis.com/api/records/v1",fe={__name:"ShiftOps",setup(pe){const j=localStorage.getItem("kigrama_auth_token")||"demo_token",o=u(!1),A=u(null);let B=null;const m=u(JSON.parse(localStorage.getItem("kigrama_user_data")||"{}")),w=u(null),k=u([]),p=u(null),n=u(null),y=u([]),b=u(null),f=async(s,e={})=>{try{const a=await fetch(`${ue}${s}`,{headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json",...e.headers},...e});if(!a.ok){const r=await a.json().catch(()=>({}));throw new Error(r.message||`API Error: ${a.status}`)}return await a.json()}catch(a){throw console.error("API call failed:",a),a}},D=C(()=>p.value&&p.value.TimeIn&&!p.value.TimeOut),I=C(()=>n.value&&n.value.Status==="Open"),R=C(()=>D.value&&I.value?"Active Shift":D.value?"Clocked In":I.value?"Shift Open":"Off Duty"),J=C(()=>{if(!b.value)return"00:00:00";const s=new Date(b.value),a=new Date-s,r=Math.floor(a/(1e3*60*60)),d=Math.floor(a%(1e3*60*60)/(1e3*60)),l=Math.floor(a%(1e3*60)/1e3);return`${r.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`}),E=C(()=>{if(!n.value)return"0.00";const s=parseFloat(n.value.ExpectedCash||0);return(parseFloat(n.value.ActualCash||0)-s).toFixed(2)}),P=C(()=>{const s=parseFloat(E.value);return s>0?"success":s<0?"danger":"primary"}),F=u(85.6),L=async()=>{var s;try{const e=(s=m.value.user)==null?void 0:s.id;if(!e)throw new Error("User ID not found");const a=await f(`/UserStations?UserID=${e}`);if(k.value=a.records||[],k.value.length>0){const r=k.value.find(l=>l.IsPrimary==="1")||k.value[0],d=await f(`/Stations/${r.StationID}`);w.value=d}}catch(e){console.error("Error fetching user stations:",e),i.fire({title:"Error!",text:"Failed to load station data",icon:"error",confirmButtonColor:"#f1416c"})}},T=async()=>{var s,e;try{const a=(s=m.value.user)==null?void 0:s.id,r=(e=w.value)==null?void 0:e.StationID;if(!a||!r)return;const d=new Date().toISOString().split("T")[0],l=await f(`/Attendance?UserID=${a}&StationID=${r}&AttendanceDate=${d}`);l.records&&l.records.length>0&&(p.value=l.records[0],p.value.TimeIn&&(b.value=p.value.TimeIn))}catch(a){console.error("Error fetching attendance:",a)}},_=async()=>{var s,e;try{const a=(s=m.value.user)==null?void 0:s.id,r=(e=w.value)==null?void 0:e.StationID;if(!a||!r)return;const d=new Date().toISOString().split("T")[0],l=await f(`/CashDrawers?StationID=${r}&ShiftDate=${d}&AttendantID=${a}`);l.records&&l.records.length>0&&(n.value=l.records[0])}catch(a){console.error("Error fetching cash drawer:",a)}},M=()=>{y.value=[{id:1,title:"Shift Started",description:"Clock-in recorded successfully",timestamp:new Date(Date.now()-2*60*60*1e3),icon:"ki-entrance-right",color:"success"},{id:2,title:"Cash Drawer Opened",description:"Opening balance: $500.00",timestamp:new Date(Date.now()-1.5*60*60*1e3),icon:"ki-bank",color:"primary"},{id:3,title:"Transaction Processed",description:"45.5L Gasoline - $58.50",timestamp:new Date(Date.now()-45*60*1e3),icon:"ki-arrow-up-right",color:"info"},{id:4,title:"Cash Count",description:"Interim count: $1,250.75",timestamp:new Date(Date.now()-30*60*1e3),icon:"ki-dollar",color:"warning"}]},z=async()=>{o.value=!0;try{const s=new Date().toISOString(),e=new Date().toISOString().split("T")[0],a={StationID:w.value.StationID,UserID:m.value.user.id,AttendanceDate:e,TimeIn:s,Status:"Present",Notes:"Clock-in via mobile app"};await f("/Attendance",{method:"POST",body:JSON.stringify(a)}),await i.fire({title:"Clocked In!",text:`Welcome back! Shift started at ${O(new Date)}`,icon:"success",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1}),await T(),x("Clock In","Successfully clocked in for shift","success","ki-entrance-right")}catch(s){i.fire({title:"Clock In Failed!",text:s.message,icon:"error",confirmButtonColor:"#f1416c"})}finally{o.value=!1}},H=async()=>{if((await i.fire({title:"Clock Out Confirmation",text:"Are you sure you want to clock out?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, Clock Out",confirmButtonColor:"#f1416c"})).isConfirmed){o.value=!0;try{const e=new Date().toISOString();await f(`/Attendance/${p.value.AttendanceID}`,{method:"PATCH",body:JSON.stringify({TimeOut:e,Status:"Completed"})}),await i.fire({title:"Clocked Out!",text:`Shift ended at ${O(new Date)}. Have a great day!`,icon:"success",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1}),p.value=null,b.value=null,x("Clock Out","Successfully clocked out from shift","danger","ki-entrance-left")}catch(e){i.fire({title:"Clock Out Failed!",text:e.message,icon:"error",confirmButtonColor:"#f1416c"})}finally{o.value=!1}}},W=async()=>{const{value:s}=await i.fire({title:"Open Cash Drawer",text:"Enter opening cash balance:",input:"number",inputAttributes:{min:0,step:.01,placeholder:"0.00"},showCancelButton:!0,confirmButtonText:"Open Shift",confirmButtonColor:"#3699ff"});if(!(!s&&s!==0)){o.value=!0;try{const e=new Date().toISOString().split("T")[0],a={StationID:w.value.StationID,ShiftDate:e,ShiftType:"Day",AttendantID:m.value.user.id,OpeningBalance:parseFloat(s).toFixed(2),ExpectedCash:parseFloat(s).toFixed(2),ActualCash:parseFloat(s).toFixed(2),Status:"Open",OpenedBy:m.value.user.id,OpenedAt:new Date().toISOString(),Notes:"Shift opened via mobile app"};await f("/CashDrawers",{method:"POST",body:JSON.stringify(a)}),await i.fire({title:"Shift Opened!",text:`Cash drawer opened with $${s}`,icon:"success",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1}),await _(),x("Shift Opened",`Opening balance: $${s}`,"primary","ki-bank")}catch(e){i.fire({title:"Open Shift Failed!",text:e.message,icon:"error",confirmButtonColor:"#f1416c"})}finally{o.value=!1}}},q=async()=>{var e;const{value:s}=await i.fire({title:"Close Cash Drawer",text:"Enter actual cash count:",input:"number",inputAttributes:{min:0,step:.01,placeholder:((e=n.value)==null?void 0:e.ExpectedCash)||"0.00"},showCancelButton:!0,confirmButtonText:"Close Shift",confirmButtonColor:"#f1416c"});if(!(!s&&s!==0)){o.value=!0;try{await f(`/CashDrawers/${n.value.DrawerID}`,{method:"PATCH",body:JSON.stringify({ActualCash:parseFloat(s).toFixed(2),ClosingBalance:parseFloat(s).toFixed(2),Variance:(parseFloat(s)-parseFloat(n.value.ExpectedCash)).toFixed(2),Status:"Closed",ClosedBy:m.value.user.id,ClosedAt:new Date().toISOString()})});const a=parseFloat(s)-parseFloat(n.value.ExpectedCash);await i.fire({title:"Shift Closed!",text:`Final count: $${s} | Variance: $${a.toFixed(2)}`,icon:a===0?"success":"warning",toast:!0,position:"top-end",timer:4e3,showConfirmButton:!1}),await _(),x("Shift Closed",`Final count: $${s}`,"info","ki-safe-home")}catch(a){i.fire({title:"Close Shift Failed!",text:a.message,icon:"error",confirmButtonColor:"#f1416c"})}finally{o.value=!1}}},G=async()=>{if(!n.value){i.fire({title:"No Active Drawer",text:"Please open a shift first",icon:"info",confirmButtonColor:"#3699ff"});return}const{value:s}=await i.fire({title:"Update Cash Count",text:"Enter current cash amount:",input:"number",inputValue:n.value.ActualCash,inputAttributes:{min:0,step:.01},showCancelButton:!0,confirmButtonText:"Update"});if(!(!s&&s!==0)){o.value=!0;try{await f(`/CashDrawers/${n.value.DrawerID}`,{method:"PATCH",body:JSON.stringify({ActualCash:parseFloat(s).toFixed(2),Variance:(parseFloat(s)-parseFloat(n.value.ExpectedCash)).toFixed(2)})}),await i.fire({title:"Updated!",text:"Cash count updated successfully",icon:"success",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1}),await _(),x("Cash Count",`Updated count: $${s}`,"warning","ki-dollar")}catch(e){i.fire({title:"Update Failed!",text:e.message,icon:"error",confirmButtonColor:"#f1416c"})}finally{o.value=!1}}},O=s=>new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),x=(s,e,a,r)=>{y.value.unshift({id:Date.now(),title:s,description:e,timestamp:new Date,color:a,icon:r}),y.value.length>10&&(y.value=y.value.slice(0,10))},K=async()=>{o.value=!0;try{await Promise.all([T(),_()]),await i.fire({title:"Refreshed!",text:"Data updated successfully",icon:"success",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})}catch(s){console.error("Refresh error:",s)}finally{o.value=!1}},Q=()=>{st(()=>{if(!A.value)return;const s=A.value.getContext("2d");B&&B.destroy(),B=new V(s,{type:"doughnut",data:{labels:["Completed","Remaining"],datasets:[{data:[F.value,100-F.value],backgroundColor:["#50cd89","#e4e6ef"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},cutout:"70%"}})})};return setInterval(()=>{b.value&&(b.value=b.value)},1e3),X(async()=>{o.value=!0;try{await L(),w.value&&await Promise.all([T(),_()]),M(),Q()}catch(s){console.error("Initialization error:",s),i.fire({title:"Initialization Error",text:"Failed to load shift data",icon:"error",confirmButtonColor:"#f1416c"})}finally{o.value=!1}}),(s,e)=>{var a,r,d,l,N;return v(),h("div",ot,[t("div",nt,[t("div",it,[t("div",rt,[t("div",lt,[e[1]||(e[1]=Z('<div class="symbol symbol-50px" data-v-5fce06e6><div class="symbol-label bg-primary" data-v-5fce06e6><i class="ki-duotone ki-calendar-8 fs-2 text-white" data-v-5fce06e6><span class="path1" data-v-5fce06e6></span><span class="path2" data-v-5fce06e6></span><span class="path3" data-v-5fce06e6></span><span class="path4" data-v-5fce06e6></span><span class="path5" data-v-5fce06e6></span><span class="path6" data-v-5fce06e6></span></i></div></div>',1)),t("div",null,[e[0]||(e[0]=t("h2",{class:"text-primary fw-bold mb-1"},"Shift Management",-1)),t("p",ct,c(((a=w.value)==null?void 0:a.StationName)||"Loading..."),1)])]),t("div",dt,[t("span",ut,c(R.value),1),t("p",ft,c(O(new Date)),1)])])])]),t("div",pt,[t("div",ht,[t("div",vt,[t("div",mt,[t("div",wt,[e[3]||(e[3]=t("i",{class:"ki-duotone ki-timer fs-1 text-success"},[t("span",{class:"path1"}),t("span",{class:"path2"}),t("span",{class:"path3"})],-1)),t("div",null,[t("p",bt,c(J.value),1),e[2]||(e[2]=t("p",{class:"text-gray-600 fs-8 mb-0"},"Shift Duration",-1))])])])])]),t("div",gt,[t("div",yt,[t("div",Ct,[t("div",_t,[e[5]||(e[5]=t("i",{class:"ki-duotone ki-dollar fs-1 text-warning"},[t("span",{class:"path1"}),t("span",{class:"path2"}),t("span",{class:"path3"})],-1)),t("div",null,[t("p",xt," $"+c(((r=n.value)==null?void 0:r.ActualCash)||"0.00"),1),e[4]||(e[4]=t("p",{class:"text-gray-600 fs-8 mb-0"},"Cash on Hand",-1))])])])])])]),t("div",St,[e[10]||(e[10]=t("div",{class:"card-header"},[t("h3",{class:"card-title fw-bold"},"Quick Actions")],-1)),t("div",kt,[t("div",Dt,[D.value?S("",!0):(v(),h("div",It,[t("button",{onClick:z,disabled:o.value,class:"btn btn-light-success w-100 h-60px d-flex flex-column justify-content-center"},e[6]||(e[6]=[t("i",{class:"ki-duotone ki-entrance-right fs-2"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),t("span",{class:"fw-bold"},"Clock In",-1)]),8,Ot)])),D.value?(v(),h("div",$t,[t("button",{onClick:H,disabled:o.value,class:"btn btn-light-danger w-100 h-60px d-flex flex-column justify-content-center"},e[7]||(e[7]=[t("i",{class:"ki-duotone ki-entrance-left fs-2"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),t("span",{class:"fw-bold"},"Clock Out",-1)]),8,At)])):S("",!0),I.value?S("",!0):(v(),h("div",Bt,[t("button",{onClick:W,disabled:o.value,class:"btn btn-light-primary w-100 h-60px d-flex flex-column justify-content-center"},e[8]||(e[8]=[t("i",{class:"ki-duotone ki-bank fs-2"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),t("span",{class:"fw-bold"},"Open Shift",-1)]),8,Ft)])),I.value?(v(),h("div",Tt,[t("button",{onClick:q,disabled:o.value,class:"btn btn-light-info w-100 h-60px d-flex flex-column justify-content-center"},e[9]||(e[9]=[t("i",{class:"ki-duotone ki-safe-home fs-2"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),t("span",{class:"fw-bold"},"Close Shift",-1)]),8,Et)])):S("",!0)])])]),t("div",Pt,[t("div",Nt,[e[11]||(e[11]=t("h3",{class:"card-title fw-bold"},"Today's Performance",-1)),t("div",Ut,[t("span",Vt,c(F.value.toFixed(2))+"% Target",1)])]),t("div",jt,[t("canvas",{ref_key:"performanceChart",ref:A,height:"200"},null,512)])]),t("div",Rt,[t("div",{class:"card-header"},[e[13]||(e[13]=t("h3",{class:"card-title fw-bold"},"Cash Drawer",-1)),t("div",{class:"card-toolbar"},[t("button",{onClick:G,class:"btn btn-sm btn-light-primary"},e[12]||(e[12]=[t("i",{class:"ki-duotone ki-notepad-edit fs-3"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),U(" Update ")]))])]),t("div",Jt,[t("div",Lt,[t("div",Mt,[t("div",zt,[e[14]||(e[14]=t("p",{class:"text-success fs-7 fw-bold mb-1"},"Opening Balance",-1)),t("p",Ht," $"+c(((d=n.value)==null?void 0:d.OpeningBalance)||"0.00"),1)])]),t("div",Wt,[t("div",qt,[e[15]||(e[15]=t("p",{class:"text-warning fs-7 fw-bold mb-1"},"Expected Cash",-1)),t("p",Gt," $"+c(((l=n.value)==null?void 0:l.ExpectedCash)||"0.00"),1)])]),t("div",Kt,[t("div",Qt,[e[16]||(e[16]=t("p",{class:"text-info fs-7 fw-bold mb-1"},"Actual Cash",-1)),t("p",Yt," $"+c(((N=n.value)==null?void 0:N.ActualCash)||"0.00"),1)])]),t("div",Xt,[t("div",{class:$(`bg-light-${P.value} rounded p-3`)},[t("p",{class:$(`text-${P.value} fs-7 fw-bold mb-1`)},"Variance",2),t("p",Zt,"$"+c(E.value),1)],2)])])])]),t("div",te,[t("div",{class:"card-header"},[e[18]||(e[18]=t("h3",{class:"card-title fw-bold"},"Recent Activity",-1)),t("div",{class:"card-toolbar"},[t("button",{onClick:K,class:"btn btn-sm btn-light-primary"},e[17]||(e[17]=[t("i",{class:"ki-duotone ki-arrows-circle fs-3"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),U(" Refresh ")]))])]),t("div",ee,[t("div",se,[(v(!0),h(tt,null,et(y.value,g=>(v(),h("div",{class:"timeline-item",key:g.id},[e[20]||(e[20]=t("div",{class:"timeline-line w-40px"},null,-1)),t("div",ae,[t("div",{class:$(`symbol-label bg-light-${g.color}`)},[t("i",{class:$(`ki-duotone ${g.icon} fs-4 text-${g.color}`)},e[19]||(e[19]=[t("span",{class:"path1"},null,-1),t("span",{class:"path2"},null,-1)]),2)],2)]),t("div",oe,[t("div",ne,[t("div",ie,c(g.title),1),t("div",re,c(g.description),1)]),t("div",le,[t("span",ce,c(O(g.timestamp)),1)])])]))),128))])])]),o.value?(v(),h("div",de,e[21]||(e[21]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):S("",!0)])}}},me=Y(fe,[["__scopeId","data-v-5fce06e6"]]);export{me as default};
