import{r as m,a as z,o as q,k as Z,b as a,d as t,g as B,e as E,f as M,t as i,w as n,v as u,F as x,h,x as X,m as y,p as Q,i as r,n as W}from"./index-BJk99QVQ.js";const Y={class:"d-flex flex-column gap-6 py-4 px-2 bg-white min-vh-100"},K={class:"card card-flush border-0 shadow-sm bg-white"},_={class:"card-header py-4 d-flex align-items-center gap-3"},tt={class:"d-flex gap-3 flex-wrap"},et={class:"card bg-light-primary rounded-3 shadow-sm flex-grow-1 min-w-150px"},st={class:"card-body d-flex align-items-center gap-2"},ot={class:"fs-3 fw-bold"},lt={class:"card bg-light-success rounded-3 shadow-sm flex-grow-1 min-w-150px"},it={class:"card-body d-flex align-items-center gap-2"},nt={class:"fs-3 fw-bold"},at={class:"card bg-light-danger rounded-3 shadow-sm flex-grow-1 min-w-150px"},rt={class:"card-body d-flex align-items-center gap-2"},dt={class:"fs-3 fw-bold"},ut={class:"card bg-light-warning rounded-3 shadow-sm flex-grow-1 min-w-150px"},pt={class:"card-body d-flex align-items-center gap-2"},ft={class:"fs-3 fw-bold"},ct={class:"card card-flush bg-white shadow-sm rounded-4"},mt={class:"card-header px-2 pt-2 pb-1 d-flex align-items-center gap-2"},vt={class:"card-body p-0"},bt={class:"table table-row-dashed table-row-gray-300 gy-3"},wt=["onClick"],gt={key:0},xt={key:0,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0, 0, 0, 0.7)","z-index":"9999"}},ht={class:"modal-dialog modal-fullscreen"},yt={class:"modal-content p-5"},kt={class:"d-flex align-items-center mb-4"},Dt={class:"fs-2 fw-bold"},It={class:"d-flex flex-wrap gap-4"},Pt={class:"flex-grow-1 min-w-180px"},Ct={class:"flex-grow-1 min-w-180px"},At={class:"d-flex flex-wrap gap-4"},Mt={class:"flex-grow-1 min-w-180px"},Ut=["value"],Vt={class:"flex-grow-1 min-w-180px"},Tt=["value"],Et={class:"flex-grow-1 min-w-180px"},Gt=["value"],St={class:"d-flex flex-wrap gap-4"},Nt={class:"flex-grow-1 min-w-180px"},Lt={class:"flex-grow-1 min-w-180px"},zt={class:"d-flex flex-wrap gap-4"},Bt={class:"form-check form-switch"},Qt={class:"form-check form-switch"},jt={class:"d-flex flex-wrap gap-4"},Rt={class:"flex-grow-1 min-w-180px"},Ht={class:"flex-grow-1 min-w-180px"},Jt={class:"flex-grow-1 min-w-180px"},Ot={class:"d-flex flex-wrap gap-4"},Ft={class:"flex-grow-1 min-w-180px"},$t=["value"],qt={class:"flex-grow-1 min-w-180px"},Zt=["value"],Xt={class:"d-flex gap-4"},Wt={type:"submit",class:"btn btn-light-primary fw-bold"},v="https://backend.cloudfuelstationmis.com/api/records/v1",b="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJFZERTQSJ9.eyJzdWIiOiJkMDc1QVZVSVNCcW9HN3dvZFV0MVZ3PT0iLCJpYXQiOjE3NTA1NTc4MzAsImV4cCI6MTc1MDU2MTQzMCwiZW1haWwiOiJhZG1pbkBsb2NhbGhvc3QiLCJjc3JmX3Rva2VuIjoiT1dQU2RLeXgwQzVGVEkwbzFqb0gifQ.FrYiUIu59y6ZqftgpEQNX-GwAxh2USHTety2Dpt9C5j0H3GophpudsUzxfQ8wXVc_jcwGsnYo6svB90zzs0MBQ",_t={__name:"Permissions",setup(Yt){const f=m([]),P=m([]),C=m([]),A=m([]),c=z({total:0,active:0,inactive:0,management:0}),U=m(""),V=m([]),T=m(!1),w=m("create"),o=z({PositionID:null,PositionCode:"",PositionTitle:"",DepartmentID:"",GradeID:"",ReportsToPositionID:"",MinExperience:"",MinEducation:"",PositionDescription:"",Responsibilities:"",Qualifications:"",Skills:"",IsManagement:0,HeadcountLimit:"",CurrentHeadcount:null,IsApprover:0,ApprovalLevel:"",IsActive:"1",CreatedBy:"",UpdatedBy:""});q(k);async function k(){await Promise.all([j(),R(),H(),J()]),G(),await Z($)}async function j(){try{const l=await fetch(`${v}/Positions`,{headers:{Authorization:b}});if(!l.ok)throw new Error("Failed to fetch Positions");const e=await l.json();f.value=e.records||[],c.total=f.value.length,c.active=f.value.filter(s=>s.IsActive==="1").length,c.inactive=f.value.filter(s=>s.IsActive!=="1").length,c.management=f.value.filter(s=>s.IsManagement==="1").length}catch{f.value=[]}}async function R(){try{const l=await fetch(`${v}/Departments`,{headers:{Authorization:b}});if(!l.ok)throw new Error("Failed to fetch Departments");P.value=(await l.json()).records||[]}catch{P.value=[]}}async function H(){try{const l=await fetch(`${v}/Grades`,{headers:{Authorization:b}});if(!l.ok)throw new Error("Failed to fetch Grades");C.value=(await l.json()).records||[]}catch{C.value=[]}}async function J(){try{const l=await fetch(`${v}/Users`,{headers:{Authorization:b}});if(!l.ok)throw new Error("Failed to fetch Users");A.value=(await l.json()).records||[]}catch{A.value=[]}}function G(){V.value=f.value.filter(l=>{var s,g;const e=U.value.toLowerCase();return((s=l.PositionCode)==null?void 0:s.toLowerCase().includes(e))||((g=l.PositionTitle)==null?void 0:g.toLowerCase().includes(e))})}function S(l=null){l?(Object.assign(o,l),w.value="edit"):(Object.assign(o,{PositionID:null,PositionCode:"",PositionTitle:"",DepartmentID:"",GradeID:"",ReportsToPositionID:"",MinExperience:"",MinEducation:"",PositionDescription:"",Responsibilities:"",Qualifications:"",Skills:"",IsManagement:0,HeadcountLimit:"",CurrentHeadcount:null,IsApprover:0,ApprovalLevel:"",IsActive:"1",CreatedBy:"",UpdatedBy:""}),w.value="create"),T.value=!0}function D(){T.value=!1}async function O(){const l={...o};w.value==="create"?(await fetch(`${v}/Positions`,{method:"POST",headers:{Authorization:b,"Content-Type":"application/json"},body:JSON.stringify({...l,PositionID:null})})).ok?(D(),await k()):alert("Failed to create position"):(await fetch(`${v}/Positions/${o.PositionID}`,{method:"PATCH",headers:{Authorization:b,"Content-Type":"application/json"},body:JSON.stringify(l)})).ok?(D(),await k()):alert("Failed to update position")}async function F(){if(!o.PositionID||!confirm("Delete this position?"))return;(await fetch(`${v}/Positions/${o.PositionID}`,{method:"DELETE",headers:{Authorization:b}})).ok?(D(),await k()):alert("Failed to delete position")}function N(l){const e=P.value.find(s=>s.DepartmentID==l);return e?e.DepartmentName:""}function L(l){const e=C.value.find(s=>s.GradeID==l);return e?`${e.GradeCode} - ${e.GradeName}`:""}function $(){if(!window.ApexCharts)return;const l={};f.value.forEach(d=>{const p=N(d.DepartmentID),I=L(d.GradeID);l[p]||(l[p]={}),l[p][I]||(l[p][I]=0),l[p][I]++});const e=Array.from(new Set(Object.values(l).flatMap(d=>Object.keys(d)))),s=Object.entries(l).map(([d,p])=>({name:d,data:e.map(I=>p[I]||0)})),g={chart:{type:"bar",height:300,stacked:!0},plotOptions:{bar:{horizontal:!1}},xaxis:{categories:e},series:s,legend:{position:"top"}};try{const d=document.querySelector("#positions-apexchart");if(d){d._apexcharts&&d._apexcharts.destroy();const p=new window.ApexCharts(d,g);p.render(),d._apexcharts=p}}catch{}}return(l,e)=>(r(),a("div",Y,[t("div",K,[t("div",_,[e[22]||(e[22]=B('<i class="ki-duotone ki-briefcase fs-2x text-primary"><span class="path1"></span><span class="path2"></span></i><div><div class="fs-1 fw-bold text-dark">Positions Management</div><div class="fs-6 text-gray-600">Create, update, analyze and manage all positions</div></div>',2)),t("button",{onClick:k,class:"btn btn-light-success ms-auto",title:"Refresh List"},e[20]||(e[20]=[t("i",{class:"ki-duotone ki-refresh fs-2"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1),M(" Refresh ")])),t("button",{onClick:e[0]||(e[0]=s=>S()),class:"btn btn-light-primary ms-2 fw-bold"},e[21]||(e[21]=[t("i",{class:"ki-duotone ki-plus fs-2"},null,-1),M(" New Position ")]))])]),t("div",tt,[t("div",et,[t("div",st,[e[24]||(e[24]=t("i",{class:"ki-duotone ki-people fs-2x text-primary"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),t("div",null,[t("div",ot,i(c.total),1),e[23]||(e[23]=t("div",{class:"fs-7 text-gray-700"},"Total Positions",-1))])])]),t("div",lt,[t("div",it,[e[26]||(e[26]=t("i",{class:"ki-duotone ki-user-check fs-2x text-success"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),t("div",null,[t("div",nt,i(c.active),1),e[25]||(e[25]=t("div",{class:"fs-7 text-gray-700"},"Active",-1))])])]),t("div",at,[t("div",rt,[e[28]||(e[28]=t("i",{class:"ki-duotone ki-user-x fs-2x text-danger"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),t("div",null,[t("div",dt,i(c.inactive),1),e[27]||(e[27]=t("div",{class:"fs-7 text-gray-700"},"Inactive",-1))])])]),t("div",ut,[t("div",pt,[e[30]||(e[30]=t("i",{class:"ki-duotone ki-sitemap fs-2x text-warning"},[t("span",{class:"path1"}),t("span",{class:"path2"})],-1)),t("div",null,[t("div",ft,i(c.management),1),e[29]||(e[29]=t("div",{class:"fs-7 text-gray-700"},"Management",-1))])])])]),e[62]||(e[62]=B('<div class="card card-flush bg-white shadow-sm rounded-4 p-2"><div class="card-header px-2 pt-2 pb-1"><div class="fs-5 fw-bold text-dark">Positions Distribution (ApexCharts)</div></div><div class="card-body"><div id="positions-apexchart" style="min-height:260px;width:100%;"></div></div></div><div class="separator my-5"></div>',2)),t("div",ct,[t("div",mt,[e[31]||(e[31]=t("i",{class:"ki-duotone ki-table fs-2 text-dark"},null,-1)),e[32]||(e[32]=t("div",{class:"fs-5 fw-bold text-dark"},"Positions List",-1)),n(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>U.value=s),onInput:G,class:"form-control form-control-lg ms-auto w-225px",placeholder:"Search positions..."},null,544),[[u,U.value]])]),t("div",vt,[t("table",bt,[e[35]||(e[35]=t("thead",null,[t("tr",{class:"fw-bold fs-7 text-gray-800"},[t("th",null,"#"),t("th",null,"Code"),t("th",null,"Title"),t("th",null,"Department"),t("th",null,"Grade"),t("th",null,"Headcount"),t("th",null,"Status"),t("th")])],-1)),t("tbody",null,[(r(!0),a(x,null,h(V.value,(s,g)=>(r(),a("tr",{key:s.PositionID},[t("td",null,i(g+1),1),t("td",null,i(s.PositionCode),1),t("td",null,i(s.PositionTitle),1),t("td",null,i(N(s.DepartmentID)),1),t("td",null,i(L(s.GradeID)),1),t("td",null,i(s.CurrentHeadcount),1),t("td",null,[t("span",{class:W(["badge",s.IsActive==="1"?"bg-light-success text-success":"bg-light-danger text-danger"])},i(s.IsActive==="1"?"Active":"Inactive"),3)]),t("td",null,[t("button",{onClick:d=>S(s),class:"btn btn-sm btn-icon btn-light-info",title:"Edit"},e[33]||(e[33]=[t("i",{class:"ki-duotone ki-pencil fs-2"},null,-1)]),8,wt)])]))),128)),V.value.length===0?(r(),a("tr",gt,e[34]||(e[34]=[t("td",{colspan:"8",class:"text-center py-5 text-gray-500 fs-6"},"No positions found",-1)]))):E("",!0)])])])]),T.value?(r(),a("div",xt,[t("div",ht,[t("div",yt,[t("div",kt,[t("div",Dt,i(w.value==="edit"?"Edit Position":"Create Position"),1),t("button",{onClick:D,class:"btn btn-light-danger ms-auto"},"Close")]),t("form",{onSubmit:X(O,["prevent"]),class:"d-flex flex-column gap-4"},[t("div",It,[t("div",Pt,[e[36]||(e[36]=t("label",{class:"form-label fw-bold"},"Position Code",-1)),n(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.PositionCode=s),required:"",class:"form-control form-control-lg",maxlength:"50"},null,512),[[u,o.PositionCode]])]),t("div",Ct,[e[37]||(e[37]=t("label",{class:"form-label fw-bold"},"Position Title",-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.PositionTitle=s),required:"",class:"form-control form-control-lg",maxlength:"100"},null,512),[[u,o.PositionTitle]])])]),t("div",At,[t("div",Mt,[e[39]||(e[39]=t("label",{class:"form-label fw-bold"},"Department",-1)),n(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.DepartmentID=s),required:"",class:"form-select form-select-lg"},[e[38]||(e[38]=t("option",{value:"",disabled:""},"Select",-1)),(r(!0),a(x,null,h(P.value,s=>(r(),a("option",{value:s.DepartmentID,key:s.DepartmentID},i(s.DepartmentName),9,Ut))),128))],512),[[y,o.DepartmentID]])]),t("div",Vt,[e[41]||(e[41]=t("label",{class:"form-label fw-bold"},"Job Grade",-1)),n(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.GradeID=s),required:"",class:"form-select form-select-lg"},[e[40]||(e[40]=t("option",{value:"",disabled:""},"Select",-1)),(r(!0),a(x,null,h(C.value,s=>(r(),a("option",{value:s.GradeID,key:s.GradeID},i(s.GradeCode)+" - "+i(s.GradeName),9,Tt))),128))],512),[[y,o.GradeID]])]),t("div",Et,[e[43]||(e[43]=t("label",{class:"form-label fw-bold"},"Reports To",-1)),n(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.ReportsToPositionID=s),class:"form-select form-select-lg"},[e[42]||(e[42]=t("option",{value:""},"(None)",-1)),(r(!0),a(x,null,h(f.value,s=>(r(),a("option",{value:s.PositionID,key:"reports-to-"+s.PositionID},i(s.PositionTitle),9,Gt))),128))],512),[[y,o.ReportsToPositionID]])])]),t("div",St,[t("div",Nt,[e[44]||(e[44]=t("label",{class:"form-label fw-bold"},"Minimum Experience (Months)",-1)),n(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.MinExperience=s),type:"number",min:"0",class:"form-control form-control-lg"},null,512),[[u,o.MinExperience]])]),t("div",Lt,[e[45]||(e[45]=t("label",{class:"form-label fw-bold"},"Minimum Education",-1)),n(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.MinEducation=s),class:"form-control form-control-lg",maxlength:"100"},null,512),[[u,o.MinEducation]])])]),t("div",null,[e[46]||(e[46]=t("label",{class:"form-label fw-bold"},"Position Description",-1)),n(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.PositionDescription=s),rows:"2",class:"form-control form-control-lg"},null,512),[[u,o.PositionDescription]])]),t("div",null,[e[47]||(e[47]=t("label",{class:"form-label fw-bold"},"Responsibilities",-1)),n(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=s=>o.Responsibilities=s),rows:"2",class:"form-control form-control-lg"},null,512),[[u,o.Responsibilities]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"form-label fw-bold"},"Qualifications",-1)),n(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=s=>o.Qualifications=s),rows:"2",class:"form-control form-control-lg"},null,512),[[u,o.Qualifications]])]),t("div",null,[e[49]||(e[49]=t("label",{class:"form-label fw-bold"},"Skills",-1)),n(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=s=>o.Skills=s),rows:"2",class:"form-control form-control-lg"},null,512),[[u,o.Skills]])]),t("div",zt,[t("div",Bt,[n(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>o.IsManagement=s),type:"checkbox",class:"form-check-input","true-value":"1","false-value":"0"},null,512),[[Q,o.IsManagement]]),e[50]||(e[50]=t("label",{class:"form-check-label fw-bold"},"Is Management",-1))]),t("div",Qt,[n(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>o.IsApprover=s),type:"checkbox",class:"form-check-input","true-value":"1","false-value":"0"},null,512),[[Q,o.IsApprover]]),e[51]||(e[51]=t("label",{class:"form-check-label fw-bold"},"Is Approver",-1))])]),t("div",jt,[t("div",Rt,[e[52]||(e[52]=t("label",{class:"form-label fw-bold"},"Headcount Limit",-1)),n(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>o.HeadcountLimit=s),type:"number",min:"0",class:"form-control form-control-lg"},null,512),[[u,o.HeadcountLimit]])]),t("div",Ht,[e[53]||(e[53]=t("label",{class:"form-label fw-bold"},"Approval Level",-1)),n(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>o.ApprovalLevel=s),type:"number",min:"0",class:"form-control form-control-lg"},null,512),[[u,o.ApprovalLevel]])]),t("div",Jt,[e[55]||(e[55]=t("label",{class:"form-label fw-bold"},"Active?",-1)),n(t("select",{"onUpdate:modelValue":e[17]||(e[17]=s=>o.IsActive=s),required:"",class:"form-select form-select-lg"},e[54]||(e[54]=[t("option",{value:"1"},"Active",-1),t("option",{value:"0"},"Inactive",-1)]),512),[[y,o.IsActive]])])]),t("div",Ot,[t("div",Ft,[e[57]||(e[57]=t("label",{class:"form-label fw-bold"},"Created By",-1)),n(t("select",{"onUpdate:modelValue":e[18]||(e[18]=s=>o.CreatedBy=s),required:"",class:"form-select form-select-lg"},[e[56]||(e[56]=t("option",{value:"",disabled:""},"Select User",-1)),(r(!0),a(x,null,h(A.value,s=>(r(),a("option",{key:"created-"+s.id,value:s.id},i(s.name),9,$t))),128))],512),[[y,o.CreatedBy]])]),t("div",qt,[e[59]||(e[59]=t("label",{class:"form-label fw-bold"},"Updated By",-1)),n(t("select",{"onUpdate:modelValue":e[19]||(e[19]=s=>o.UpdatedBy=s),class:"form-select form-select-lg"},[e[58]||(e[58]=t("option",{value:"",disabled:""},"Select User",-1)),(r(!0),a(x,null,h(A.value,s=>(r(),a("option",{key:"updated-"+s.id,value:s.id},i(s.name),9,Zt))),128))],512),[[y,o.UpdatedBy]])])]),t("div",Xt,[t("button",Wt,[e[60]||(e[60]=t("i",{class:"ki-duotone ki-save fs-2"},null,-1)),M(" "+i(w.value==="edit"?"Update":"Create"),1)]),t("button",{type:"button",onClick:D,class:"btn btn-light-danger fw-bold"}," Cancel "),w.value==="edit"?(r(),a("button",{key:0,type:"button",onClick:F,class:"btn btn-light-danger fw-bold ms-auto"},e[61]||(e[61]=[t("i",{class:"ki-duotone ki-trash fs-2"},null,-1),M(" Delete ")]))):E("",!0)])],32)])])])):E("",!0)]))}};export{_t as default};
