<template>
  <div class="d-flex flex-column flex-column-fluid">
    <!--begin::Toolbar-->
    <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
      <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
        <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
          <h1
            class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0"
          >
            Supplier Dashboard
          </h1>
          <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
            <li class="breadcrumb-item text-muted">
              <a href="#" class="text-muted text-hover-primary">Suppliers</a>
            </li>
            <li class="breadcrumb-item">
              <span class="bullet bg-gray-400 w-5px h-2px"></span>
            </li>
            <li class="breadcrumb-item text-muted">Dashboard</li>
          </ul>
        </div>
        <div class="d-flex align-items-center gap-2 gap-lg-3">
          <button class="btn btn-sm fw-bold btn-primary" @click="refreshData" :disabled="loading">
            <i class="ki-duotone ki-arrows-circle fs-2">
              <span class="path1"></span>
              <span class="path2"></span>
            </i>
            {{ loading ? 'Refreshing...' : 'Refresh Data' }}
          </button>
        </div>
      </div>
    </div>

    <!--begin::Content-->
    <div id="kt_app_content" class="app-content flex-column-fluid">
      <div id="kt_app_content_container" class="app-container container-xxl">
        <!--begin::Error Alert-->
        <div v-if="apiError" class="alert alert-danger d-flex align-items-center p-5 mb-10">
          <i class="ki-duotone ki-shield-cross fs-2hx text-danger me-4">
            <span class="path1"></span>
            <span class="path2"></span>
          </i>
          <div class="d-flex flex-column">
            <h4 class="mb-1 text-danger">API Connection Error</h4>
            <span>{{ apiError }}</span>
          </div>

          <!--begin::Additional Insights Row-->
          <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
            <!--begin::Recent Activity-->
            <div class="col-xl-8">
              <div class="card card-flush h-xl-100 bg-gradient-dark border-0 shadow-lg">
                <div class="card-header pt-5 border-0">
                  <h3 class="card-title align-items-start flex-column">
                    <span class="card-label fw-bold text-white fs-2">System Performance</span>
                    <span class="text-white opacity-75 pt-1 fw-semibold fs-6"
                      >Real-time supplier network status</span
                    >
                  </h3>
                </div>
                <div class="card-body pt-2 border-0">
                  <div class="row g-4">
                    <!--begin::Performance Metrics-->
                    <div class="col-md-6">
                      <div class="bg-white bg-opacity-10 rounded p-4 h-100">
                        <div class="d-flex align-items-center mb-3">
                          <i class="ki-duotone ki-rocket fs-2x text-warning me-3">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                          <div>
                            <div class="text-white fw-bold fs-5">Network Efficiency</div>
                            <div class="text-white opacity-75 fs-7">
                              Supplier-Station Performance
                            </div>
                          </div>
                        </div>

                        <div class="mb-3">
                          <div class="d-flex justify-content-between text-white mb-1">
                            <span class="fs-7">Coverage Rate</span>
                            <span class="fs-7">{{ getCoveragePercentage().toFixed(1) }}%</span>
                          </div>
                          <div class="progress h-4px bg-white bg-opacity-25">
                            <div
                              class="progress-bar bg-warning"
                              :style="`width: ${getCoveragePercentage()}%`"
                            ></div>
                          </div>
                        </div>

                        <div class="mb-3">
                          <div class="d-flex justify-content-between text-white mb-1">
                            <span class="fs-7">Active Suppliers</span>
                            <span class="fs-7">{{ getActivePercentage().toFixed(1) }}%</span>
                          </div>
                          <div class="progress h-4px bg-white bg-opacity-25">
                            <div
                              class="progress-bar bg-success"
                              :style="`width: ${getActivePercentage()}%`"
                            ></div>
                          </div>
                        </div>

                        <div>
                          <div class="d-flex justify-content-between text-white mb-1">
                            <span class="fs-7">Global Coverage</span>
                            <span class="fs-7"
                              >{{
                                ((metrics.globalSuppliers / metrics.totalSuppliers) * 100).toFixed(
                                  1,
                                )
                              }}%</span
                            >
                          </div>
                          <div class="progress h-4px bg-white bg-opacity-25">
                            <div
                              class="progress-bar bg-info"
                              :style="`width: ${(metrics.globalSuppliers / metrics.totalSuppliers) * 100}%`"
                            ></div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!--begin::Status Grid-->
                    <div class="col-md-6">
                      <div class="bg-white bg-opacity-10 rounded p-4 h-100">
                        <div class="d-flex align-items-center mb-3">
                          <i class="ki-duotone ki-abstract-26 fs-2x text-info me-3">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                          <div>
                            <div class="text-white fw-bold fs-5">System Health</div>
                            <div class="text-white opacity-75 fs-7">Current Status Overview</div>
                          </div>
                        </div>

                        <div class="row g-2">
                          <div class="col-6">
                            <div class="bg-success bg-opacity-20 rounded p-3 text-center">
                              <div class="text-white fs-3 fw-bold">
                                {{ metrics.activeSuppliers }}
                              </div>
                              <div class="text-white opacity-75 fs-8">Active</div>
                            </div>
                          </div>
                          <div class="col-6">
                            <div class="bg-primary bg-opacity-20 rounded p-3 text-center">
                              <div class="text-white fs-3 fw-bold">
                                {{ metrics.globalSuppliers }}
                              </div>
                              <div class="text-white opacity-75 fs-8">Global</div>
                            </div>
                          </div>
                          <div class="col-6">
                            <div class="bg-warning bg-opacity-20 rounded p-3 text-center">
                              <div class="text-white fs-3 fw-bold">
                                {{ metrics.coveredStations }}
                              </div>
                              <div class="text-white opacity-75 fs-8">Covered</div>
                            </div>
                          </div>
                          <div class="col-6">
                            <div class="bg-danger bg-opacity-20 rounded p-3 text-center">
                              <div class="text-white fs-3 fw-bold">
                                {{ metrics.pendingApprovals }}
                              </div>
                              <div class="text-white opacity-75 fs-8">Pending</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!--begin::Key Insights-->
            <div class="col-xl-4">
              <div class="card card-flush h-xl-100 bg-gradient-success border-0 shadow-lg">
                <div class="card-header pt-5 border-0">
                  <h3 class="card-title align-items-start flex-column">
                    <span class="card-label fw-bold text-white fs-2">Key Insights</span>
                    <span class="text-white opacity-75 pt-1 fw-semibold fs-6"
                      >Network optimization tips</span
                    >
                  </h3>
                </div>
                <div class="card-body pt-2 border-0">
                  <div class="d-flex flex-column h-100">
                    <!--begin::Insight Items-->
                    <div class="mb-4">
                      <div class="d-flex align-items-center mb-2">
                        <div class="symbol symbol-30px me-3">
                          <span class="symbol-label bg-white bg-opacity-25">
                            <i class="ki-duotone ki-arrow-up-right fs-5 text-white">
                              <span class="path1"></span>
                              <span class="path2"></span>
                            </i>
                          </span>
                        </div>
                        <div class="text-white fw-bold fs-6">Network Growth</div>
                      </div>
                      <div class="text-white opacity-75 fs-7 ms-10">
                        {{
                          getActivePercentage() > 80
                            ? 'Excellent supplier activation rate'
                            : 'Consider activating more suppliers'
                        }}
                      </div>
                    </div>

                    <div class="mb-4">
                      <div class="d-flex align-items-center mb-2">
                        <div class="symbol symbol-30px me-3">
                          <span class="symbol-label bg-white bg-opacity-25">
                            <i class="ki-duotone ki-geolocation fs-5 text-white">
                              <span class="path1"></span>
                              <span class="path2"></span>
                            </i>
                          </span>
                        </div>
                        <div class="text-white fw-bold fs-6">Coverage Status</div>
                      </div>
                      <div class="text-white opacity-75 fs-7 ms-10">
                        {{
                          getCoveragePercentage() > 75
                            ? 'Good station coverage achieved'
                            : 'Focus on expanding station coverage'
                        }}
                      </div>
                    </div>

                    <div class="mb-4">
                      <div class="d-flex align-items-center mb-2">
                        <div class="symbol symbol-30px me-3">
                          <span class="symbol-label bg-white bg-opacity-25">
                            <i class="ki-duotone ki-notification-status fs-5 text-white">
                              <span class="path1"></span>
                              <span class="path2"></span>
                              <span class="path3"></span>
                              <span class="path4"></span>
                            </i>
                          </span>
                        </div>
                        <div class="text-white fw-bold fs-6">Pending Actions</div>
                      </div>
                      <div class="text-white opacity-75 fs-7 ms-10">
                        {{
                          metrics.pendingApprovals > 0
                            ? `${metrics.pendingApprovals} items need attention`
                            : 'All approvals up to date'
                        }}
                      </div>
                    </div>

                    <!--begin::Action Button-->
                    <div class="mt-auto">
                      <button class="btn btn-light btn-sm w-100" @click="navigateToReports">
                        <i class="ki-duotone ki-chart-line-up fs-6 me-1">
                          <span class="path1"></span>
                          <span class="path2"></span>
                        </i>
                        View Detailed Analytics
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--begin::Loading State-->
        <div v-if="loading && !dataLoaded" class="d-flex justify-content-center py-20">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>

        <!--begin::Dashboard Content-->
        <div v-if="dataLoaded">
          <!--begin::Statistics Cards-->
          <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
            <!--begin::Total Suppliers-->
            <div class="col-md-6 col-lg-6 col-xl-6 col-xxl-3 mb-md-5 mb-xl-10">
              <div
                class="card card-flush bgi-no-repeat bgi-size-contain bgi-position-x-end h-md-50px bg-gradient-primary border-0 shadow-lg"
              >
                <div class="card-header pt-5 border-0">
                  <div class="card-title d-flex flex-column">
                    <div class="d-flex align-items-center">
                      <i class="ki-duotone ki-profile-user fs-2x text-white opacity-75 me-2">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                        <span class="path4"></span>
                      </i>
                      <span class="fs-4 fw-semibold text-white opacity-75 me-1 align-self-start"
                        >Total</span
                      >
                      <span class="fs-2hx fw-bold text-white me-2 lh-1 ls-n2">{{
                        metrics.totalSuppliers
                      }}</span>
                    </div>
                    <span class="text-white opacity-75 pt-1 fw-semibold fs-6"
                      >Registered Suppliers</span
                    >
                  </div>
                </div>
                <div class="card-body d-flex align-items-end pt-0 border-0">
                  <div class="d-flex align-items-center flex-column mt-3 w-100">
                    <div class="d-flex justify-content-between w-100 mt-auto mb-2">
                      <span class="fw-bolder fs-6 text-white">Active Now</span>
                      <span class="fw-bold fs-6 text-white opacity-75">{{
                        metrics.activeSuppliers
                      }}</span>
                    </div>
                    <div class="h-8px mx-3 w-100 bg-white bg-opacity-25 rounded">
                      <div
                        class="bg-white rounded h-8px shadow-sm"
                        :style="`width: ${getActivePercentage()}%`"
                      ></div>
                    </div>
                    <div class="text-center mt-2">
                      <span class="badge badge-light-success"
                        >{{ getActivePercentage().toFixed(1) }}% Active Rate</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!--begin::Active Suppliers-->
            <div class="col-md-6 col-lg-6 col-xl-6 col-xxl-3 mb-md-5 mb-xl-10">
              <div class="card card-flush h-md-50px bg-gradient-success border-0 shadow-lg">
                <div class="card-header pt-5 border-0">
                  <div class="card-title d-flex flex-column">
                    <div class="d-flex align-items-center">
                      <i class="ki-duotone ki-check-circle fs-2x text-white opacity-75 me-2">
                        <span class="path1"></span>
                        <span class="path2"></span>
                      </i>
                      <span class="fs-4 fw-semibold text-white opacity-75 me-1 align-self-start"
                        >Active</span
                      >
                      <span class="fs-2hx fw-bold text-white me-2 lh-1 ls-n2">{{
                        metrics.activeSuppliers
                      }}</span>
                      <span class="badge badge-light-white fs-base">
                        {{ getActivePercentage().toFixed(1) }}%
                      </span>
                    </div>
                    <span class="text-white opacity-75 pt-1 fw-semibold fs-6"
                      >Active Suppliers</span
                    >
                  </div>
                </div>
                <div class="card-body d-flex align-items-end pt-0 border-0">
                  <div class="d-flex align-items-center flex-column mt-3 w-100">
                    <div class="row w-100 text-center">
                      <div class="col-6">
                        <div class="bg-white bg-opacity-20 rounded p-3 mb-2">
                          <span class="fw-bolder fs-3 text-white d-block">{{
                            metrics.globalSuppliers
                          }}</span>
                          <span class="text-white opacity-75 fs-7">Global</span>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="bg-white bg-opacity-20 rounded p-3 mb-2">
                          <span class="fw-bolder fs-3 text-white d-block">{{
                            metrics.localSuppliers
                          }}</span>
                          <span class="text-white opacity-75 fs-7">Local</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!--begin::Station Coverage-->
            <div class="col-md-6 col-lg-6 col-xl-6 col-xxl-3 mb-md-5 mb-xl-10">
              <div class="card card-flush h-md-50px bg-gradient-info border-0 shadow-lg">
                <div class="card-header pt-5 border-0">
                  <div class="card-title d-flex flex-column">
                    <div class="d-flex align-items-center">
                      <i class="ki-duotone ki-geolocation fs-2x text-white opacity-75 me-2">
                        <span class="path1"></span>
                        <span class="path2"></span>
                      </i>
                      <span class="fs-2hx fw-bold text-white me-2 lh-1 ls-n2">{{
                        metrics.totalStations
                      }}</span>
                      <span class="badge badge-light-white fs-base">
                        {{ getCoveragePercentage().toFixed(1) }}%
                      </span>
                    </div>
                    <span class="text-white opacity-75 pt-1 fw-semibold fs-6"
                      >Station Coverage</span
                    >
                  </div>
                </div>
                <div class="card-body d-flex align-items-end pt-0 border-0">
                  <div class="d-flex align-items-center flex-column mt-3 w-100">
                    <div class="d-flex justify-content-between w-100 mt-auto mb-2">
                      <span class="fw-bolder fs-6 text-white">Covered</span>
                      <span class="fw-bold fs-6 text-white opacity-75"
                        >{{ metrics.coveredStations }}/{{ metrics.totalStations }}</span
                      >
                    </div>
                    <div class="h-8px mx-3 w-100 bg-white bg-opacity-25 rounded">
                      <div
                        class="bg-white rounded h-8px shadow-sm"
                        :style="`width: ${getCoveragePercentage()}%`"
                      ></div>
                    </div>
                    <div class="text-center mt-2">
                      <span
                        class="badge"
                        :class="
                          getCoveragePercentage() > 80
                            ? 'badge-light-success'
                            : getCoveragePercentage() > 60
                              ? 'badge-light-warning'
                              : 'badge-light-danger'
                        "
                      >
                        {{
                          getCoveragePercentage() > 80
                            ? 'Excellent'
                            : getCoveragePercentage() > 60
                              ? 'Good'
                              : 'Needs Attention'
                        }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!--begin::Pending Items-->
            <div class="col-md-6 col-lg-6 col-xl-6 col-xxl-3 mb-md-5 mb-xl-10">
              <div
                class="card card-flush h-md-50px border-0 shadow-lg"
                :class="metrics.pendingApprovals > 5 ? 'bg-gradient-danger' : 'bg-gradient-warning'"
              >
                <div class="card-header pt-5 border-0">
                  <div class="card-title d-flex flex-column">
                    <div class="d-flex align-items-center">
                      <i class="ki-duotone ki-notification-status fs-2x text-white opacity-75 me-2">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                        <span class="path4"></span>
                      </i>
                      <span class="fs-2hx fw-bold text-white me-2 lh-1 ls-n2">{{
                        metrics.pendingApprovals
                      }}</span>
                      <span
                        class="badge fs-base"
                        :class="
                          metrics.pendingApprovals > 5 ? 'badge-light-white' : 'badge-light-white'
                        "
                      >
                        {{ metrics.pendingApprovals > 5 ? 'Urgent' : 'Normal' }}
                      </span>
                    </div>
                    <span class="text-white opacity-75 pt-1 fw-semibold fs-6">Pending Actions</span>
                  </div>
                </div>
                <div class="card-body d-flex align-items-end pt-0 border-0">
                  <div class="d-flex align-items-center flex-column mt-3 w-100">
                    <div class="w-100">
                      <div
                        class="d-flex justify-content-between align-items-center mb-2 p-3 bg-white bg-opacity-20 rounded"
                      >
                        <span class="fw-bolder fs-6 text-white">
                          <i class="ki-duotone ki-check fs-4 me-1">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                          Approvals Needed
                        </span>
                        <span class="fw-bold fs-4 text-white">{{ metrics.pendingApprovals }}</span>
                      </div>
                      <div class="text-center">
                        <button class="btn btn-light btn-sm" @click="navigateToApprovals">
                          <i class="ki-duotone ki-arrow-right fs-6"></i>
                          Review Now
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--begin::Quick Actions Enhanced-->
          <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
            <div class="col-xl-12">
              <div class="card card-flush h-xl-100 bg-light-primary border-0 shadow-lg">
                <div class="card-header pt-5 border-0">
                  <h3 class="card-title align-items-start flex-column">
                    <span class="card-label fw-bold text-primary fs-2">Quick Actions Hub</span>
                    <span class="text-primary opacity-75 pt-1 fw-semibold fs-6"
                      >Streamlined supplier operations at your fingertips</span
                    >
                  </h3>
                  <div class="card-toolbar">
                    <span class="badge badge-primary fs-7"
                      >{{ metrics.totalSuppliers }} Total Suppliers</span
                    >
                  </div>
                </div>
                <div class="card-body pt-5 border-0">
                  <div class="row g-5">
                    <div class="col-6 col-md-3">
                      <div
                        class="card card-flush bg-gradient-primary border-0 shadow-sm h-100 cursor-pointer hover-elevate-up"
                        @click="navigateToAddSupplier"
                      >
                        <div class="card-body text-center p-6">
                          <div class="mb-4">
                            <i class="ki-duotone ki-plus-circle fs-3x text-white">
                              <span class="path1"></span>
                              <span class="path2"></span>
                            </i>
                          </div>
                          <div class="fw-bold text-white fs-5 mb-2">Add New Supplier</div>
                          <div class="text-white opacity-75 fs-7">
                            Register new supplier to the system
                          </div>
                          <div class="mt-3">
                            <span class="btn btn-sm btn-light">
                              <i class="ki-duotone ki-arrow-right fs-6"></i>
                              Start Now
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="col-6 col-md-3">
                      <div
                        class="card card-flush bg-gradient-success border-0 shadow-sm h-100 cursor-pointer hover-elevate-up"
                        @click="navigateToStationCoverage"
                      >
                        <div class="card-body text-center p-6">
                          <div class="mb-4">
                            <i class="ki-duotone ki-map fs-3x text-white">
                              <span class="path1"></span>
                              <span class="path2"></span>
                              <span class="path3"></span>
                            </i>
                          </div>
                          <div class="fw-bold text-white fs-5 mb-2">Manage Coverage</div>
                          <div class="text-white opacity-75 fs-7">Assign suppliers to stations</div>
                          <div class="mt-3">
                            <span class="btn btn-sm btn-light">
                              <i class="ki-duotone ki-geolocation fs-6">
                                <span class="path1"></span>
                                <span class="path2"></span>
                              </i>
                              Configure
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="col-6 col-md-3">
                      <div
                        class="card card-flush bg-gradient-warning border-0 shadow-sm h-100 cursor-pointer hover-elevate-up"
                        @click="navigateToSupplierList"
                      >
                        <div class="card-body text-center p-6">
                          <div class="mb-4">
                            <i class="ki-duotone ki-profile-user fs-3x text-white">
                              <span class="path1"></span>
                              <span class="path2"></span>
                              <span class="path3"></span>
                              <span class="path4"></span>
                            </i>
                          </div>
                          <div class="fw-bold text-white fs-5 mb-2">View All Suppliers</div>
                          <div class="text-white opacity-75 fs-7">
                            Browse and manage supplier list
                          </div>
                          <div class="mt-3">
                            <span class="btn btn-sm btn-light">
                              <i class="ki-duotone ki-eye fs-6">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                              </i>
                              Browse
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="col-6 col-md-3">
                      <div
                        class="card card-flush bg-gradient-info border-0 shadow-sm h-100 cursor-pointer hover-elevate-up"
                        @click="navigateToReports"
                      >
                        <div class="card-body text-center p-6">
                          <div class="mb-4">
                            <i class="ki-duotone ki-chart-line-up fs-3x text-white">
                              <span class="path1"></span>
                              <span class="path2"></span>
                            </i>
                          </div>
                          <div class="fw-bold text-white fs-5 mb-2">Analytics & Reports</div>
                          <div class="text-white opacity-75 fs-7">View performance insights</div>
                          <div class="mt-3">
                            <span class="btn btn-sm btn-light">
                              <i class="ki-duotone ki-chart fs-6">
                                <span class="path1"></span>
                                <span class="path2"></span>
                              </i>
                              Analyze
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!--begin::Additional Actions Row-->
                  <div class="row g-3 mt-5">
                    <div class="col-12">
                      <div class="d-flex flex-wrap gap-3 justify-content-center">
                        <button
                          class="btn btn-outline btn-outline-primary btn-sm"
                          @click="refreshData"
                          :disabled="loading"
                        >
                          <i class="ki-duotone ki-arrows-circle fs-6 me-1">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                          {{ loading ? 'Refreshing...' : 'Refresh Data' }}
                        </button>
                        <button
                          class="btn btn-outline btn-outline-success btn-sm"
                          @click="exportData"
                        >
                          <i class="ki-duotone ki-file-down fs-6 me-1">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                          Export Report
                        </button>
                        <button
                          class="btn btn-outline btn-outline-info btn-sm"
                          @click="viewSettings"
                        >
                          <i class="ki-duotone ki-setting-3 fs-6 me-1">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                          Settings
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--begin::Charts Row-->
          <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
            <!--begin::Supplier Status Visual-->
            <div class="col-xl-6">
              <div class="card card-flush h-xl-100 bg-gradient-primary">
                <div class="card-header pt-5">
                  <h3 class="card-title align-items-start flex-column">
                    <span class="card-label fw-bold text-white">Supplier Distribution</span>
                    <span class="text-white opacity-75 pt-1 fw-semibold fs-6"
                      >Active vs Inactive suppliers</span
                    >
                  </h3>
                  <div class="card-toolbar">
                    <span class="badge badge-light-success"
                      >{{ getActivePercentage().toFixed(1) }}% Active</span
                    >
                  </div>
                </div>
                <div class="card-body pt-2 pb-4">
                  <!--begin::Visual Donut Replacement-->
                  <div class="d-flex justify-content-center mb-6">
                    <div class="position-relative">
                      <div
                        class="bg-white bg-opacity-25 rounded-circle"
                        style="width: 150px; height: 150px; position: relative"
                      >
                        <div
                          class="bg-success rounded-circle position-absolute"
                          :style="`width: ${getActivePercentage()}px; height: ${getActivePercentage()}px; top: ${(150 - getActivePercentage()) / 2}px; left: ${(150 - getActivePercentage()) / 2}px;`"
                        ></div>
                        <div
                          class="position-absolute top-50 start-50 translate-middle text-white text-center"
                        >
                          <div class="fs-2 fw-bolder">{{ getActivePercentage().toFixed(0) }}%</div>
                          <div class="fs-7 opacity-75">Active</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!--end::Visual Donut Replacement-->

                  <div class="d-flex flex-column">
                    <div class="d-flex fw-semibold align-items-center mb-3">
                      <div class="bullet w-8px h-3px rounded-2 bg-success me-3"></div>
                      <div class="text-white opacity-75 flex-1 fs-6">Active Suppliers</div>
                      <div class="fw-bolder text-white">{{ metrics.activeSuppliers }}</div>
                    </div>
                    <div class="d-flex fw-semibold align-items-center mb-3">
                      <div class="bullet w-8px h-3px rounded-2 bg-danger me-3"></div>
                      <div class="text-white opacity-75 flex-1 fs-6">Inactive Suppliers</div>
                      <div class="fw-bolder text-white">{{ metrics.inactiveSuppliers }}</div>
                    </div>
                    <div class="d-flex fw-semibold align-items-center">
                      <div class="bullet w-8px h-3px rounded-2 bg-warning me-3"></div>
                      <div class="text-white opacity-75 flex-1 fs-6">Global Suppliers</div>
                      <div class="fw-bolder text-white">{{ metrics.globalSuppliers }}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!--begin::Coverage Stats Enhanced-->
            <div class="col-xl-6">
              <div class="card card-flush h-xl-100 bg-gradient-warning">
                <div class="card-header pt-5">
                  <h3 class="card-title align-items-start flex-column">
                    <span class="card-label fw-bold text-white">Station Coverage Analytics</span>
                    <span class="text-white opacity-75 pt-1 fw-semibold fs-6"
                      >Real-time coverage distribution</span
                    >
                  </h3>
                </div>
                <div class="card-body pt-2">
                  <!--begin::Coverage Visual-->
                  <div class="d-flex justify-content-center mb-6">
                    <div class="d-flex align-items-center">
                      <div class="position-relative me-4">
                        <div
                          class="bg-white bg-opacity-25 rounded-circle d-flex align-items-center justify-content-center"
                          style="width: 100px; height: 100px"
                        >
                          <div class="text-center text-white">
                            <div class="fs-1 fw-bolder">{{ metrics.totalStations }}</div>
                            <div class="fs-7 opacity-75">Total</div>
                          </div>
                        </div>
                      </div>
                      <div class="position-relative">
                        <div
                          class="bg-white bg-opacity-25 rounded-circle d-flex align-items-center justify-content-center"
                          style="width: 100px; height: 100px"
                        >
                          <div class="text-center text-white">
                            <div class="fs-1 fw-bolder">{{ metrics.coveredStations }}</div>
                            <div class="fs-7 opacity-75">Covered</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!--end::Coverage Visual-->

                  <div class="d-flex flex-column">
                    <!--begin::Coverage Bars-->
                    <div class="d-flex align-items-center mb-4">
                      <div class="symbol symbol-40px me-4">
                        <span class="symbol-label bg-light-success">
                          <i class="ki-duotone ki-check-circle fs-2 text-success">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                        </span>
                      </div>
                      <div class="flex-grow-1">
                        <div class="text-white fw-bold fs-6 mb-1">Covered Stations</div>
                        <div class="progress h-6px bg-white bg-opacity-25">
                          <div
                            class="progress-bar bg-success"
                            :style="`width: ${getCoveragePercentage()}%`"
                          ></div>
                        </div>
                      </div>
                      <div class="text-white fw-bolder ms-3">
                        {{ getCoveragePercentage().toFixed(1) }}%
                      </div>
                    </div>

                    <div class="d-flex align-items-center mb-4">
                      <div class="symbol symbol-40px me-4">
                        <span class="symbol-label bg-light-danger">
                          <i class="ki-duotone ki-cross-circle fs-2 text-danger">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                        </span>
                      </div>
                      <div class="flex-grow-1">
                        <div class="text-white fw-bold fs-6 mb-1">Uncovered Stations</div>
                        <div class="progress h-6px bg-white bg-opacity-25">
                          <div
                            class="progress-bar bg-danger"
                            :style="`width: ${100 - getCoveragePercentage()}%`"
                          ></div>
                        </div>
                      </div>
                      <div class="text-white fw-bolder ms-3">
                        {{ (100 - getCoveragePercentage()).toFixed(1) }}%
                      </div>
                    </div>

                    <!--begin::Summary Stats-->
                    <div
                      class="d-flex justify-content-between align-items-center mt-4 p-4 bg-white bg-opacity-10 rounded"
                    >
                      <div class="text-center">
                        <div class="text-white fs-2 fw-bolder">{{ metrics.totalStations }}</div>
                        <div class="text-white opacity-75 fs-7">Total Stations</div>
                      </div>
                      <div class="text-center">
                        <div class="text-white fs-2 fw-bolder">{{ metrics.coveredStations }}</div>
                        <div class="text-white opacity-75 fs-7">Covered</div>
                      </div>
                      <div class="text-center">
                        <div class="text-white fs-2 fw-bolder">
                          {{ metrics.totalStations - metrics.coveredStations }}
                        </div>
                        <div class="text-white opacity-75 fs-7">Remaining</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--begin::No Data State-->
        <div v-if="!loading && !dataLoaded && !apiError" class="d-flex flex-column flex-center">
          <img alt="No data" :src="'/assets/media/illustrations/sketchy-1/5.png'" class="h-200px" />
          <div class="fs-1 fw-bolder text-dark mb-4">No Data Available</div>
          <div class="fs-6">Click refresh to load dashboard data</div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, computed, nextTick } from 'vue'

// ==========================================
// REACTIVE STATE
// ==========================================
const loading = ref(false)
const dataLoaded = ref(false)
const apiError = ref('')

// Core metrics from database
const metrics = ref({
  totalSuppliers: 0,
  activeSuppliers: 0,
  inactiveSuppliers: 0,
  globalSuppliers: 0,
  localSuppliers: 0,
  totalStations: 0,
  coveredStations: 0,
  pendingApprovals: 0,
})

// Raw data arrays
const suppliers = ref([])
const supplierStations = ref([])
const stations = ref([])
const approvals = ref([])

// ==========================================
// COMPUTED PROPERTIES
// ==========================================
const getActivePercentage = () => {
  if (metrics.value.totalSuppliers === 0) return 0
  return (metrics.value.activeSuppliers / metrics.value.totalSuppliers) * 100
}

const getCoveragePercentage = () => {
  if (metrics.value.totalStations === 0) return 0
  return (metrics.value.coveredStations / metrics.value.totalStations) * 100
}

// ==========================================
// API CONFIGURATION
// ==========================================
const API_BASE_URL = 'http://localhost:4000/api/records/v1'
const AUTH_TOKEN =
  'eyJ0eXAiOiJKV1QiLCJhbGciOiJFZERTQSJ9.eyJzdWIiOiJhaUJJYWVGSVJ0dTFON1VDakEwQmNBPT0iLCJpYXQiOjE3NTAxOTc4OTEsImV4cCI6MTc1MDIwMTQ5MSwiZW1haWwiOiJhZG1pbkBsb2NhbGhvc3QiLCJjc3JmX3Rva2VuIjoiSDBLQ1UxRHlmM2tTdDBNYmRRb2EifQ.nhsjRuTTMn0BN5oGsaVTbgzDR-dp8UZBs0ti2dG9wFNJ432NNKSgP5lxR6n04dCjcHwLOYwKfq50SZzha3ZLAA'

const getHeaders = () => ({
  'Content-Type': 'application/json',
  Authorization: `Bearer ${AUTH_TOKEN}`,
})

// ==========================================
// API FUNCTIONS
// ==========================================
const fetchSuppliers = async () => {
  const response = await fetch(`${API_BASE_URL}/Suppliers`, {
    method: 'GET',
    headers: getHeaders(),
  })

  if (!response.ok) {
    throw new Error(`Failed to fetch suppliers: ${response.status} ${response.statusText}`)
  }

  const data = await response.json()
  return Array.isArray(data) ? data : data.records || data.data || []
}

const fetchSupplierStations = async () => {
  const response = await fetch(`${API_BASE_URL}/SupplierStations`, {
    method: 'GET',
    headers: getHeaders(),
  })

  if (!response.ok) {
    throw new Error(`Failed to fetch supplier stations: ${response.status} ${response.statusText}`)
  }

  const data = await response.json()
  return Array.isArray(data) ? data : data.records || data.data || []
}

const fetchStations = async () => {
  try {
    const response = await fetch(`${API_BASE_URL}/Stations`, {
      method: 'GET',
      headers: getHeaders(),
    })

    if (!response.ok) {
      // If Stations table doesn't exist, estimate from SupplierStations
      return []
    }

    const data = await response.json()
    return Array.isArray(data) ? data : data.records || data.data || []
  } catch (error) {
    console.warn('Stations table not available:', error)
    return []
  }
}

const fetchApprovals = async () => {
  try {
    const response = await fetch(`${API_BASE_URL}/Approvals`, {
      method: 'GET',
      headers: getHeaders(),
    })

    if (!response.ok) {
      return []
    }

    const data = await response.json()
    return Array.isArray(data) ? data : data.records || data.data || []
  } catch (error) {
    console.warn('Approvals table not available:', error)
    return []
  }
}

// ==========================================
// DATA PROCESSING FUNCTIONS
// ==========================================
const processSupplierMetrics = (suppliersData) => {
  metrics.value.totalSuppliers = suppliersData.length

  // Count active suppliers (Status = 'Active' or Status = 1 or IsActive field)
  metrics.value.activeSuppliers = suppliersData.filter((supplier) => {
    return (
      supplier.Status === 'Active' ||
      supplier.Status === 1 ||
      supplier.status === 'Active' ||
      supplier.status === 1 ||
      supplier.IsActive === true ||
      supplier.is_active === true
    )
  }).length

  metrics.value.inactiveSuppliers = metrics.value.totalSuppliers - metrics.value.activeSuppliers

  // Count global suppliers
  metrics.value.globalSuppliers = suppliersData.filter((supplier) => {
    return (
      supplier.IsGlobal === true ||
      supplier.is_global === true ||
      supplier.Type === 'Global' ||
      supplier.type === 'Global'
    )
  }).length

  metrics.value.localSuppliers = metrics.value.activeSuppliers - metrics.value.globalSuppliers
}

const processStationCoverage = (stationsData, supplierStationsData) => {
  if (stationsData.length > 0) {
    metrics.value.totalStations = stationsData.length
  } else {
    // Estimate from unique StationIDs in SupplierStations
    const uniqueStations = new Set(supplierStationsData.map((ss) => ss.StationID || ss.station_id))
    metrics.value.totalStations = uniqueStations.size
  }

  // Count covered stations (stations that have at least one supplier assignment)
  const coveredStations = new Set(supplierStationsData.map((ss) => ss.StationID || ss.station_id))
  metrics.value.coveredStations = coveredStations.size
}

const processApprovals = (approvalsData) => {
  // Count pending approvals
  metrics.value.pendingApprovals = approvalsData.filter((approval) => {
    return (
      approval.Status === 'Pending' ||
      approval.status === 'Pending' ||
      approval.ApprovalStatus === 'Pending' ||
      approval.approval_status === 'Pending'
    )
  }).length
}

// ==========================================
// MAIN DATA FETCH FUNCTION
// ==========================================
const fetchDashboardData = async () => {
  try {
    loading.value = true
    apiError.value = ''

    // Fetch all data in parallel
    const [suppliersData, supplierStationsData, stationsData, approvalsData] = await Promise.all([
      fetchSuppliers(),
      fetchSupplierStations(),
      fetchStations(),
      fetchApprovals(),
    ])

    // Store raw data
    suppliers.value = suppliersData
    supplierStations.value = supplierStationsData
    stations.value = stationsData
    approvals.value = approvalsData

    // Process metrics
    processSupplierMetrics(suppliersData)
    processStationCoverage(stationsData, supplierStationsData)
    processApprovals(approvalsData)

    dataLoaded.value = true

    // Initialize charts after data is loaded
    await nextTick()
    initCharts()
  } catch (error) {
    console.error('Error fetching dashboard data:', error)
    apiError.value = `Failed to load dashboard data: ${error.message}`
    dataLoaded.value = false
  } finally {
    loading.value = false
  }
}

// ==========================================
// CHART FUNCTIONS (REMOVED - REPLACED WITH CSS VISUALS)
// ==========================================
const initCharts = () => {
  // Charts replaced with pure CSS/HTML visuals
  console.log('Visual elements loaded successfully')
}

// ==========================================
// NAVIGATION FUNCTIONS
// ==========================================
const navigateToAddSupplier = () => {
  console.log('Navigate to Add Supplier')
  // Example: router.push('/suppliers/add')
}

const navigateToStationCoverage = () => {
  console.log('Navigate to Station Coverage')
  // Example: router.push('/suppliers/coverage')
}

const navigateToSupplierList = () => {
  console.log('Navigate to Supplier List')
  // Example: router.push('/suppliers/list')
}

const navigateToReports = () => {
  console.log('Navigate to Reports')
  // Example: router.push('/suppliers/reports')
}

const navigateToApprovals = () => {
  console.log('Navigate to Approvals')
  // Example: router.push('/approvals')
}

const exportData = () => {
  console.log('Export dashboard data')
  // Implement export functionality
  const data = {
    suppliers: suppliers.value,
    stations: supplierStations.value,
    metrics: metrics.value,
    exportDate: new Date().toISOString(),
  }

  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' })
  const url = URL.createObjectURL(blob)
  const link = document.createElement('a')
  link.href = url
  link.download = `supplier-dashboard-${new Date().toISOString().split('T')[0]}.json`
  link.click()
  URL.revokeObjectURL(url)
}

const viewSettings = () => {
  console.log('View settings')
  // Example: router.push('/settings/suppliers')
}

// ==========================================
// REFRESH FUNCTION
// ==========================================
const refreshData = async () => {
  await fetchDashboardData()
}

// ==========================================
// LIFECYCLE HOOKS
// ==========================================
onMounted(async () => {
  await fetchDashboardData()

  // Set up auto-refresh every 5 minutes
  setInterval(() => {
    if (!loading.value) {
      refreshData()
    }
  }, 300000) // 5 minutes
})
</script>
